{"version":3,"file":"AnimationDOMNode.js","sourceRoot":"","sources":["../../../../../../front_end/panels/animation/AnimationDOMNode.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nconst DEVTOOLS_ANIMATIONS_WORLD_NAME = 'devtools_animations';\nconst REPORT_SCROLL_POSITION_BINDING_NAME = '__devtools_report_scroll_position__';\n\nconst getScrollListenerNameInPage = (id: number): string => `__devtools_scroll_listener_${id}__`;\n\ntype ScrollListener = (param: {scrollLeft: number, scrollTop: number}) => void;\ntype BindingListener =\n    (ev: Common.EventTarget.EventTargetEvent<Protocol.Runtime.BindingCalledEvent, SDK.RuntimeModel.EventTypes>) => void;\n\nasync function resolveToObjectInWorld(\n    domNode: SDK.DOMModel.DOMNode, worldName: string): Promise<SDK.RemoteObject.RemoteObject|null> {\n  const resourceTreeModel = domNode.domModel().target().model(SDK.ResourceTreeModel.ResourceTreeModel) as\n      SDK.ResourceTreeModel.ResourceTreeModel;\n  const pageAgent = domNode.domModel().target().pageAgent();\n  for (const frame of resourceTreeModel.frames()) {\n    // This returns previously created world if it exists for the frame.\n    const {executionContextId} = await pageAgent.invoke_createIsolatedWorld({frameId: frame.id, worldName});\n    const object = await domNode.resolveToObject(undefined, executionContextId);\n    if (object) {\n      return object;\n    }\n  }\n  return null;\n}\n\n/**\n * Provides an extension over `SDK.DOMModel.DOMNode` that gives it additional\n * capabilities for animation debugging, mainly:\n * - getting a node's scroll information (scroll offsets and scroll range).\n * - updating a node's scroll offset.\n * - tracking the node's scroll offsets with event listeners.\n *\n * It works by running functions on the target page, see `SDK.DOMModel.DOMNode`s `callFunction` method\n * for more details on how a function is called on the target page.\n *\n * For listening to events on the target page and getting notified on the devtools frontend\n * side, we're adding a binding to the page `__devtools_report_scroll_position__` in a world `devtools_animation`\n * we've created. Then, we're setting scroll listeners of the `node` in the same world which calls the binding\n * itself with the scroll offsets.\n */\nexport class AnimationDOMNode {\n  #domNode: SDK.DOMModel.DOMNode;\n  #scrollListenersById: Map<number, ScrollListener>;\n  #scrollBindingListener?: BindingListener;\n\n  static lastAddedListenerId: number = 0;\n\n  constructor(domNode: SDK.DOMModel.DOMNode) {\n    this.#domNode = domNode;\n    this.#scrollListenersById = new Map();\n  }\n\n  async #addReportScrollPositionBinding(): Promise<void> {\n    // The binding is already added so we don't need to add it again.\n    if (this.#scrollBindingListener) {\n      return;\n    }\n\n    this.#scrollBindingListener = ev => {\n      const {name, payload} = ev.data;\n      if (name !== REPORT_SCROLL_POSITION_BINDING_NAME) {\n        return;\n      }\n\n      const {scrollTop, scrollLeft, id} = JSON.parse(payload) as {scrollTop: number, scrollLeft: number, id: number};\n      const scrollListener = this.#scrollListenersById.get(id);\n      if (!scrollListener) {\n        return;\n      }\n\n      scrollListener({scrollTop, scrollLeft});\n    };\n\n    const runtimeModel =\n        this.#domNode.domModel().target().model(SDK.RuntimeModel.RuntimeModel) as SDK.RuntimeModel.RuntimeModel;\n    await runtimeModel.addBinding({\n      name: REPORT_SCROLL_POSITION_BINDING_NAME,\n      executionContextName: DEVTOOLS_ANIMATIONS_WORLD_NAME,\n    });\n    runtimeModel.addEventListener(SDK.RuntimeModel.Events.BindingCalled, this.#scrollBindingListener);\n  }\n\n  async #removeReportScrollPositionBinding(): Promise<void> {\n    // There isn't any binding added yet.\n    if (!this.#scrollBindingListener) {\n      return;\n    }\n\n    const runtimeModel =\n        this.#domNode.domModel().target().model(SDK.RuntimeModel.RuntimeModel) as SDK.RuntimeModel.RuntimeModel;\n    await runtimeModel.removeBinding({\n      name: REPORT_SCROLL_POSITION_BINDING_NAME,\n    });\n    runtimeModel.removeEventListener(SDK.RuntimeModel.Events.BindingCalled, this.#scrollBindingListener);\n    this.#scrollBindingListener = undefined;\n  }\n\n  async addScrollEventListener(onScroll: ({scrollLeft, scrollTop}: {scrollLeft: number, scrollTop: number}) => void):\n      Promise<number|null> {\n    AnimationDOMNode.lastAddedListenerId++;\n    const id = AnimationDOMNode.lastAddedListenerId;\n    this.#scrollListenersById.set(id, onScroll);\n    // Add the binding for reporting scroll events from the page if it doesn't exist.\n    if (!this.#scrollBindingListener) {\n      await this.#addReportScrollPositionBinding();\n    }\n\n    const object = await resolveToObjectInWorld(this.#domNode, DEVTOOLS_ANIMATIONS_WORLD_NAME);\n    if (!object) {\n      return null;\n    }\n\n    await object.callFunction(scrollListenerInPage, [\n      id,\n      REPORT_SCROLL_POSITION_BINDING_NAME,\n      getScrollListenerNameInPage(id),\n    ].map(arg => SDK.RemoteObject.RemoteObject.toCallArgument(arg)));\n    object.release();\n    return id;\n\n    function scrollListenerInPage(\n        this: HTMLElement|Document, id: number, reportScrollPositionBindingName: string,\n        scrollListenerNameInPage: string): void {\n      if ('scrollingElement' in this && !this.scrollingElement) {\n        return;\n      }\n\n      const scrollingElement = ('scrollingElement' in this ? this.scrollingElement : this) as HTMLElement;\n      // @ts-ignore We're setting a custom field on `Element` or `Document` for retaining the function on the page.\n      this[scrollListenerNameInPage] = () => {\n        // @ts-ignore `reportScrollPosition` binding is injected to the page before calling the function.\n        globalThis[reportScrollPositionBindingName](\n            JSON.stringify({scrollTop: scrollingElement.scrollTop, scrollLeft: scrollingElement.scrollLeft, id}));\n      };\n\n      // @ts-ignore We've already defined the function used below.\n      this.addEventListener('scroll', this[scrollListenerNameInPage], true);\n    }\n  }\n\n  async removeScrollEventListener(id: number): Promise<void> {\n    const object = await resolveToObjectInWorld(this.#domNode, DEVTOOLS_ANIMATIONS_WORLD_NAME);\n    if (!object) {\n      return;\n    }\n\n    await object.callFunction(\n        removeScrollListenerInPage,\n        [getScrollListenerNameInPage(id)].map(arg => SDK.RemoteObject.RemoteObject.toCallArgument(arg)));\n    object.release();\n\n    this.#scrollListenersById.delete(id);\n    // There aren't any scroll listeners remained on the page\n    // so we remove the binding.\n    if (this.#scrollListenersById.size === 0) {\n      await this.#removeReportScrollPositionBinding();\n    }\n\n    function removeScrollListenerInPage(this: HTMLElement|Document, scrollListenerNameInPage: string): void {\n      // @ts-ignore We've already set this custom field while adding scroll listener.\n      this.removeEventListener('scroll', this[scrollListenerNameInPage]);\n      // @ts-ignore We've already set this custom field while adding scroll listener.\n      delete this[scrollListenerNameInPage];\n    }\n  }\n\n  async scrollTop(): Promise<number|null> {\n    return this.#domNode.callFunction(scrollTopInPage).then(res => res?.value ?? null);\n\n    function scrollTopInPage(this: Element|Document): number {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return 0;\n        }\n\n        return this.scrollingElement.scrollTop;\n      }\n      return this.scrollTop;\n    }\n  }\n\n  async scrollLeft(): Promise<number|null> {\n    return this.#domNode.callFunction(scrollLeftInPage).then(res => res?.value ?? null);\n\n    function scrollLeftInPage(this: Element|Document): number {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return 0;\n        }\n\n        return this.scrollingElement.scrollLeft;\n      }\n      return this.scrollLeft;\n    }\n  }\n\n  async setScrollTop(offset: number): Promise<void> {\n    await this.#domNode.callFunction(setScrollTopInPage, [offset]);\n\n    function setScrollTopInPage(this: Element|Document, offsetInPage: number): void {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return;\n        }\n\n        this.scrollingElement.scrollTop = offsetInPage;\n      } else {\n        this.scrollTop = offsetInPage;\n      }\n    }\n  }\n\n  async setScrollLeft(offset: number): Promise<void> {\n    await this.#domNode.callFunction(setScrollLeftInPage, [offset]);\n\n    function setScrollLeftInPage(this: Element|Document, offsetInPage: number): void {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return;\n        }\n\n        this.scrollingElement.scrollLeft = offsetInPage;\n      } else {\n        this.scrollLeft = offsetInPage;\n      }\n    }\n  }\n\n  async verticalScrollRange(): Promise<number|null> {\n    return this.#domNode.callFunction(verticalScrollRangeInPage).then(res => res?.value ?? null);\n\n    function verticalScrollRangeInPage(this: Element|Document): number {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return 0;\n        }\n\n        return this.scrollingElement.scrollHeight - this.scrollingElement.clientHeight;\n      }\n\n      return this.scrollHeight - this.clientHeight;\n    }\n  }\n\n  async horizontalScrollRange(): Promise<number|null> {\n    return this.#domNode.callFunction(horizontalScrollRangeInPage).then(res => res?.value ?? null);\n\n    function horizontalScrollRangeInPage(this: Element|Document): number {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return 0;\n        }\n\n        return this.scrollingElement.scrollWidth - this.scrollingElement.clientWidth;\n      }\n\n      return this.scrollWidth - this.clientWidth;\n    }\n  }\n}\n"]}