{"version":3,"file":"RequestHeaderSection.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/network/components/RequestHeaderSection.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport {\n  getCleanTextContentFromElements,\n  renderElementIntoDOM,\n} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport * as Coordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\n\nimport * as NetworkComponents from './components.js';\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\nasync function renderRequestHeaderSection(request: SDK.NetworkRequest.NetworkRequest):\n    Promise<NetworkComponents.RequestHeaderSection.RequestHeaderSection> {\n  const component = new NetworkComponents.RequestHeaderSection.RequestHeaderSection();\n  renderElementIntoDOM(component);\n  component.data = {request};\n  await coordinator.done();\n  assert.instanceOf(component, HTMLElement);\n  assert.isNotNull(component.shadowRoot);\n  return component;\n}\n\ndescribeWithEnvironment('RequestHeaderSection', () => {\n  it('renders provisional headers warning', async () => {\n    const request = {\n      cachedInMemory: () => true,\n      requestHeaders: () =>\n          [{name: ':method', value: 'GET'},\n           {name: 'accept-encoding', value: 'gzip, deflate, br'},\n           {name: 'cache-control', value: 'no-cache'},\n    ],\n      requestHeadersText: () => undefined,\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n\n    const component = await renderRequestHeaderSection(request);\n    assert.isNotNull(component.shadowRoot);\n\n    assert.strictEqual(\n        getCleanTextContentFromElements(component.shadowRoot, '.call-to-action')[0],\n        'Provisional headers are shown. Disable cache to see full headers. Learn more',\n    );\n  });\n\n  it('sorts headers alphabetically', async () => {\n    const request = {\n      cachedInMemory: () => true,\n      requestHeaders: () =>\n          [{name: 'Ab', value: 'second'},\n           {name: 'test', value: 'fifth'},\n           {name: 'name', value: 'fourth'},\n           {name: 'abc', value: 'third'},\n           {name: 'aa', value: 'first'},\n    ],\n      requestHeadersText: () => 'placeholderText',\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n\n    const component = await renderRequestHeaderSection(request);\n    assert.isNotNull(component.shadowRoot);\n\n    const rows = component.shadowRoot.querySelectorAll('devtools-header-section-row');\n    const sorted = Array.from(rows).map(row => {\n      assert.isNotNull(row.shadowRoot);\n      return [\n        row.shadowRoot.querySelector('.header-name')?.textContent?.trim() || '',\n        row.shadowRoot.querySelector('.header-value')?.textContent?.trim() || '',\n      ];\n    });\n    assert.deepStrictEqual(sorted, [\n      ['aa:', 'first'],\n      ['ab:', 'second'],\n      ['abc:', 'third'],\n      ['name:', 'fourth'],\n      ['test:', 'fifth'],\n    ]);\n  });\n\n  it('does not warn about pseudo-headers containing invalid characters', async () => {\n    const request = {\n      cachedInMemory: () => true,\n      requestHeaders: () =>\n          [{name: ':Authority', value: 'www.example.com'},\n           {name: ':Method', value: 'GET'},\n           {name: ':Path', value: '/'},\n           {name: ':Scheme', value: 'https'},\n    ],\n      requestHeadersText: () => 'placeholderText',\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n\n    const component = await renderRequestHeaderSection(request);\n    assert.isNotNull(component.shadowRoot);\n\n    const rows = component.shadowRoot.querySelectorAll('devtools-header-section-row');\n    for (const row of rows) {\n      assert.isNotNull(row.shadowRoot);\n      assert.isNull(row.shadowRoot.querySelector('.disallowed-characters'));\n    }\n  });\n});\n"]}