{"version":3,"file":"CSSOverviewSidebarPanel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/css_overview/CSSOverviewSidebarPanel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport cssOverviewSidebarPanelStyles from './cssOverviewSidebarPanel.css.js';\n\nconst UIStrings = {\n  /**\n   *@description Label for the 'Clear overview' button in the CSS overview report\n   */\n  clearOverview: 'Clear overview',\n  /**\n   * @description Accessible label for the CSS overview panel sidebar\n   */\n  cssOverviewPanelSidebar: 'CSS overview panel sidebar',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/css_overview/CSSOverviewSidebarPanel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst ITEM_CLASS_NAME = 'overview-sidebar-panel-item';\nconst SELECTED_CLASS_NAME = 'selected';\n\nexport class CSSOverviewSidebarPanel extends Common.ObjectWrapper.eventMixin<EventTypes, typeof UI.Widget.VBox>(\n    UI.Widget.VBox) {\n  containerElement: HTMLDivElement;\n\n  constructor() {\n    super(true);\n\n    this.contentElement.classList.add('overview-sidebar-panel');\n    this.contentElement.addEventListener('click', this.#onItemClick.bind(this));\n    this.contentElement.addEventListener('keydown', this.#onItemKeyDown.bind(this));\n\n    // We need a container so that each item covers the full width of the\n    // longest item, so that the selected item's background expands fully\n    // even when the sidebar overflows.\n    // Also see crbug/1408003\n    this.containerElement =\n        this.contentElement.createChild('div', 'overview-sidebar-panel-container') as HTMLDivElement;\n    UI.ARIAUtils.setLabel(this.containerElement, i18nString(UIStrings.cssOverviewPanelSidebar));\n    UI.ARIAUtils.markAsTree(this.containerElement);\n\n    // Clear overview.\n    const clearResultsButton = new UI.Toolbar.ToolbarButton(\n        i18nString(UIStrings.clearOverview), 'clear', undefined, 'css-overview.clear-overview');\n    clearResultsButton.addEventListener(UI.Toolbar.ToolbarButton.Events.Click, this.#reset, this);\n\n    // Toolbar.\n    const toolbarElement = this.containerElement.createChild('div', 'overview-toolbar');\n    const toolbar = new UI.Toolbar.Toolbar('', toolbarElement);\n    toolbar.appendToolbarItem(clearResultsButton);\n  }\n\n  addItem(name: string, id: string): void {\n    const item = this.containerElement.createChild('div', ITEM_CLASS_NAME);\n    item.setAttribute(\n        'jslog',\n        `${\n            VisualLogging.item()\n                .track({click: true, keydown: 'Enter|ArrowUp|ArrowDown'})\n                .context(`css-overview.${id}`)}`);\n    UI.ARIAUtils.markAsTreeitem(item);\n    item.textContent = name;\n    item.dataset.id = id;\n    item.tabIndex = 0;\n  }\n\n  #reset(): void {\n    this.dispatchEventToListeners(SidebarEvents.Reset);\n  }\n\n  #deselectAllItems(): void {\n    const items = this.containerElement.querySelectorAll(`.${ITEM_CLASS_NAME}`);\n    items.forEach(item => {\n      item.classList.remove(SELECTED_CLASS_NAME);\n    });\n  }\n\n  #onItemClick(event: Event): void {\n    const target = (event.composedPath()[0] as HTMLElement);\n    if (!target.classList.contains(ITEM_CLASS_NAME)) {\n      return;\n    }\n\n    const {id} = target.dataset;\n    if (!id) {\n      return;\n    }\n    this.select(id, false);\n    this.dispatchEventToListeners(SidebarEvents.ItemSelected, {id, isMouseEvent: true, key: undefined});\n  }\n\n  #onItemKeyDown(event: KeyboardEvent): void {\n    if (event.key !== 'Enter' && event.key !== 'ArrowUp' && event.key !== 'ArrowDown') {\n      return;\n    }\n    const target = (event.composedPath()[0] as HTMLElement);\n    if (!target.classList.contains(ITEM_CLASS_NAME)) {\n      return;\n    }\n\n    const {id} = target.dataset;\n    if (!id) {\n      return;\n    }\n\n    if (event.key === 'Enter') {\n      this.select(id, false);\n      this.dispatchEventToListeners(SidebarEvents.ItemSelected, {id, isMouseEvent: false, key: event.key});\n    } else {  // arrow up/down key\n      const items = this.containerElement.querySelectorAll(`.${ITEM_CLASS_NAME}`);\n\n      let currItemIndex = -1;\n      for (let idx = 0; idx < items.length; idx++) {\n        if ((items[idx] as HTMLElement).dataset.id === id) {\n          currItemIndex = idx;\n          break;\n        }\n      }\n      if (currItemIndex < 0) {\n        return;\n      }\n\n      const moveTo = (event.key === 'ArrowDown' ? 1 : -1);\n      const nextItemIndex = (currItemIndex + moveTo) % items.length;\n      const nextItemId = (items[nextItemIndex] as HTMLElement).dataset.id;\n      if (!nextItemId) {\n        return;\n      }\n\n      this.select(nextItemId, true);\n      this.dispatchEventToListeners(SidebarEvents.ItemSelected, {id: nextItemId, isMouseEvent: false, key: event.key});\n    }\n\n    event.consume(true);\n  }\n\n  select(id: string, focus: boolean): void {\n    const target = this.containerElement.querySelector(`[data-id=${CSS.escape(id)}]`) as HTMLElement;\n    if (!target) {\n      return;\n    }\n\n    if (target.classList.contains(SELECTED_CLASS_NAME)) {\n      return;\n    }\n\n    this.#deselectAllItems();\n    target.classList.add(SELECTED_CLASS_NAME);\n\n    if (focus) {\n      target.contentEditable = 'true';\n      target.focus();\n      target.contentEditable = 'false';\n    }\n  }\n  override wasShown(): void {\n    super.wasShown();\n    this.registerCSSFiles([cssOverviewSidebarPanelStyles]);\n  }\n}\n\nexport const enum SidebarEvents {\n  ItemSelected = 'ItemSelected',\n  Reset = 'Reset',\n}\n\nexport interface ItemSelectedEvent {\n  id: string;\n  isMouseEvent: boolean;\n  key: string|undefined;\n}\n\nexport type EventTypes = {\n  [SidebarEvents.ItemSelected]: ItemSelectedEvent,\n  [SidebarEvents.Reset]: void,\n};\n"]}