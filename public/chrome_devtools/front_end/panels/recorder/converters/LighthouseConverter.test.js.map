{"version":3,"file":"LighthouseConverter.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/recorder/converters/LighthouseConverter.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,qBAAqB,CAAC;AAE9C,OAAO,KAAK,UAAU,MAAM,iBAAiB,CAAC;AAE9C,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;IACnC,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;QACvC,MAAM,SAAS,GAAG,IAAI,UAAU,CAAC,mBAAmB,CAAC,mBAAmB,CACpE,IAAI,CACP,CAAC;QACF,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,MAAM,SAAS,CAAC,SAAS,CAAC;YACpD,KAAK,EAAE,MAAM;YACb,KAAK,EAAE;gBACL,EAAC,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,GAAG,EAAE,qBAAqB,EAAC;gBACnE,EAAC,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,EAAC;aAC7D;SACF,CAAC,CAAC;QACH,MAAM,QAAQ,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;yBAoCI,CAAC;QACtB,MAAM,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;QACpD,MAAM,CAAC,WAAW,CAAC,MAAM,EAAE,QAAQ,EAAE,0CAA0C,MAAM,EAAE,CAAC,CAAC;QACzF,MAAM,CAAC,eAAe,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC;IACvD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;QACvC,MAAM,SAAS,GAAG,IAAI,UAAU,CAAC,mBAAmB,CAAC,mBAAmB,CACpE,IAAI,CACP,CAAC;QACF,MAAM,MAAM,GAAG,MAAM,SAAS,CAAC,aAAa,CAAC;YAC3C,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM;SACpC,CAAC,CAAC;QACH,MAAM,CAAC,WAAW,CACd,MAAM,EACN;;;;CAIP,CACI,CAAC;IACJ,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Models from '../models/models.js';\n\nimport * as Converters from './converters.js';\n\ndescribe('LighthouseConverter', () => {\n  it('should stringify a flow', async () => {\n    const converter = new Converters.LighthouseConverter.LighthouseConverter(\n        '  ',\n    );\n    const [result, sourceMap] = await converter.stringify({\n      title: 'test',\n      steps: [\n        {type: Models.Schema.StepType.Navigate, url: 'https://example.com'},\n        {type: Models.Schema.StepType.Scroll, selectors: [['.cls']]},\n      ],\n    });\n    const expected = `const fs = require('fs');\nconst puppeteer = require('puppeteer'); // v22.0.0 or later\n\n(async () => {\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  const timeout = 5000;\n  page.setDefaultTimeout(timeout);\n\n  const lhApi = await import('lighthouse'); // v10.0.0 or later\n  const flags = {\n    screenEmulation: {\n      disabled: true\n    }\n  }\n  const config = lhApi.desktopConfig;\n  const lhFlow = await lhApi.startFlow(page, {name: 'test', config, flags});\n  await lhFlow.startNavigation();\n  {\n    const targetPage = page;\n    await targetPage.goto('https://example.com');\n  }\n  await lhFlow.endNavigation();\n  await lhFlow.startTimespan();\n  {\n    const targetPage = page;\n    await puppeteer.Locator.race([\n      targetPage.locator('.cls')\n    ])\n      .setTimeout(timeout)\n      .scroll({ scrollTop: undefined, scrollLeft: undefined});\n  }\n  await lhFlow.endTimespan();\n  const lhFlowReport = await lhFlow.generateReport();\n  fs.writeFileSync(__dirname + '/flow.report.html', lhFlowReport)\n\n  await browser.close();`;\n    const actual = result.substring(0, expected.length);\n    assert.strictEqual(actual, expected, `Unexpected start of generated result:\\n${actual}`);\n    assert.deepStrictEqual(sourceMap, [1, 17, 6, 23, 9]);\n  });\n\n  it('should stringify a step', async () => {\n    const converter = new Converters.LighthouseConverter.LighthouseConverter(\n        '  ',\n    );\n    const result = await converter.stringifyStep({\n      type: Models.Schema.StepType.Scroll,\n    });\n    assert.strictEqual(\n        result,\n        `{\n  const targetPage = page;\n  await targetPage.evaluate((x, y) => { window.scroll(x, y); }, undefined, undefined)\n}\n`,\n    );\n  });\n});\n"]}