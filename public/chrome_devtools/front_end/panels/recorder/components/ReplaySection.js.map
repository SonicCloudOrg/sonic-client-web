{"version":3,"file":"ReplaySection.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/recorder/components/ReplaySection.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as ComponentHelpers from '../../../ui/components/helpers/helpers.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\nimport type * as Extensions from '../extensions/extensions.js';\nimport type * as Models from '../models/models.js';\nimport {PlayRecordingSpeed} from '../models/RecordingPlayer.js';\nimport * as Actions from '../recorder-actions/recorder-actions.js';\n\nimport {\n  SelectButton,\n  type SelectButtonClickEvent,\n  type SelectButtonItem,\n  type SelectMenuSelectedEvent,\n  Variant as SelectButtonVariant,\n} from './SelectButton.js';\n\nconst UIStrings = {\n  /**\n   * @description Replay button label\n   */\n  Replay: 'Replay',\n  /**\n   * @description Button label for the normal speed replay option\n   */\n  ReplayNormalButtonLabel: 'Normal speed',\n  /**\n   * @description Item label for the normal speed replay option\n   */\n  ReplayNormalItemLabel: 'Normal (Default)',\n  /**\n   * @description Button label for the slow speed replay option\n   */\n  ReplaySlowButtonLabel: 'Slow speed',\n  /**\n   * @description Item label for the slow speed replay option\n   */\n  ReplaySlowItemLabel: 'Slow',\n  /**\n   * @description Button label for the very slow speed replay option\n   */\n  ReplayVerySlowButtonLabel: 'Very slow speed',\n  /**\n   * @description Item label for the very slow speed replay option\n   */\n  ReplayVerySlowItemLabel: 'Very slow',\n  /**\n   * @description Button label for the extremely slow speed replay option\n   */\n  ReplayExtremelySlowButtonLabel: 'Extremely slow speed',\n  /**\n   * @description Item label for the slow speed replay option\n   */\n  ReplayExtremelySlowItemLabel: 'Extremely slow',\n  /**\n   * @description Label for a group of items in the replay menu that indicate various replay speeds (e.g., Normal, Fast, Slow).\n   */\n  speedGroup: 'Speed',\n  /**\n   * @description Label for a group of items in the replay menu that indicate various extensions that can be used for replay.\n   */\n  extensionGroup: 'Extensions',\n};\n\nconst items: SelectButtonItem[] = [\n  {\n    value: PlayRecordingSpeed.Normal,\n    buttonIconName: 'play',\n    buttonLabel: () => i18nString(UIStrings.ReplayNormalButtonLabel),\n    label: () => i18nString(UIStrings.ReplayNormalItemLabel),\n  },\n  {\n    value: PlayRecordingSpeed.Slow,\n    buttonIconName: 'play',\n    buttonLabel: () => i18nString(UIStrings.ReplaySlowButtonLabel),\n    label: () => i18nString(UIStrings.ReplaySlowItemLabel),\n  },\n  {\n    value: PlayRecordingSpeed.VerySlow,\n    buttonIconName: 'play',\n    buttonLabel: () => i18nString(UIStrings.ReplayVerySlowButtonLabel),\n    label: () => i18nString(UIStrings.ReplayVerySlowItemLabel),\n  },\n  {\n    value: PlayRecordingSpeed.ExtremelySlow,\n    buttonIconName: 'play',\n    buttonLabel: () => i18nString(UIStrings.ReplayExtremelySlowButtonLabel),\n    label: () => i18nString(UIStrings.ReplayExtremelySlowItemLabel),\n  },\n];\n\nconst replaySpeedToMetricSpeedMap = {\n  [PlayRecordingSpeed.Normal]: Host.UserMetrics.RecordingReplaySpeed.Normal,\n  [PlayRecordingSpeed.Slow]: Host.UserMetrics.RecordingReplaySpeed.Slow,\n  [PlayRecordingSpeed.VerySlow]: Host.UserMetrics.RecordingReplaySpeed.VerySlow,\n  [PlayRecordingSpeed.ExtremelySlow]: Host.UserMetrics.RecordingReplaySpeed.ExtremelySlow,\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings(\n    'panels/recorder/components/ReplaySection.ts',\n    UIStrings,\n);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class StartReplayEvent extends Event {\n  static readonly eventName = 'startreplay';\n\n  constructor(\n      public speed: PlayRecordingSpeed,\n      public extension?: Extensions.ExtensionManager.Extension,\n  ) {\n    super(StartReplayEvent.eventName, {bubbles: true, composed: true});\n  }\n}\n\nexport interface ReplaySectionProps {\n  disabled: boolean;\n}\n\nexport interface ReplaySectionData {\n  settings: Models.RecorderSettings.RecorderSettings;\n  replayExtensions: Extensions.ExtensionManager.Extension[];\n}\n\nconst REPLAY_EXTENSION_PREFIX = 'extension';\n\nexport class ReplaySection extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-replay-section`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  readonly #boundRender = this.#render.bind(this);\n  readonly #props: ReplaySectionProps = {disabled: false};\n  #settings?: Models.RecorderSettings.RecorderSettings;\n  #replayExtensions: Extensions.ExtensionManager.Extension[] = [];\n\n  set data(data: ReplaySectionData) {\n    this.#settings = data.settings;\n    this.#replayExtensions = data.replayExtensions;\n  }\n\n  get disabled(): boolean {\n    return this.#props.disabled;\n  }\n\n  set disabled(disabled: boolean) {\n    this.#props.disabled = disabled;\n    void ComponentHelpers.ScheduledRender.scheduleRender(\n        this,\n        this.#boundRender,\n    );\n  }\n\n  connectedCallback(): void {\n    void ComponentHelpers.ScheduledRender.scheduleRender(\n        this,\n        this.#boundRender,\n    );\n  }\n\n  #handleSelectMenuSelected(event: SelectMenuSelectedEvent): void {\n    const speed = event.value as PlayRecordingSpeed;\n    if (this.#settings && event.value) {\n      this.#settings.speed = speed;\n      this.#settings.replayExtension = '';\n    }\n\n    Host.userMetrics.recordingReplaySpeed(replaySpeedToMetricSpeedMap[speed]);\n    void ComponentHelpers.ScheduledRender.scheduleRender(\n        this,\n        this.#boundRender,\n    );\n  }\n\n  #handleSelectButtonClick(event: SelectButtonClickEvent): void {\n    event.stopPropagation();\n\n    if (event.value && event.value.startsWith(REPLAY_EXTENSION_PREFIX)) {\n      if (this.#settings) {\n        this.#settings.replayExtension = event.value;\n      }\n      const extensionIdx = Number(\n          event.value.substring(REPLAY_EXTENSION_PREFIX.length),\n      );\n      this.dispatchEvent(\n          new StartReplayEvent(\n              PlayRecordingSpeed.Normal,\n              this.#replayExtensions[extensionIdx],\n              ),\n      );\n      void ComponentHelpers.ScheduledRender.scheduleRender(\n          this,\n          this.#boundRender,\n      );\n      return;\n    }\n\n    this.dispatchEvent(new StartReplayEvent(this.#settings ? this.#settings.speed : PlayRecordingSpeed.Normal));\n    void ComponentHelpers.ScheduledRender.scheduleRender(\n        this,\n        this.#boundRender,\n    );\n  }\n\n  #render(): void {\n    const groups = [{name: i18nString(UIStrings.speedGroup), items}];\n\n    if (this.#replayExtensions.length) {\n      groups.push({\n        name: i18nString(UIStrings.extensionGroup),\n        items: this.#replayExtensions.map((extension, idx) => {\n          return {\n            value: REPLAY_EXTENSION_PREFIX + idx,\n            buttonIconName: 'play',\n            buttonLabel: () => extension.getName(),\n            label: () => extension.getName(),\n          };\n        }),\n      });\n    }\n\n    // clang-format off\n    LitHtml.render(\n      LitHtml.html`\n    <${SelectButton.litTagName}\n      @selectmenuselected=${this.#handleSelectMenuSelected}\n      @selectbuttonclick=${this.#handleSelectButtonClick}\n      .variant=${SelectButtonVariant.PRIMARY}\n      .showItemDivider=${false}\n      .disabled=${this.#props.disabled}\n      .action=${Actions.RecorderActions.ReplayRecording}\n      .value=${this.#settings?.replayExtension || this.#settings?.speed}\n      .buttonLabel=${i18nString(UIStrings.Replay)}\n      .groups=${groups}\n      jslog=${VisualLogging.action(Actions.RecorderActions.ReplayRecording).track({click: true})}>\n    </${SelectButton.litTagName}>`,\n      this.#shadow,\n      { host: this },\n    );\n    // clang-format on\n  }\n}\n\ncustomElements.define(\n    'devtools-replay-section',\n    ReplaySection,\n);\n\ndeclare global {\n  interface HTMLElementEventMap {\n    startreplay: StartReplayEvent;\n  }\n\n  interface HTMLElementTagNameMap {\n    'devtools-replay-section': ReplaySection;\n  }\n}\n"]}