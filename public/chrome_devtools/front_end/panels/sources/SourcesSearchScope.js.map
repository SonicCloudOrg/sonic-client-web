{"version":3,"file":"SourcesSearchScope.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/SourcesSearchScope.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2011 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport type * as Search from '../search/search.js';\n\nexport class SourcesSearchScope implements Search.SearchScope.SearchScope {\n  private searchId: number;\n  private searchResultCandidates: Workspace.UISourceCode.UISourceCode[];\n  private searchResultCallback: ((arg0: Search.SearchScope.SearchResult) => void)|null;\n  private searchFinishedCallback: ((arg0: boolean) => void)|null;\n  private searchConfig: Workspace.SearchConfig.SearchConfig|null;\n  constructor() {\n    // FIXME: Add title once it is used by search controller.\n    this.searchId = 0;\n    this.searchResultCandidates = [];\n    this.searchResultCallback = null;\n    this.searchFinishedCallback = null;\n    this.searchConfig = null;\n  }\n\n  private static filesComparator(\n      uiSourceCode1: Workspace.UISourceCode.UISourceCode, uiSourceCode2: Workspace.UISourceCode.UISourceCode): number {\n    if (uiSourceCode1.isDirty() && !uiSourceCode2.isDirty()) {\n      return -1;\n    }\n    if (!uiSourceCode1.isDirty() && uiSourceCode2.isDirty()) {\n      return 1;\n    }\n    const isFileSystem1 = uiSourceCode1.project().type() === Workspace.Workspace.projectTypes.FileSystem &&\n        !Persistence.Persistence.PersistenceImpl.instance().binding(uiSourceCode1);\n    const isFileSystem2 = uiSourceCode2.project().type() === Workspace.Workspace.projectTypes.FileSystem &&\n        !Persistence.Persistence.PersistenceImpl.instance().binding(uiSourceCode2);\n    if (isFileSystem1 !== isFileSystem2) {\n      return isFileSystem1 ? 1 : -1;\n    }\n    const url1 = uiSourceCode1.url();\n    const url2 = uiSourceCode2.url();\n    if (url1 && !url2) {\n      return -1;\n    }\n    if (!url1 && url2) {\n      return 1;\n    }\n    return Platform.StringUtilities.naturalOrderComparator(\n        uiSourceCode1.fullDisplayName(), uiSourceCode2.fullDisplayName());\n  }\n\n  private static urlComparator(\n      uiSourceCode1: Workspace.UISourceCode.UISourceCode, uiSourceCode2: Workspace.UISourceCode.UISourceCode): number {\n    return Platform.StringUtilities.naturalOrderComparator(uiSourceCode1.url(), uiSourceCode2.url());\n  }\n\n  performIndexing(progress: Common.Progress.Progress): void {\n    this.stopSearch();\n\n    const projects = this.projects();\n    const compositeProgress = new Common.Progress.CompositeProgress(progress);\n    for (let i = 0; i < projects.length; ++i) {\n      const project = projects[i];\n      const projectProgress = compositeProgress.createSubProgress([...project.uiSourceCodes()].length);\n      project.indexContent(projectProgress);\n    }\n  }\n\n  private projects(): Workspace.Workspace.Project[] {\n    const searchInAnonymousAndContentScripts =\n        Common.Settings.Settings.instance().moduleSetting('search-in-anonymous-and-content-scripts').get();\n\n    return Workspace.Workspace.WorkspaceImpl.instance().projects().filter(project => {\n      if (project.type() === Workspace.Workspace.projectTypes.Service) {\n        return false;\n      }\n      if (!searchInAnonymousAndContentScripts && project.isServiceProject() &&\n          project.type() !== Workspace.Workspace.projectTypes.Formatter) {\n        return false;\n      }\n      if (!searchInAnonymousAndContentScripts && project.type() === Workspace.Workspace.projectTypes.ContentScripts) {\n        return false;\n      }\n      return true;\n    });\n  }\n\n  performSearch(\n      searchConfig: Workspace.SearchConfig.SearchConfig, progress: Common.Progress.Progress,\n      searchResultCallback: (arg0: Search.SearchScope.SearchResult) => void,\n      searchFinishedCallback: (arg0: boolean) => void): void {\n    this.stopSearch();\n    this.searchResultCandidates = [];\n    this.searchResultCallback = searchResultCallback;\n    this.searchFinishedCallback = searchFinishedCallback;\n    this.searchConfig = searchConfig;\n\n    const promises = [];\n    const compositeProgress = new Common.Progress.CompositeProgress(progress);\n    const searchContentProgress = compositeProgress.createSubProgress();\n    const findMatchingFilesProgress = new Common.Progress.CompositeProgress(compositeProgress.createSubProgress());\n    for (const project of this.projects()) {\n      const weight = [...project.uiSourceCodes()].length;\n      const findMatchingFilesInProjectProgress = findMatchingFilesProgress.createSubProgress(weight);\n      const filesMatchingFileQuery = this.projectFilesMatchingFileQuery(project, searchConfig);\n      const promise =\n          project\n              .findFilesMatchingSearchRequest(searchConfig, filesMatchingFileQuery, findMatchingFilesInProjectProgress)\n              .then(this.processMatchingFilesForProject.bind(\n                  this, this.searchId, project, searchConfig, filesMatchingFileQuery));\n      promises.push(promise);\n    }\n\n    void Promise.all(promises).then(this.processMatchingFiles.bind(\n        this, this.searchId, searchContentProgress, this.searchFinishedCallback.bind(this, true)));\n  }\n\n  private projectFilesMatchingFileQuery(\n      project: Workspace.Workspace.Project, searchConfig: Workspace.SearchConfig.SearchConfig,\n      dirtyOnly?: boolean): Workspace.UISourceCode.UISourceCode[] {\n    const result = [];\n    for (const uiSourceCode of project.uiSourceCodes()) {\n      if (!uiSourceCode.contentType().isTextType()) {\n        continue;\n      }\n      if (Bindings.IgnoreListManager.IgnoreListManager.instance().isUserOrSourceMapIgnoreListedUISourceCode(\n              uiSourceCode)) {\n        continue;\n      }\n      const binding = Persistence.Persistence.PersistenceImpl.instance().binding(uiSourceCode);\n      if (binding && binding.network === uiSourceCode) {\n        continue;\n      }\n      if (dirtyOnly && !uiSourceCode.isDirty()) {\n        continue;\n      }\n      if (searchConfig.filePathMatchesFileQuery(\n              uiSourceCode.fullDisplayName() as Platform.DevToolsPath.UrlString |\n              Platform.DevToolsPath.EncodedPathString)) {\n        result.push(uiSourceCode);\n      }\n    }\n    result.sort(SourcesSearchScope.urlComparator);\n    return result;\n  }\n\n  private processMatchingFilesForProject(\n      searchId: number, project: Workspace.Workspace.Project, searchConfig: Workspace.SearchConfig.SearchConfig,\n      filesMatchingFileQuery: Workspace.UISourceCode.UISourceCode[],\n      filesWithPreliminaryResult:\n          Map<Workspace.UISourceCode.UISourceCode, TextUtils.ContentProvider.SearchMatch[]|null>): void {\n    if (searchId !== this.searchId && this.searchFinishedCallback) {\n      this.searchFinishedCallback(false);\n      return;\n    }\n\n    let files = [...filesWithPreliminaryResult.keys()];\n    files.sort(SourcesSearchScope.urlComparator);\n    files = Platform.ArrayUtilities.intersectOrdered(files, filesMatchingFileQuery, SourcesSearchScope.urlComparator);\n    const dirtyFiles = this.projectFilesMatchingFileQuery(project, searchConfig, true);\n    files = Platform.ArrayUtilities.mergeOrdered(files, dirtyFiles, SourcesSearchScope.urlComparator);\n\n    const uiSourceCodes = [];\n    for (const uiSourceCode of files) {\n      const script = Bindings.DefaultScriptMapping.DefaultScriptMapping.scriptForUISourceCode(uiSourceCode);\n      if (script && !script.isAnonymousScript()) {\n        continue;\n      }\n      uiSourceCodes.push(uiSourceCode);\n    }\n    uiSourceCodes.sort(SourcesSearchScope.filesComparator);\n    this.searchResultCandidates = Platform.ArrayUtilities.mergeOrdered(\n        this.searchResultCandidates, uiSourceCodes, SourcesSearchScope.filesComparator);\n  }\n\n  private processMatchingFiles(searchId: number, progress: Common.Progress.Progress, callback: () => void): void {\n    if (searchId !== this.searchId && this.searchFinishedCallback) {\n      this.searchFinishedCallback(false);\n      return;\n    }\n\n    const files = this.searchResultCandidates;\n    if (!files.length) {\n      progress.done();\n      callback();\n      return;\n    }\n\n    progress.setTotalWork(files.length);\n\n    let fileIndex = 0;\n    const maxFileContentRequests = 20;\n    let callbacksLeft = 0;\n\n    for (let i = 0; i < maxFileContentRequests && i < files.length; ++i) {\n      scheduleSearchInNextFileOrFinish.call(this);\n    }\n\n    function searchInNextFile(this: SourcesSearchScope, uiSourceCode: Workspace.UISourceCode.UISourceCode): void {\n      if (uiSourceCode.isDirty()) {\n        contentLoaded.call(this, uiSourceCode, uiSourceCode.workingCopy());\n      } else {\n        void uiSourceCode.requestContent().then(deferredContent => {\n          contentLoaded.call(this, uiSourceCode, deferredContent.content || '');\n        });\n      }\n    }\n\n    function scheduleSearchInNextFileOrFinish(this: SourcesSearchScope): void {\n      if (fileIndex >= files.length) {\n        if (!callbacksLeft) {\n          progress.done();\n          callback();\n          return;\n        }\n        return;\n      }\n\n      ++callbacksLeft;\n      const uiSourceCode = files[fileIndex++];\n      window.setTimeout(searchInNextFile.bind(this, uiSourceCode), 0);\n    }\n\n    function contentLoaded(\n        this: SourcesSearchScope, uiSourceCode: Workspace.UISourceCode.UISourceCode, content: string): void {\n      progress.incrementWorked(1);\n      let matches: TextUtils.ContentProvider.SearchMatch[] = [];\n      const searchConfig = (this.searchConfig as Workspace.SearchConfig.SearchConfig);\n      const queries = searchConfig.queries();\n      if (content !== null) {\n        for (let i = 0; i < queries.length; ++i) {\n          const nextMatches = TextUtils.TextUtils.performSearchInContent(\n              content, queries[i], !searchConfig.ignoreCase(), searchConfig.isRegex());\n          matches = Platform.ArrayUtilities.mergeOrdered(\n              matches, nextMatches, TextUtils.ContentProvider.SearchMatch.comparator);\n        }\n        if (!searchConfig.queries().length) {\n          matches = [new TextUtils.ContentProvider.SearchMatch(0, (new TextUtils.Text.Text(content)).lineAt(0), 0, 0)];\n        }\n      }\n      if (matches && this.searchResultCallback) {\n        const searchResult = new FileBasedSearchResult(uiSourceCode, matches);\n        this.searchResultCallback(searchResult);\n      }\n\n      --callbacksLeft;\n      scheduleSearchInNextFileOrFinish.call(this);\n    }\n  }\n\n  stopSearch(): void {\n    ++this.searchId;\n  }\n}\n\nexport class FileBasedSearchResult implements Search.SearchScope.SearchResult {\n  private readonly uiSourceCode: Workspace.UISourceCode.UISourceCode;\n  private readonly searchMatches: TextUtils.ContentProvider.SearchMatch[];\n  constructor(\n      uiSourceCode: Workspace.UISourceCode.UISourceCode, searchMatches: TextUtils.ContentProvider.SearchMatch[]) {\n    this.uiSourceCode = uiSourceCode;\n    this.searchMatches = searchMatches;\n  }\n\n  label(): string {\n    return this.uiSourceCode.displayName();\n  }\n\n  description(): string {\n    return this.uiSourceCode.fullDisplayName();\n  }\n\n  matchesCount(): number {\n    return this.searchMatches.length;\n  }\n\n  matchLineContent(index: number): string {\n    return this.searchMatches[index].lineContent;\n  }\n\n  matchRevealable(index: number): Object {\n    const {lineNumber, columnNumber, matchLength} = this.searchMatches[index];\n    const range = new TextUtils.TextRange.TextRange(lineNumber, columnNumber, lineNumber, columnNumber + matchLength);\n    return new Workspace.UISourceCode.UILocationRange(this.uiSourceCode, range);\n  }\n\n  matchLabel(index: number): string {\n    return String(this.searchMatches[index].lineNumber + 1);\n  }\n\n  matchColumn(index: number): number {\n    return this.searchMatches[index].columnNumber;\n  }\n\n  matchLength(index: number): number {\n    return this.searchMatches[index].matchLength;\n  }\n}\n"]}