{"version":3,"file":"PropertyRenderer.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/PropertyRenderer.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {Printer} from '../../testing/PropertyParser.js';\nimport * as CodeMirror from '../../third_party/codemirror.next/codemirror.next.js';\n\nimport * as Elements from './elements.js';\n\ndescribeWithEnvironment('PropertyRenderer', () => {\n  describe('Renderer', () => {\n    function textFragments(nodes: Node[]): Array<string|null> {\n      return nodes.map(n => n.textContent);\n    }\n\n    it('parses text', () => {\n      // Prevent normaliztaion to get an accurate representation of the parser result.\n      sinon.stub(Element.prototype, 'normalize');\n      assert.deepStrictEqual(\n          textFragments(\n              Array.from(Elements.PropertyRenderer.Renderer.renderValueElement('--p', 'var(--v)', []).childNodes)),\n          ['var', '(', '--v', ')']);\n\n      assert.deepStrictEqual(\n          textFragments(Array.from(\n              Elements.PropertyRenderer.Renderer.renderValueElement('--p', '/* comments are text */ 1px solid 4', [])\n                  .childNodes)),\n          ['/* comments are text */', ' ', '1px', ' ', 'solid', ' ', '4']);\n      assert.deepStrictEqual(\n          textFragments(Array.from(\n              Elements.PropertyRenderer.Renderer\n                  .renderValueElement('--p', '2px var(--double, var(--fallback, black)) #32a1ce rgb(124 125 21 0)', [])\n                  .childNodes)),\n          [\n            '2px', ' ', 'var',     '(', '--double', ',', ' ',   'var', '(',   '--fallback', ',',  ' ', 'black', ')',\n            ')',   ' ', '#32a1ce', ' ', 'rgb',      '(', '124', ' ',   '125', ' ',          '21', ' ', '0',     ')',\n          ]);\n    });\n\n    const cssParser = CodeMirror.css.cssLanguage.parser;\n    it('reproduces the input if nothing matched', () => {\n      const property = '2px var(--double, var(--fallback, black)) #32a1ce rgb(124 125 21 0)';\n      const rule = `*{--property: ${property};}`;\n      const tree = cssParser.parse(rule).topNode;\n      const ast = new SDK.CSSPropertyParser.SyntaxTree(property, rule, tree);\n      const matchedResult = SDK.CSSPropertyParser.BottomUpTreeMatching.walk(ast, []);\n      const context = new Elements.PropertyRenderer.RenderingContext(ast, new Map(), matchedResult);\n      assert.deepStrictEqual(\n          textFragments(Elements.PropertyRenderer.Renderer.render(tree, context).nodes).join(''), rule,\n          Printer.walk(ast).get());\n    });\n\n    it('correctly renders subtrees', () => {\n      const property = '2px var(--double, var(--fallback, black)) #32a1ce rgb(124 125 21 0)';\n      const rule = `*{--property: ${property};}`;\n      const tree = cssParser.parse(rule).topNode.firstChild?.firstChild?.nextSibling?.firstChild?.nextSibling;\n      assert.exists(tree);\n      const ast = new SDK.CSSPropertyParser.SyntaxTree(property, rule, tree);\n      const matchedResult = SDK.CSSPropertyParser.BottomUpTreeMatching.walk(ast, []);\n      const context = new Elements.PropertyRenderer.RenderingContext(ast, new Map(), matchedResult);\n      assert.deepStrictEqual(\n          textFragments(Elements.PropertyRenderer.Renderer.render(tree, context).nodes).join(''), property,\n          Printer.walk(ast).get());\n    });\n\n    it('renders trailing comments', () => {\n      const property = '/* color: red */ blue /* color: red */';\n      assert.strictEqual(\n          textFragments(\n              Array.from(Elements.PropertyRenderer.Renderer.renderValueElement('--p', property, []).childNodes))\n              .join(''),\n          property);\n    });\n\n    it('renders malformed comments', () => {\n      const property = 'red /* foo: bar';\n      assert.strictEqual(\n          textFragments(\n              Array.from(Elements.PropertyRenderer.Renderer.renderValueElement('--p', property, []).childNodes))\n              .join(''),\n          property);\n    });\n  });\n});\n"]}