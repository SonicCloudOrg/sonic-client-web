{"version":3,"file":"DOMLinkifier.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/DOMLinkifier.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport domLinkifierStyles from './domLinkifier.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Text displayed when trying to create a link to a node in the UI, but the node\n   * location could not be found so we display this placeholder instead. Node refers to a DOM node.\n   * This should be translated if appropriate.\n   */\n  node: '<node>',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/elements/DOMLinkifier.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport const decorateNodeLabel = function(\n    node: SDK.DOMModel.DOMNode, parentElement: HTMLElement, options: Common.Linkifier.Options): void {\n  const originalNode = node;\n  const isPseudo = node.nodeType() === Node.ELEMENT_NODE && node.pseudoType();\n  if (isPseudo && node.parentNode) {\n    node = node.parentNode;\n  }\n\n  // Special case rendering the node links for view transition pseudo elements.\n  // We don't include the ancestor name in the node link because\n  // they always have the same ancestor. See crbug.com/340633630.\n  if (node.isViewTransitionPseudoNode()) {\n    const pseudoElement = parentElement.createChild('span', 'extra node-label-pseudo');\n    const viewTransitionPseudoText = `::${originalNode.pseudoType()}(${originalNode.pseudoIdentifier()})`;\n    UI.UIUtils.createTextChild(pseudoElement, viewTransitionPseudoText);\n    UI.Tooltip.Tooltip.install(parentElement, options.tooltip || viewTransitionPseudoText);\n    return;\n  }\n\n  const nameElement = parentElement.createChild('span', 'node-label-name');\n  if (options.textContent) {\n    nameElement.textContent = options.textContent;\n    UI.Tooltip.Tooltip.install(parentElement, options.tooltip || options.textContent);\n    return;\n  }\n\n  let title = node.nodeNameInCorrectCase();\n  nameElement.textContent = title;\n\n  const idAttribute = node.getAttribute('id');\n  if (idAttribute) {\n    const idElement = parentElement.createChild('span', 'node-label-id');\n    const part = '#' + idAttribute;\n    title += part;\n    UI.UIUtils.createTextChild(idElement, part);\n\n    // Mark the name as extra, since the ID is more important.\n    nameElement.classList.add('extra');\n  }\n\n  const classAttribute = node.getAttribute('class');\n  if (classAttribute) {\n    const classes = classAttribute.split(/\\s+/);\n    if (classes.length) {\n      const foundClasses = new Set<string>();\n      const classesElement = parentElement.createChild('span', 'extra node-label-class');\n      for (let i = 0; i < classes.length; ++i) {\n        const className = classes[i];\n        if (className && !foundClasses.has(className)) {\n          const part = '.' + className;\n          title += part;\n          UI.UIUtils.createTextChild(classesElement, part);\n          foundClasses.add(className);\n        }\n      }\n    }\n  }\n\n  if (isPseudo) {\n    const pseudoIdentifier = originalNode.pseudoIdentifier();\n    const pseudoElement = parentElement.createChild('span', 'extra node-label-pseudo');\n    let pseudoText = '::' + originalNode.pseudoType();\n    if (pseudoIdentifier) {\n      pseudoText += `(${pseudoIdentifier})`;\n    }\n\n    UI.UIUtils.createTextChild(pseudoElement, pseudoText);\n    title += pseudoText;\n  }\n  UI.Tooltip.Tooltip.install(parentElement, options.tooltip || title);\n};\n\nexport const linkifyNodeReference = function(\n    node: SDK.DOMModel.DOMNode|null, options: Common.Linkifier.Options|undefined = {\n      tooltip: undefined,\n      preventKeyboardFocus: undefined,\n      textContent: undefined,\n      isDynamicLink: false,\n    }): Node {\n  if (!node) {\n    return document.createTextNode(i18nString(UIStrings.node));\n  }\n\n  const root = document.createElement('span');\n  root.classList.add('monospace');\n  const shadowRoot =\n      UI.UIUtils.createShadowRootWithCoreStyles(root, {cssFile: [domLinkifierStyles], delegatesFocus: undefined});\n  const link = (shadowRoot.createChild('button', 'node-link text-button link-style') as HTMLButtonElement);\n  link.classList.toggle('dynamic-link', options.isDynamicLink);\n  link.setAttribute('jslog', `${VisualLogging.link('node').track({click: true, keydown: 'Enter'})}`);\n\n  decorateNodeLabel(node, link, options);\n\n  link.addEventListener('click', () => {\n    void Common.Revealer.reveal(node, false);\n    return false;\n  }, false);\n  link.addEventListener('mouseover', node.highlight.bind(node, undefined), false);\n  link.addEventListener('mouseleave', () => SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight(), false);\n\n  if (options.preventKeyboardFocus) {\n    link.tabIndex = -1;\n  }\n\n  return root;\n};\n\nexport const linkifyDeferredNodeReference = function(\n    deferredNode: SDK.DOMModel.DeferredDOMNode, options: Common.Linkifier.Options|undefined = {\n      tooltip: undefined,\n      preventKeyboardFocus: undefined,\n    }): Node {\n  const root = document.createElement('div');\n  const shadowRoot =\n      UI.UIUtils.createShadowRootWithCoreStyles(root, {cssFile: [domLinkifierStyles], delegatesFocus: undefined});\n  const link = (shadowRoot.createChild('button', 'node-link text-button link-style') as HTMLDivElement);\n  link.setAttribute('jslog', `${VisualLogging.link('node').track({click: true})}`);\n  link.createChild('slot');\n  link.addEventListener('click', deferredNode.resolve.bind(deferredNode, onDeferredNodeResolved), false);\n  link.addEventListener('mousedown', e => e.consume(), false);\n\n  if (options.preventKeyboardFocus) {\n    link.tabIndex = -1;\n  }\n\n  function onDeferredNodeResolved(node: SDK.DOMModel.DOMNode|null): void {\n    void Common.Revealer.reveal(node);\n  }\n\n  return root;\n};\n\nlet linkifierInstance: Linkifier;\n\nexport class Linkifier implements Common.Linkifier.Linkifier {\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): Linkifier {\n    const {forceNew} = opts;\n    if (!linkifierInstance || forceNew) {\n      linkifierInstance = new Linkifier();\n    }\n\n    return linkifierInstance;\n  }\n  linkify(object: Object, options?: Common.Linkifier.Options): Node {\n    if (object instanceof SDK.DOMModel.DOMNode) {\n      return linkifyNodeReference(object, options);\n    }\n    if (object instanceof SDK.DOMModel.DeferredDOMNode) {\n      return linkifyDeferredNodeReference(object, options);\n    }\n    throw new Error('Can\\'t linkify non-node');\n  }\n}\n"]}