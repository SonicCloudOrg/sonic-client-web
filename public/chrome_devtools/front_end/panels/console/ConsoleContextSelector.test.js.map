{"version":3,"file":"ConsoleContextSelector.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/console/ConsoleContextSelector.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport {\n  createTarget,\n} from '../../testing/EnvironmentHelpers.js';\nimport {\n  describeWithMockConnection,\n  dispatchEvent,\n} from '../../testing/MockConnection.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as Console from './console.js';\n\ndescribeWithMockConnection('ConsoleContextSelector', () => {\n  let target: SDK.Target.Target;\n  let subtarget: SDK.Target.Target;\n  let targetContext: SDK.RuntimeModel.ExecutionContext;\n  let subtargetContext: SDK.RuntimeModel.ExecutionContext;\n  let selector: Console.ConsoleContextSelector.ConsoleContextSelector;\n\n  beforeEach(() => {\n    selector = new Console.ConsoleContextSelector.ConsoleContextSelector();\n    target = createTarget();\n    subtarget = createTarget({parentTarget: target});\n    targetContext = createExecutionContext(target);\n    subtargetContext = createExecutionContext(subtarget);\n  });\n\n  let id = 0;\n\n  function createExecutionContext(target: SDK.Target.Target): SDK.RuntimeModel.ExecutionContext {\n    ++id;\n    dispatchEvent(target, 'Runtime.executionContextCreated', {\n      context: {\n        id,\n        origin: 'http://example.com',\n        name: `c${id}`,\n        uniqueId: `c${id}`,\n        auxData: {\n          frameId: 'f2',\n        },\n      },\n    });\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n    assert.exists(runtimeModel);\n    const executionContext = runtimeModel.executionContext(id);\n    assert.exists(executionContext);\n    return executionContext;\n  }\n\n  const tests = (inScope: boolean) => () => {\n    beforeEach(() => {\n      SDK.TargetManager.TargetManager.instance().setScopeTarget(inScope ? target : null);\n    });\n\n    it('creates drop-down with console context', () => {\n      assert.deepEqual([...selector.items], inScope ? [targetContext, subtargetContext] : []);\n\n      const subtarget2 = createTarget({parentTarget: target});\n      const subtarget2Context = createExecutionContext(subtarget2);\n      assert.deepEqual([...selector.items], inScope ? [targetContext, subtargetContext, subtarget2Context] : []);\n\n      const subtarget2Context2 = createExecutionContext(subtarget2);\n      assert.deepEqual(\n          [...selector.items], inScope ? [targetContext, subtargetContext, subtarget2Context, subtarget2Context2] : []);\n\n      subtarget2.dispose('');\n      assert.deepEqual([...selector.items], inScope ? [targetContext, subtargetContext] : []);\n    });\n\n    it('updates selected target when UI context flavor changes', () => {\n      assert.strictEqual(selector.toolbarItem().element.title, 'JavaScript context: Not selected');\n      UI.Context.Context.instance().setFlavor(SDK.RuntimeModel.ExecutionContext, targetContext);\n      assert.strictEqual(\n          selector.toolbarItem().element.title,\n          `JavaScript context: ${inScope ? 'c' + targetContext.id : 'Not selected'}`);\n      UI.Context.Context.instance().setFlavor(SDK.RuntimeModel.ExecutionContext, subtargetContext);\n      assert.strictEqual(\n          selector.toolbarItem().element.title,\n          `JavaScript context: ${inScope ? 'c' + subtargetContext.id : 'Not selected'}`);\n    });\n  };\n\n  describe('in scope', tests(true));\n  describe('out of scope', tests(false));\n\n  it('updates UI context flavor on selection', () => {\n    selector.itemSelected(targetContext);\n    assert.strictEqual(UI.Context.Context.instance().flavor(SDK.RuntimeModel.ExecutionContext), targetContext);\n    selector.itemSelected(subtargetContext);\n    assert.strictEqual(UI.Context.Context.instance().flavor(SDK.RuntimeModel.ExecutionContext), subtargetContext);\n  });\n});\n"]}