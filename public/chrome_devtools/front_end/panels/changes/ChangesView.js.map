{"version":3,"file":"ChangesView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/changes/ChangesView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Formatter from '../../models/formatter/formatter.js';\nimport type * as Workspace from '../../models/workspace/workspace.js';\nimport * as WorkspaceDiff from '../../models/workspace_diff/workspace_diff.js';\nimport {PanelUtils} from '../../panels/utils/utils.js';\nimport * as Diff from '../../third_party/diff/diff.js';\nimport * as DiffView from '../../ui/components/diff_view/diff_view.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {ChangesSidebar, Events} from './ChangesSidebar.js';\nimport changesViewStyles from './changesView.css.js';\n\nconst UIStrings = {\n  /**\n   *@description Text in Changes View of the Changes tab\n   */\n  noChanges: 'No changes',\n  /**\n   *@description Text in Changes View of the Changes tab\n   */\n  binaryData: 'Binary data',\n  /**\n   * @description Text in the Changes tab that indicates how many lines of code have changed in the\n   * selected file. An insertion refers to an added line of code. The (+) is a visual cue to indicate\n   * lines were added (not translatable).\n   */\n  sInsertions: '{n, plural, =1 {# insertion (+)} other {# insertions (+)}}',\n  /**\n   * @description Text in the Changes tab that indicates how many lines of code have changed in the\n   * selected file. A deletion refers to a removed line of code. The (-) is a visual cue to indicate\n   * lines were removed (not translatable).\n   */\n  sDeletions: '{n, plural, =1 {# deletion (-)} other {# deletions (-)}}',\n  /**\n   *@description Text for a button in the Changes tool that copies all the changes from the currently open file.\n   */\n  copy: 'Copy',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/changes/ChangesView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nfunction diffStats(diff: Diff.Diff.DiffArray): string {\n  const insertions =\n      diff.reduce((ins, token) => ins + (token[0] === Diff.Diff.Operation.Insert ? token[1].length : 0), 0);\n  const deletions =\n      diff.reduce((ins, token) => ins + (token[0] === Diff.Diff.Operation.Delete ? token[1].length : 0), 0);\n  const deletionText = i18nString(UIStrings.sDeletions, {n: deletions});\n  const insertionText = i18nString(UIStrings.sInsertions, {n: insertions});\n  return `${insertionText}, ${deletionText}`;\n}\n\nexport class ChangesView extends UI.Widget.VBox {\n  private emptyWidget: UI.EmptyWidget.EmptyWidget;\n  private readonly workspaceDiff: WorkspaceDiff.WorkspaceDiff.WorkspaceDiffImpl;\n  readonly changesSidebar: ChangesSidebar;\n  private selectedUISourceCode: Workspace.UISourceCode.UISourceCode|null;\n  #selectedSourceCodeFormattedMapping?: Formatter.ScriptFormatter.FormatterSourceMapping;\n  private readonly diffContainer: HTMLElement;\n  private readonly toolbar: UI.Toolbar.Toolbar;\n  private readonly diffStats: UI.Toolbar.ToolbarText;\n  private readonly diffView: DiffView.DiffView.DiffView;\n\n  constructor() {\n    super(true);\n\n    this.element.setAttribute('jslog', `${VisualLogging.panel('changes').track({resize: true})}`);\n\n    const splitWidget = new UI.SplitWidget.SplitWidget(true /* vertical */, false /* sidebar on left */);\n    const mainWidget = new UI.Widget.Widget();\n    splitWidget.setMainWidget(mainWidget);\n    splitWidget.show(this.contentElement);\n\n    this.emptyWidget = new UI.EmptyWidget.EmptyWidget('');\n    this.emptyWidget.show(mainWidget.element);\n\n    this.workspaceDiff = WorkspaceDiff.WorkspaceDiff.workspaceDiff();\n    this.changesSidebar = new ChangesSidebar(this.workspaceDiff);\n    this.changesSidebar.addEventListener(Events.SelectedUISourceCodeChanged, this.selectedUISourceCodeChanged, this);\n    splitWidget.setSidebarWidget(this.changesSidebar);\n\n    this.selectedUISourceCode = null;\n\n    this.diffContainer = mainWidget.element.createChild('div', 'diff-container');\n    UI.ARIAUtils.markAsTabpanel(this.diffContainer);\n    this.diffContainer.addEventListener('click', event => this.click(event));\n\n    this.diffView = this.diffContainer.appendChild(new DiffView.DiffView.DiffView());\n\n    this.toolbar = new UI.Toolbar.Toolbar('changes-toolbar', mainWidget.element);\n    this.toolbar.element.setAttribute('jslog', `${VisualLogging.toolbar()}`);\n    this.toolbar.appendToolbarItem(UI.Toolbar.Toolbar.createActionButtonForId('changes.revert'));\n    this.diffStats = new UI.Toolbar.ToolbarText('');\n    this.toolbar.appendToolbarItem(this.diffStats);\n\n    this.toolbar.appendToolbarItem(new UI.Toolbar.ToolbarSeparator());\n    this.toolbar.appendToolbarItem(UI.Toolbar.Toolbar.createActionButtonForId('changes.copy', {\n      showLabel: true,\n      label() {\n        return i18nString(UIStrings.copy);\n      },\n    }));\n\n    this.hideDiff(i18nString(UIStrings.noChanges));\n    this.selectedUISourceCodeChanged();\n  }\n\n  private selectedUISourceCodeChanged(): void {\n    this.revealUISourceCode(this.changesSidebar.selectedUISourceCode());\n    UI.ActionRegistry.ActionRegistry.instance()\n        .getAction('changes.copy')\n        .setEnabled(this.selectedUISourceCode?.contentType() === Common.ResourceType.resourceTypes.Stylesheet);\n  }\n\n  revert(): void {\n    const uiSourceCode = this.selectedUISourceCode;\n    if (!uiSourceCode) {\n      return;\n    }\n    void this.workspaceDiff.revertToOriginal(uiSourceCode);\n  }\n\n  async copy(): Promise<void> {\n    const uiSourceCode = this.selectedUISourceCode;\n    if (!uiSourceCode) {\n      return;\n    }\n    const diffResponse = await this.workspaceDiff.requestDiff(uiSourceCode, {shouldFormatDiff: true});\n    // Diff array with real diff will contain at least 2 lines.\n    if (!diffResponse || diffResponse?.diff.length < 2) {\n      return;\n    }\n    const changes = await PanelUtils.formatCSSChangesFromDiff(diffResponse.diff);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(changes);\n  }\n\n  private click(event: MouseEvent): void {\n    if (!this.selectedUISourceCode) {\n      return;\n    }\n\n    for (const target of event.composedPath()) {\n      if (!(target instanceof HTMLElement)) {\n        continue;\n      }\n      const selection = target.ownerDocument.getSelection();\n      if (selection?.toString()) {\n        // We abort source revelation when user has text selection.\n        break;\n      }\n      if (target.classList.contains('diff-line-content') && target.hasAttribute('data-line-number')) {\n        let lineNumber = Number(target.dataset.lineNumber) - 1;\n        // Unfortunately, caretRangeFromPoint is broken in shadow\n        // roots, which makes determining the character offset more\n        // work than justified here.\n        if (this.#selectedSourceCodeFormattedMapping) {\n          lineNumber = this.#selectedSourceCodeFormattedMapping.formattedToOriginal(lineNumber, 0)[0];\n        }\n        void Common.Revealer.reveal(this.selectedUISourceCode.uiLocation(lineNumber, 0), false);\n        event.consume(true);\n        break;\n      } else if (target.classList.contains('diff-listing')) {\n        break;\n      }\n    }\n  }\n\n  private revealUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode|null): void {\n    if (this.selectedUISourceCode === uiSourceCode) {\n      return;\n    }\n\n    if (this.selectedUISourceCode) {\n      this.workspaceDiff.unsubscribeFromDiffChange(this.selectedUISourceCode, this.refreshDiff, this);\n    }\n    if (uiSourceCode && this.isShowing()) {\n      this.workspaceDiff.subscribeToDiffChange(uiSourceCode, this.refreshDiff, this);\n    }\n\n    this.selectedUISourceCode = uiSourceCode;\n    void this.refreshDiff();\n  }\n\n  override wasShown(): void {\n    UI.Context.Context.instance().setFlavor(ChangesView, this);\n    this.registerCSSFiles([changesViewStyles]);\n    super.wasShown();\n    void this.refreshDiff();\n  }\n\n  override willHide(): void {\n    super.willHide();\n    UI.Context.Context.instance().setFlavor(ChangesView, null);\n  }\n\n  private async refreshDiff(): Promise<void> {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    if (!this.selectedUISourceCode) {\n      this.renderDiffRows();\n      return;\n    }\n    const uiSourceCode = this.selectedUISourceCode;\n    if (!uiSourceCode.contentType().isTextType()) {\n      this.hideDiff(i18nString(UIStrings.binaryData));\n      return;\n    }\n    const diffResponse = await this.workspaceDiff.requestDiff(uiSourceCode, {shouldFormatDiff: true});\n    if (this.selectedUISourceCode !== uiSourceCode) {\n      return;\n    }\n    this.#selectedSourceCodeFormattedMapping = diffResponse?.formattedCurrentMapping;\n    this.renderDiffRows(diffResponse?.diff);\n  }\n\n  private hideDiff(message: string): void {\n    this.diffStats.setText('');\n    this.toolbar.setEnabled(false);\n    this.diffContainer.style.display = 'none';\n    this.emptyWidget.text = message;\n    this.emptyWidget.showWidget();\n  }\n\n  private renderDiffRows(diff?: Diff.Diff.DiffArray): void {\n    if (!diff || (diff.length === 1 && diff[0][0] === Diff.Diff.Operation.Equal)) {\n      this.hideDiff(i18nString(UIStrings.noChanges));\n    } else {\n      this.diffStats.setText(diffStats(diff));\n      this.toolbar.setEnabled(true);\n      this.emptyWidget.hideWidget();\n      const mimeType = (this.selectedUISourceCode as Workspace.UISourceCode.UISourceCode).mimeType();\n      this.diffContainer.style.display = 'block';\n      this.diffView.data = {diff, mimeType};\n    }\n  }\n}\n\nexport class ActionDelegate implements UI.ActionRegistration.ActionDelegate {\n  handleAction(context: UI.Context.Context, actionId: string): boolean {\n    const changesView = context.flavor(ChangesView);\n    if (changesView === null) {\n      return false;\n    }\n    switch (actionId) {\n      case 'changes.revert':\n        changesView.revert();\n        return true;\n      case 'changes.copy':\n        void changesView.copy();\n        return true;\n    }\n    return false;\n  }\n}\n"]}