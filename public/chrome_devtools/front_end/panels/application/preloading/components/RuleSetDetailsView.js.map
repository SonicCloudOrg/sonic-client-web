{"version":3,"file":"RuleSetDetailsView.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/RuleSetDetailsView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assertNotNullOrUndefined} from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport * as CodeMirror from '../../../../third_party/codemirror.next/codemirror.next.js';\nimport * as CodeHighlighter from '../../../../ui/components/code_highlighter/code_highlighter.js';\nimport * as IconButton from '../../../../ui/components/icon_button/icon_button.js';\nimport * as LegacyWrapper from '../../../../ui/components/legacy_wrapper/legacy_wrapper.js';\nimport * as Coordinator from '../../../../ui/components/render_coordinator/render_coordinator.js';\nimport * as TextEditor from '../../../../ui/components/text_editor/text_editor.js';\nimport type * as UI from '../../../../ui/legacy/legacy.js';\nimport * as LitHtml from '../../../../ui/lit-html/lit-html.js';\n\nimport ruleSetDetailsViewStyles from './RuleSetDetailsView.css.js';\n\ntype RuleSet = Protocol.Preload.RuleSet;\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\nconst codeMirrorJsonType = await CodeHighlighter.CodeHighlighter.languageFromMIME('application/json');\n\nexport type RuleSetDetailsViewData = RuleSet|null;\n\nexport class RuleSetDetailsView extends LegacyWrapper.LegacyWrapper.WrappableComponent<UI.Widget.VBox> {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #data: RuleSetDetailsViewData = null;\n  #editorState?: CodeMirror.EditorState;\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [ruleSetDetailsViewStyles];\n  }\n\n  set data(data: RuleSetDetailsViewData) {\n    this.#data = data;\n    void this.#render();\n  }\n\n  async #render(): Promise<void> {\n    await coordinator.write('RuleSetDetailsView render', () => {\n      if (this.#data === null) {\n        LitHtml.render(LitHtml.nothing, this.#shadow, {host: this});\n        return;\n      }\n\n      // Disabled until https://crbug.com/1079231 is fixed.\n      // clang-format off\n      LitHtml.render(LitHtml.html`\n        <div class=\"content\">\n          <div class=\"ruleset-header\" id=\"ruleset-url\">${this.#data?.url || SDK.TargetManager.TargetManager.instance().inspectedURL()}</div>\n          ${this.#maybeError()}\n        </div>\n        <div class=\"text-ellipsis\">\n          ${this.#renderSource()}\n        </div>\n      `, this.#shadow, {host: this});\n      // clang-format on\n    });\n  }\n\n  // TODO(https://crbug.com/1425354): Support i18n.\n  #maybeError(): LitHtml.LitTemplate {\n    assertNotNullOrUndefined(this.#data);\n\n    if (this.#data.errorMessage === undefined) {\n      return LitHtml.nothing;\n    }\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    return LitHtml.html`\n      <div class=\"ruleset-header\">\n        <${IconButton.Icon.Icon.litTagName}\n          .data=${{\n            iconName: 'cross-circle',\n            color: 'var(--icon-error)',\n            width: '16px',\n            height: '16px',\n          } as IconButton.Icon.IconData}>\n        </${IconButton.Icon.Icon.litTagName}>\n        <span id=\"error-message-text\">${this.#data.errorMessage}</span>\n      </div>\n    `;\n    // clang-format on\n  }\n\n  #renderSource(): LitHtml.LitTemplate {\n    this.#editorState = CodeMirror.EditorState.create({\n      doc: this.#data?.sourceText,\n      extensions: [\n        TextEditor.Config.baseConfiguration(this.#data?.sourceText || ''),\n        CodeMirror.lineNumbers(),\n        CodeMirror.EditorState.readOnly.of(true),\n        codeMirrorJsonType as CodeMirror.Extension,\n        CodeMirror.syntaxHighlighting(CodeHighlighter.CodeHighlighter.highlightStyle),\n      ],\n    });\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    // TODO(https://crbug.com/1425354): Add Raw button.\n      return LitHtml.html`\n        <${TextEditor.TextEditor.TextEditor.litTagName} .style.flexGrow = '1' .state=${\n          this.#editorState\n        }></${TextEditor.TextEditor.TextEditor.litTagName}>\n      `;\n    // clang-format on\n  }\n}\n\ncustomElements.define('devtools-resources-rulesets-details-view', RuleSetDetailsView);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-resources-rulesets-details-view': RuleSetDetailsView;\n  }\n}\n"]}