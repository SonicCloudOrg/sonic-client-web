{"version":3,"file":"PreloadingMismatchedHeadersGrid.test.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/PreloadingMismatchedHeadersGrid.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Platform from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport * as Protocol from '../../../../generated/protocol.js';\nimport {assertGridContents} from '../../../../testing/DataGridHelpers.js';\nimport {\n  renderElementIntoDOM,\n} from '../../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../../testing/EnvironmentHelpers.js';\nimport * as Coordinator from '../../../../ui/components/render_coordinator/render_coordinator.js';\n\nimport * as PreloadingComponents from './components.js';\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\nasync function renderPreloadingMismatchedHeadersGrid(data: SDK.PreloadingModel.PrerenderAttempt): Promise<HTMLElement> {\n  const component = new PreloadingComponents.PreloadingMismatchedHeadersGrid.PreloadingMismatchedHeadersGrid();\n  component.data = data;\n  renderElementIntoDOM(component);\n  assert.isNotNull(component.shadowRoot);\n  await coordinator.done();\n\n  return component;\n}\n\nasync function testPreloadingMismatchedHeadersGrid(\n    recievedMismatchedHeaders: Protocol.Preload.PrerenderMismatchedHeaders[], rowExpected: string[][]): Promise<void> {\n  const data: SDK.PreloadingModel.PrerenderAttempt = {\n    action: Protocol.Preload.SpeculationAction.Prerender,\n    key: {\n      loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n      action: Protocol.Preload.SpeculationAction.Prerender,\n      url: 'https://example.com/prerendered.html' as Platform.DevToolsPath.UrlString,\n    },\n    status: SDK.PreloadingModel.PreloadingStatus.Failure,\n    prerenderStatus: Protocol.Preload.PrerenderFinalStatus.ActivationNavigationParameterMismatch,\n    disallowedMojoInterface: null,\n    mismatchedHeaders: recievedMismatchedHeaders as Protocol.Preload.PrerenderMismatchedHeaders[],\n    ruleSetIds: ['ruleSetId:1'] as Protocol.Preload.RuleSetId[],\n    nodeIds: [1] as Protocol.DOM.BackendNodeId[],\n  };\n\n  const component = await renderPreloadingMismatchedHeadersGrid(data);\n  assert.isNotNull(component.shadowRoot);\n\n  assertGridContents(\n      component,\n      ['Header name', 'Value in initial navigation', 'Value in activation navigation'],\n      rowExpected,\n  );\n}\n\ndescribeWithEnvironment('PreloadingMismatchedHeadersGrid', () => {\n  it('one mismatched header without missing', async () => {\n    await testPreloadingMismatchedHeadersGrid(\n        [\n          {\n            headerName: 'sec-ch-ua-platform' as string,\n            initialValue: 'Linux' as string,\n            activationValue: 'Android' as string,\n          },\n        ],\n        [\n          ['sec-ch-ua-platform', 'Linux', 'Android'],\n        ],\n    );\n  });\n\n  it('one mismatched header with an initial value missing', async () => {\n    await testPreloadingMismatchedHeadersGrid(\n        [\n          {\n            headerName: 'sec-ch-ua-platform' as string,\n            initialValue: undefined,\n            activationValue: 'Android' as string,\n          },\n        ],\n        [\n          ['sec-ch-ua-platform', '(missing)', 'Android'],\n        ],\n    );\n  });\n\n  it('one mismatched header with an activation missing', async () => {\n    await testPreloadingMismatchedHeadersGrid(\n        [\n          {\n            headerName: 'sec-ch-ua-platform' as string,\n            initialValue: 'Linux' as string,\n            activationValue: undefined,\n          },\n        ],\n        [\n          ['sec-ch-ua-platform', 'Linux', '(missing)'],\n        ],\n    );\n  });\n\n  it('multiple mismatched header with one of the value missing', async () => {\n    await testPreloadingMismatchedHeadersGrid(\n        [\n          {\n            headerName: 'sec-ch-ua' as string,\n            initialValue: '\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"' as string,\n            activationValue: undefined,\n          },\n          {\n            headerName: 'sec-ch-ua-mobile' as string,\n            initialValue: '?0' as string,\n            activationValue: '?1' as string,\n          },\n        ],\n        [\n          ['sec-ch-ua', '\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"', '(missing)'],\n          ['sec-ch-ua-mobile', '?0', '?1'],\n        ],\n    );\n  });\n\n  it('multiple mismatched header with one of each value missing', async () => {\n    await testPreloadingMismatchedHeadersGrid(\n        [\n          {\n            headerName: 'sec-ch-ua' as string,\n            initialValue: '\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"' as string,\n            activationValue: undefined,\n          },\n          {\n            headerName: 'sec-ch-ua-mobile' as string,\n            initialValue: undefined,\n            activationValue: '?1' as string,\n          },\n          {\n            headerName: 'sec-ch-ua-platform' as string,\n            initialValue: 'Linux' as string,\n            activationValue: undefined,\n          },\n        ],\n        [\n          ['sec-ch-ua', '\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"', '(missing)'],\n          ['sec-ch-ua-mobile', '(missing)', '?1'],\n          ['sec-ch-ua-platform', 'Linux', '(missing)'],\n        ],\n    );\n  });\n});\n"]}