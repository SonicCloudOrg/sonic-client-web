{"version":3,"file":"SharedStorageMetadataView.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/SharedStorageMetadataView.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAG7B,OAAO,EACL,kBAAkB,EAClB,+BAA+B,EAC/B,yBAAyB,EACzB,oBAAoB,GACrB,MAAM,gCAAgC,CAAC;AACxC,OAAO,EAAC,kBAAkB,EAAC,MAAM,wCAAwC,CAAC;AAC1E,OAAO,KAAK,WAAW,MAAM,iEAAiE,CAAC;AAC/F,OAAO,KAAK,UAAU,MAAM,mDAAmD,CAAC;AAEhF,OAAO,KAAK,qBAAqB,MAAM,iBAAiB,CAAC;AAEzD,MAAM,WAAW,GAAG,WAAW,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,QAAQ,EAAE,CAAC;AAE/E,SAAS,QAAQ,CAAC,MAAc,EAAE,QAAgD,EAAE,WAAiC;IACnH,OAAO,IAAI,qBAAqB,CAAC,yBAAyB,CAAC,yBAAyB,CAChF;QACE,WAAW,EAAE,KAAK,IAAI,EAAE,CAAC,QAAQ;QACjC,WAAW,EAAE,WAAW,IAAI,CAAC,KAAK,IAAI,EAAE,GAAE,CAAC,CAAC;KAC7C,EACD,MAAM,CAAC,CAAC;AACd,CAAC;AAED,kBAAkB,CAAC,2BAA2B,EAAE,GAAG,EAAE;IACnD,EAAE,CAAC,sBAAsB,EAAE,KAAK,IAAI,EAAE;QACpC,MAAM,SAAS,GAAG,QAAQ,CAAC,gBAAgB,EAAE;YAC3C,YAAY,EAAE,EAAqC;YACnD,MAAM,EAAE,CAAC;YACT,eAAe,EAAE,GAAG;YACpB,SAAS,EAAE,GAAG;SACf,CAAC,CAAC;QACH,oBAAoB,CAAC,SAAS,CAAC,CAAC;QAEhC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QACvC,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QACzB,MAAM,MAAM,GAAG,yBAAyB,CAAC,SAAS,EAAE,iBAAiB,EAAE,UAAU,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QAErG,MAAM,EAAC,WAAW,EAAC,GAAG,MAAM,CAAC,UAAW,CAAC,aAAa,CAAC,eAAe,CAAE,CAAC;QACzE,MAAM,CAAC,WAAW,CAAC,WAAW,EAAE,gBAAgB,CAAC,CAAC;IACpD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;QAC9C,MAAM,SAAS,GAAG,QAAQ,CAAC,gBAAgB,EAAE;YAC3C,YAAY,EAAE,EAAqC;YACnD,MAAM,EAAE,CAAC;YACT,eAAe,EAAE,GAAG;YACpB,SAAS,EAAE,GAAG;SACf,CAAC,CAAC;QACH,oBAAoB,CAAC,SAAS,CAAC,CAAC;QAEhC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QACvC,MAAM,WAAW,CAAC,IAAI,CAAC,EAAC,WAAW,EAAE,IAAI,EAAC,CAAC,CAAC;QAE5C,MAAM,IAAI,GAAG,+BAA+B,CAAC,SAAS,CAAC,UAAU,EAAE,qBAAqB,CAAC,CAAC;QAC1F,MAAM,CAAC,SAAS,CAAC,IAAI,EAAE;YACrB,QAAQ;YACR,eAAe;YACf,mBAAmB;YACnB,sBAAsB;YACtB,kCAAkC;SACnC,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,+BAA+B,CAAC,SAAS,CAAC,UAAU,EAAE,uBAAuB,CAAC,CAAC;QAC9F,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE;YACvB,gBAAgB;YAChB,CAAC,IAAI,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,cAAc,EAAE;YACrC,GAAG;YACH,KAAK;YACL,KAAK;SACN,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,yCAAyC,EAAE,KAAK,IAAI,EAAE;QACvD,MAAM,SAAS,GAAG,QAAQ,CAAC,EAAE,EAAE,EAA4C,CAAC,CAAC;QAC7E,oBAAoB,CAAC,SAAS,CAAC,CAAC;QAEhC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;QACvC,MAAM,WAAW,CAAC,IAAI,CAAC,EAAC,WAAW,EAAE,IAAI,EAAC,CAAC,CAAC;QAE5C,MAAM,IAAI,GAAG,+BAA+B,CAAC,SAAS,CAAC,UAAU,EAAE,qBAAqB,CAAC,CAAC;QAC1F,MAAM,CAAC,SAAS,CAAC,IAAI,EAAE;YACrB,QAAQ;YACR,eAAe;YACf,mBAAmB;YACnB,sBAAsB;YACtB,kCAAkC;SACnC,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,+BAA+B,CAAC,SAAS,CAAC,UAAU,EAAE,uBAAuB,CAAC,CAAC;QAC9F,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE;YACvB,EAAE;YACF,iBAAiB;YACjB,GAAG;YACH,GAAG;YACH,GAAG;SACJ,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,6BAA6B,EAAE,KAAK,IAAI,EAAE;QAC3C,MAAM,qBAAqB,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC;QAC1C,MAAM,SAAS,GAAG,QAAQ,CACtB,gBAAgB,EAAE;YAChB,YAAY,EAAE,EAAqC;YACnD,MAAM,EAAE,CAAC;YACT,eAAe,EAAE,GAAG;YACpB,SAAS,EAAE,GAAG;SACf,EACD,qBAAqB,CAAC,CAAC;QAC3B,oBAAoB,CAAC,SAAS,CAAC,CAAC;QAEhC,MAAM,WAAW,CAAC,IAAI,CAAC,EAAC,WAAW,EAAE,IAAI,EAAC,CAAC,CAAC;QAE5C,MAAM,oBAAoB,GAAG,SAAS,CAAC,UAAW,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;QACpF,MAAM,CAAC,UAAU,CAAC,oBAAoB,EAAE,WAAW,CAAC,CAAC;QACrD,kBAAkB,CAAC,oBAAoB,CAAC,CAAC;QAEzC,MAAM,CAAC,MAAM,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC;IAClD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Protocol from '../../../generated/protocol.js';\nimport {\n  dispatchClickEvent,\n  getCleanTextContentFromElements,\n  getElementWithinComponent,\n  renderElementIntoDOM,\n} from '../../../testing/DOMHelpers.js';\nimport {describeWithLocale} from '../../../testing/EnvironmentHelpers.js';\nimport * as Coordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\nimport * as ReportView from '../../../ui/components/report_view/report_view.js';\n\nimport * as ApplicationComponents from './components.js';\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\nfunction makeView(origin: string, metadata: Protocol.Storage.SharedStorageMetadata, resetBudget?: () => Promise<void>) {\n  return new ApplicationComponents.SharedStorageMetadataView.SharedStorageMetadataView(\n      {\n        getMetadata: async () => metadata,\n        resetBudget: resetBudget || (async () => {}),\n      },\n      origin);\n}\n\ndescribeWithLocale('SharedStorageMetadataView', () => {\n  it('renders with a title', async () => {\n    const component = makeView('https://a.test', {\n      creationTime: 10 as Protocol.Network.TimeSinceEpoch,\n      length: 4,\n      remainingBudget: 8.3,\n      bytesUsed: 200,\n    });\n    renderElementIntoDOM(component);\n\n    assert.isNotNull(component.shadowRoot);\n    await coordinator.done();\n    const report = getElementWithinComponent(component, 'devtools-report', ReportView.ReportView.Report);\n\n    const {textContent} = report.shadowRoot!.querySelector('.report-title')!;\n    assert.strictEqual(textContent, 'Shared storage');\n  });\n\n  it('renders report keys and values', async () => {\n    const component = makeView('https://a.test', {\n      creationTime: 10 as Protocol.Network.TimeSinceEpoch,\n      length: 4,\n      remainingBudget: 8.3,\n      bytesUsed: 200,\n    });\n    renderElementIntoDOM(component);\n\n    assert.isNotNull(component.shadowRoot);\n    await coordinator.done({waitForWork: true});\n\n    const keys = getCleanTextContentFromElements(component.shadowRoot, 'devtools-report-key');\n    assert.deepEqual(keys, [\n      'Origin',\n      'Creation Time',\n      'Number of Entries',\n      'Number of Bytes Used',\n      'Entropy Budget for Fenced Frames',\n    ]);\n\n    const values = getCleanTextContentFromElements(component.shadowRoot, 'devtools-report-value');\n    assert.deepEqual(values, [\n      'https://a.test',\n      (new Date(10 * 1e3)).toLocaleString(),\n      '4',\n      '200',\n      '8.3',\n    ]);\n  });\n\n  it('renders default view when data is empty', async () => {\n    const component = makeView('', {} as Protocol.Storage.SharedStorageMetadata);\n    renderElementIntoDOM(component);\n\n    assert.isNotNull(component.shadowRoot);\n    await coordinator.done({waitForWork: true});\n\n    const keys = getCleanTextContentFromElements(component.shadowRoot, 'devtools-report-key');\n    assert.deepEqual(keys, [\n      'Origin',\n      'Creation Time',\n      'Number of Entries',\n      'Number of Bytes Used',\n      'Entropy Budget for Fenced Frames',\n    ]);\n\n    const values = getCleanTextContentFromElements(component.shadowRoot, 'devtools-report-value');\n    assert.deepEqual(values, [\n      '',\n      'Not yet created',\n      '0',\n      '0',\n      '0',\n    ]);\n  });\n\n  it('renders reset budget button', async () => {\n    const resetBudgetHandlerSpy = sinon.spy();\n    const component = makeView(\n        'https://a.test', {\n          creationTime: 10 as Protocol.Network.TimeSinceEpoch,\n          length: 4,\n          remainingBudget: 8.3,\n          bytesUsed: 200,\n        },\n        resetBudgetHandlerSpy);\n    renderElementIntoDOM(component);\n\n    await coordinator.done({waitForWork: true});\n\n    const resetButtonComponent = component.shadowRoot!.querySelector('devtools-button');\n    assert.instanceOf(resetButtonComponent, HTMLElement);\n    dispatchClickEvent(resetButtonComponent);\n\n    assert.isTrue(resetBudgetHandlerSpy.calledOnce);\n  });\n});\n"]}