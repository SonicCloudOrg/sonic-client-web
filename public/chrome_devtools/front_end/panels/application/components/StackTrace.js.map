{"version":3,"file":"StackTrace.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/StackTrace.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport * as ExpandableList from '../../../ui/components/expandable_list/expandable_list.js';\nimport * as Components from '../../../ui/legacy/components/utils/utils.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\n\nimport stackTraceLinkButtonStyles from './stackTraceLinkButton.css.js';\nimport stackTraceRowStyles from './stackTraceRow.css.js';\n\nconst UIStrings = {\n  /**\n   *@description Error message stating that something went wrong when tring to render stack trace\n   */\n  cannotRenderStackTrace: 'Cannot render stack trace',\n  /**\n   *@description A link to show more frames in the stack trace if more are available. Never 0.\n   */\n  showSMoreFrames: '{n, plural, =1 {Show # more frame} other {Show # more frames}}',\n  /**\n   *@description A link to rehide frames that are by default hidden.\n   */\n  showLess: 'Show less',\n  /**\n   *@description Label for a stack trace. If a frame is created programmatically (i.e. via JavaScript), there is a\n   * stack trace for the line of code which caused the creation of the iframe. This is the stack trace we are showing here.\n   */\n  creationStackTrace: 'Frame Creation `Stack Trace`',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/application/components/StackTrace.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface StackTraceData {\n  frame: SDK.ResourceTreeModel.ResourceTreeFrame;\n  buildStackTraceRows: (\n      stackTrace: Protocol.Runtime.StackTrace,\n      target: SDK.Target.Target|null,\n      linkifier: Components.Linkifier.Linkifier,\n      tabStops: boolean|undefined,\n      updateCallback?: (arg0: (Components.JSPresentationUtils.StackTraceRegularRow|\n                               Components.JSPresentationUtils.StackTraceAsyncRow)[]) => void,\n      ) => (Components.JSPresentationUtils.StackTraceRegularRow | Components.JSPresentationUtils.StackTraceAsyncRow)[];\n}\n\ninterface StackTraceRowData {\n  stackTraceRowItem: Components.JSPresentationUtils.StackTraceRegularRow;\n}\n\nexport class StackTraceRow extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-stack-trace-row`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  #stackTraceRowItem: Components.JSPresentationUtils.StackTraceRegularRow|null = null;\n\n  set data(data: StackTraceRowData) {\n    this.#stackTraceRowItem = data.stackTraceRowItem;\n    this.#render();\n  }\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [stackTraceRowStyles];\n  }\n\n  #render(): void {\n    if (!this.#stackTraceRowItem) {\n      return;\n    }\n    LitHtml.render(\n        LitHtml.html`\n      <div class=\"stack-trace-row\">\n              <div class=\"stack-trace-function-name text-ellipsis\" title=${this.#stackTraceRowItem.functionName}>\n                ${this.#stackTraceRowItem.functionName}\n              </div>\n              <div class=\"stack-trace-source-location\">\n                ${\n            this.#stackTraceRowItem.link ?\n                LitHtml.html`<div class=\"text-ellipsis\">\\xA0@\\xA0${this.#stackTraceRowItem.link}</div>` :\n                LitHtml.nothing}\n              </div>\n            </div>\n    `,\n        this.#shadow, {host: this});\n  }\n}\n\ninterface StackTraceLinkButtonData {\n  onShowAllClick: () => void;\n  hiddenCallFramesCount: number;\n  expandedView: boolean;\n}\n\nexport class StackTraceLinkButton extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-stack-trace-link-button`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  #onShowAllClick: () => void = () => {};\n  #hiddenCallFramesCount: number|null = null;\n  #expandedView: boolean = false;\n\n  set data(data: StackTraceLinkButtonData) {\n    this.#onShowAllClick = data.onShowAllClick;\n    this.#hiddenCallFramesCount = data.hiddenCallFramesCount;\n    this.#expandedView = data.expandedView;\n    this.#render();\n  }\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [stackTraceLinkButtonStyles];\n  }\n\n  #render(): void {\n    if (!this.#hiddenCallFramesCount) {\n      return;\n    }\n    const linkText = this.#expandedView ? i18nString(UIStrings.showLess) :\n                                          i18nString(UIStrings.showSMoreFrames, {n: this.#hiddenCallFramesCount});\n    LitHtml.render(\n        LitHtml.html`\n      <div class=\"stack-trace-row\">\n          <button class=\"link\" @click=${() => this.#onShowAllClick()}>\n            ${linkText}\n          </button>\n        </div>\n    `,\n        this.#shadow, {host: this});\n  }\n}\n\nexport class StackTrace extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-resources-stack-trace`;\n\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  readonly #linkifier = new Components.Linkifier.Linkifier();\n  #stackTraceRows: (Components.JSPresentationUtils.StackTraceRegularRow|\n                    Components.JSPresentationUtils.StackTraceAsyncRow)[] = [];\n  #showHidden = false;\n\n  set data(data: StackTraceData) {\n    const frame = data.frame;\n    const {creationStackTrace, creationStackTraceTarget} = frame.getCreationStackTraceData();\n    if (creationStackTrace) {\n      this.#stackTraceRows = data.buildStackTraceRows(\n          creationStackTrace, creationStackTraceTarget, this.#linkifier, true,\n          this.#onStackTraceRowsUpdated.bind(this));\n    }\n    this.#render();\n  }\n\n  #onStackTraceRowsUpdated(stackTraceRows: (Components.JSPresentationUtils.StackTraceRegularRow|\n                                            Components.JSPresentationUtils.StackTraceAsyncRow)[]): void {\n    this.#stackTraceRows = stackTraceRows;\n    this.#render();\n  }\n\n  #onToggleShowAllClick(): void {\n    this.#showHidden = !this.#showHidden;\n    this.#render();\n  }\n\n  createRowTemplates(): LitHtml.TemplateResult[] {\n    const expandableRows = [];\n    let hiddenCallFramesCount = 0;\n    for (const item of this.#stackTraceRows) {\n      if (this.#showHidden || !item.ignoreListHide) {\n        if ('functionName' in item) {\n          expandableRows.push(LitHtml.html`\n          <${StackTraceRow.litTagName} data-stack-trace-row .data=${{\n            stackTraceRowItem: item,\n          } as StackTraceRowData}></${StackTraceRow.litTagName}>`);\n        }\n        if ('asyncDescription' in item) {\n          expandableRows.push(LitHtml.html`\n            <div>${item.asyncDescription}</div>\n          `);\n        }\n      }\n      if ('functionName' in item && item.ignoreListHide) {\n        hiddenCallFramesCount++;\n      }\n    }\n    if (hiddenCallFramesCount) {\n      // Disabled until https://crbug.com/1079231 is fixed.\n      // clang-format off\n      expandableRows.push(LitHtml.html`\n      <${StackTraceLinkButton.litTagName} data-stack-trace-row .data=${{onShowAllClick: this.#onToggleShowAllClick.bind(this), hiddenCallFramesCount, expandedView: this.#showHidden} as StackTraceLinkButtonData}></${StackTraceLinkButton.litTagName}>\n      `);\n      // clang-format on\n    }\n\n    return expandableRows;\n  }\n\n  #render(): void {\n    if (!this.#stackTraceRows.length) {\n      // Disabled until https://crbug.com/1079231 is fixed.\n      // clang-format off\n      LitHtml.render(\n        LitHtml.html`\n          <span>${i18nString(UIStrings.cannotRenderStackTrace)}</span>\n        `,\n        this.#shadow, {host: this});\n      return;\n    }\n\n    const expandableRows = this.createRowTemplates();\n    LitHtml.render(\n      LitHtml.html`\n        <${ExpandableList.ExpandableList.ExpandableList.litTagName} .data=${{\n          rows: expandableRows, title: i18nString(UIStrings.creationStackTrace),\n        } as ExpandableList.ExpandableList.ExpandableListData}>\n        jslog=${VisualLogging.tree()}>\n        </${ExpandableList.ExpandableList.ExpandableList.litTagName}>\n      `,\n      this.#shadow, {host: this});\n    // clang-format on\n  }\n}\n\ncustomElements.define('devtools-stack-trace-row', StackTraceRow);\ncustomElements.define('devtools-stack-trace-link-button', StackTraceLinkButton);\ncustomElements.define('devtools-resources-stack-trace', StackTrace);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-stack-trace-row': StackTraceRow;\n    'devtools-stack-trace-link-button': StackTraceLinkButton;\n    'devtools-resources-stack-trace': StackTrace;\n  }\n}\n"]}