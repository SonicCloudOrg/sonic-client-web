{"version":3,"file":"ReportsGrid.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/ReportsGrid.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Root from '../../../core/root/root.js';\nimport * as Protocol from '../../../generated/protocol.js';\nimport {getHeaderCells, getValuesOfAllBodyRows} from '../../../testing/DataGridHelpers.js';\nimport {\n  getElementWithinComponent,\n  renderElementIntoDOM,\n} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport * as DataGrid from '../../../ui/components/data_grid/data_grid.js';\nimport * as Coordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\n\nimport * as ApplicationComponents from './components.js';\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\nconst renderReportsGrid = async (data?: ApplicationComponents.ReportsGrid.ReportsGridData|null) => {\n  const component = new ApplicationComponents.ReportsGrid.ReportsGrid();\n  if (data) {\n    component.data = data;\n  }\n  renderElementIntoDOM(component);\n  assert.isNotNull(component.shadowRoot);\n  await coordinator.done();\n  if (!data) {\n    return component;\n  }\n\n  const controller = getElementWithinComponent(\n      component, 'devtools-data-grid-controller', DataGrid.DataGridController.DataGridController);\n  assert.isNotNull(controller.shadowRoot);\n  const datagrid = getElementWithinComponent(controller, 'devtools-data-grid', DataGrid.DataGrid.DataGrid);\n  assert.isNotNull(datagrid.shadowRoot);\n  return datagrid;\n};\n\nconst getHeaderText = (cell: HTMLTableCellElement) => {\n  const ret = cell.textContent?.trim() ||\n      cell.querySelector('devtools-resources-reports-grid-status-header')!.shadowRoot!.textContent!.trim();\n  return ret;\n};\n\ndescribeWithEnvironment('ReportsGrid', () => {\n  it('displays placeholder text if no data', async () => {\n    const component = await renderReportsGrid();\n\n    const placeholder = component.shadowRoot!.querySelector('.reporting-placeholder div');\n    assert.strictEqual(placeholder!.textContent, 'No reports to display');\n  });\n\n  it('renders grid with correct content', async () => {\n    const body = {\n      columnNumber: 8,\n      id: 'PrefixedStorageInfo',\n      lineNumber: 15,\n      message:\n          '\\'window.webkitStorageInfo\\' is deprecated. Please use \\'navigator.webkitTemporaryStorage\\' or \\'navigator.webkitPersistentStorage\\' instead.',\n      sourceFile: 'https://example.com/script.js',\n    };\n    const data = {\n      reports: [{\n        id: 'some_id' as Protocol.Network.ReportId,\n        initiatorUrl: 'https://example.com/script.js',\n        destination: 'main-endpoint',\n        type: 'deprecation',\n        timestamp: 1632747042.12696,\n        depth: 1,\n        completedAttempts: 0,\n        body: JSON.stringify(body),\n        status: Protocol.Network.ReportStatus.Queued,\n      }],\n    };\n\n    const dataGrid = await renderReportsGrid(data);\n    assert.isNotNull(dataGrid.shadowRoot);\n\n    const headerCells = getHeaderCells(dataGrid.shadowRoot);\n    const values = Array.from(headerCells, getHeaderText);\n    assert.deepEqual(values, ['URL', 'Type', 'Status', 'Destination', 'Generated at', 'Body']);\n\n    const rowValues = getValuesOfAllBodyRows(dataGrid.shadowRoot);\n    assert.strictEqual(rowValues[0][0], 'https://example.com/script.js', 'URL does not match');\n    assert.strictEqual(rowValues[0][1], 'deprecation', 'Type does not match');\n    assert.strictEqual(rowValues[0][2], 'Queued', 'Status does not match');\n    assert.strictEqual(rowValues[0][3], 'main-endpoint', 'Destination does not match');\n    assert.strictEqual(rowValues[0][5], JSON.stringify(JSON.stringify(body)), 'Body does not match');\n  });\n\n  it('renders ID column if experiment is enabled', async () => {\n    Root.Runtime.experiments.enableForTest('protocol-monitor');\n    const body = {\n      columnNumber: 8,\n      id: 'PrefixedStorageInfo',\n      lineNumber: 15,\n      message:\n          '\\'window.webkitStorageInfo\\' is deprecated. Please use \\'navigator.webkitTemporaryStorage\\' or \\'navigator.webkitPersistentStorage\\' instead.',\n      sourceFile: 'https://example.com/script.js',\n    };\n    const data = {\n      reports: [{\n        id: 'some_id' as Protocol.Network.ReportId,\n        initiatorUrl: 'https://example.com/script.js',\n        destination: 'main-endpoint',\n        type: 'deprecation',\n        timestamp: 1632747042.12696,\n        depth: 1,\n        completedAttempts: 0,\n        body: JSON.stringify(body),\n        status: Protocol.Network.ReportStatus.Queued,\n      }],\n    };\n\n    const dataGrid = await renderReportsGrid(data);\n    assert.isNotNull(dataGrid.shadowRoot);\n\n    const headerCells = getHeaderCells(dataGrid.shadowRoot);\n    const values = Array.from(headerCells, getHeaderText);\n    assert.deepEqual(values, ['ID', 'URL', 'Type', 'Status', 'Destination', 'Generated at', 'Body']);\n\n    const rowValues = getValuesOfAllBodyRows(dataGrid.shadowRoot);\n    assert.strictEqual(rowValues[0][0], 'some_id', 'ID does not match');\n    assert.strictEqual(rowValues[0][1], 'https://example.com/script.js', 'URL does not match');\n    assert.strictEqual(rowValues[0][2], 'deprecation', 'Type does not match');\n    assert.strictEqual(rowValues[0][3], 'Queued', 'Status does not match');\n    assert.strictEqual(rowValues[0][4], 'main-endpoint', 'Destination does not match');\n    assert.strictEqual(rowValues[0][6], JSON.stringify(JSON.stringify(body)), 'Body does not match');\n  });\n});\n"]}