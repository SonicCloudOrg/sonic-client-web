{"version":3,"file":"BackForwardCacheView.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/BackForwardCacheView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport * as Protocol from '../../../generated/protocol.js';\nimport {\n  dispatchClickEvent,\n  renderElementIntoDOM,\n} from '../../../testing/DOMHelpers.js';\nimport {createTarget} from '../../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../../testing/MockConnection.js';\nimport {getMainFrame, navigate} from '../../../testing/ResourceTreeHelpers.js';\nimport * as Coordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\nimport * as TreeOutline from '../../../ui/components/tree_outline/tree_outline.js';\n\nimport * as ApplicationComponents from './components.js';\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\ninterface NodeData {\n  text: string;\n  iconName?: string;\n}\n\ninterface Node {\n  treeNodeData: NodeData;\n  children?: Node[];\n}\n\nasync function renderBackForwardCacheView(): Promise<ApplicationComponents.BackForwardCacheView.BackForwardCacheView> {\n  const component = new ApplicationComponents.BackForwardCacheView.BackForwardCacheView();\n  renderElementIntoDOM(component);\n  await component.render();\n  assert.isNotNull(component.shadowRoot);\n  await coordinator.done();\n  return component;\n}\n\nasync function unpromisify(node: TreeOutline.TreeOutlineUtils.TreeNode<NodeData>): Promise<Node> {\n  const result: Node = {treeNodeData: node.treeNodeData};\n  if (node.children) {\n    const children = await node.children();\n    result.children = await Promise.all(children.map(child => unpromisify(child)));\n  }\n  return result;\n}\n\ndescribeWithMockConnection('BackForwardCacheView', () => {\n  let target: SDK.Target.Target;\n  let resourceTreeModel: SDK.ResourceTreeModel.ResourceTreeModel;\n\n  beforeEach(async () => {\n    const tabTarget = createTarget({type: SDK.Target.Type.Tab});\n    createTarget({parentTarget: tabTarget, subtype: 'prerender'});\n    target = createTarget({parentTarget: tabTarget});\n    resourceTreeModel =\n        target.model(SDK.ResourceTreeModel.ResourceTreeModel) as SDK.ResourceTreeModel.ResourceTreeModel;\n  });\n\n  it('updates BFCacheView on main frame navigation', async () => {\n    await renderBackForwardCacheView();\n    navigate(getMainFrame(target), {}, Protocol.Page.NavigationType.BackForwardCacheRestore);\n    await coordinator.done({waitForWork: true});\n  });\n\n  it('updates BFCacheView on BFCache detail update', async () => {\n    await renderBackForwardCacheView();\n    resourceTreeModel.dispatchEventToListeners(\n        SDK.ResourceTreeModel.Events.BackForwardCacheDetailsUpdated, getMainFrame(target));\n\n    await coordinator.done({waitForWork: true});\n  });\n\n  it('renders status if restored from BFCache', async () => {\n    resourceTreeModel.mainFrame = {\n      url: 'https://www.example.com/',\n      backForwardCacheDetails: {\n        restoredFromCache: true,\n        explanations: [],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n    const component = await renderBackForwardCacheView();\n    const renderedStatus = component.shadowRoot!.querySelector('devtools-report-section');\n    assert.strictEqual(renderedStatus?.textContent?.trim(), 'Successfully served from back/forward cache.');\n  });\n\n  it('renders explanations if not restorable from BFCache', async () => {\n    resourceTreeModel.mainFrame = {\n      url: 'https://www.example.com/',\n      backForwardCacheDetails: {\n        restoredFromCache: false,\n        explanations: [\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.WebLocks,\n          },\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.PageSupportNeeded,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.ServiceWorkerUnregistration,\n          },\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.Circumstantial,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.MainResourceHasCacheControlNoStore,\n          },\n        ],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n    const component = await renderBackForwardCacheView();\n    const sectionHeaders = component.shadowRoot!.querySelectorAll('devtools-report-section-header');\n    const sectionHeadersText = Array.from(sectionHeaders).map(sectionHeader => sectionHeader.textContent?.trim());\n    assert.deepStrictEqual(sectionHeadersText, ['Actionable', 'Pending Support', 'Not Actionable']);\n\n    const sections = component.shadowRoot!.querySelectorAll('devtools-report-section');\n    const sectionsText = Array.from(sections).map(section => section.textContent?.trim());\n    const expected = [\n      'Not served from back/forward cache: to trigger back/forward cache, use Chrome\\'s back/forward buttons, or use the test button below to automatically navigate away and back.',\n      'Test back/forward cache',\n      'ServiceWorker was unregistered while a page was in back/forward cache.',\n      'Pages that use WebLocks are not currently eligible for back/forward cache.',\n      'Pages whose main resource has cache-control:no-store cannot enter back/forward cache.',\n      'Learn more: back/forward cache eligibility',\n    ];\n    assert.deepStrictEqual(sectionsText, expected);\n  });\n\n  it('renders explanation tree', async () => {\n    resourceTreeModel.mainFrame = {\n      url: 'https://www.example.com/',\n      backForwardCacheDetails: {\n        restoredFromCache: false,\n        explanationsTree: {\n          url: 'https://www.example.com',\n          explanations: [{\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.WebLocks,\n          }],\n          children: [{\n            url: 'https://www.example.com/frame.html',\n            explanations: [{\n              type: Protocol.Page.BackForwardCacheNotRestoredReasonType.Circumstantial,\n              reason: Protocol.Page.BackForwardCacheNotRestoredReason.MainResourceHasCacheControlNoStore,\n            }],\n            children: [],\n          }],\n        },\n        explanations: [\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.WebLocks,\n          },\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.Circumstantial,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.MainResourceHasCacheControlNoStore,\n          },\n        ],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n    const component = await renderBackForwardCacheView();\n    const treeOutline = component.shadowRoot!.querySelector('devtools-tree-outline');\n    assert.instanceOf(treeOutline, TreeOutline.TreeOutline.TreeOutline);\n    assert.isNotNull(treeOutline.shadowRoot);\n\n    const treeData = await Promise.all(\n        treeOutline.data.tree.map(node => unpromisify(node as TreeOutline.TreeOutlineUtils.TreeNode<NodeData>)));\n\n    const expected = [\n      {\n        treeNodeData: {\n          text: '2 issues found in 2 frames.',\n        },\n        children: [\n          {\n            treeNodeData: {\n              text: '(2) https://www.example.com',\n              iconName: 'frame',\n            },\n            children: [\n              {\n                treeNodeData: {\n                  text: 'WebLocks',\n                },\n              },\n              {\n                treeNodeData: {\n                  text: '(1) https://www.example.com/frame.html',\n                  iconName: 'iframe',\n                },\n                children: [\n                  {\n                    treeNodeData: {\n                      text: 'MainResourceHasCacheControlNoStore',\n                    },\n                  },\n                ],\n              },\n            ],\n          },\n        ],\n      },\n    ];\n\n    assert.deepStrictEqual(treeData, expected);\n  });\n\n  it('renders blocking details if available', async () => {\n    resourceTreeModel.mainFrame = {\n      resourceForURL: () => null,\n      url: 'https://www.example.com/',\n      backForwardCacheDetails: {\n        restoredFromCache: false,\n        explanations: [\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.WebLocks,\n            details: [\n              {url: 'https://www.example.com/index.html', lineNumber: 10, columnNumber: 5},\n              {url: 'https://www.example.com/script.js', lineNumber: 15, columnNumber: 20},\n            ],\n          },\n        ],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n\n    const component = await renderBackForwardCacheView();\n    const sectionHeaders = component.shadowRoot!.querySelectorAll('devtools-report-section-header');\n    const sectionHeadersText = Array.from(sectionHeaders).map(sectionHeader => sectionHeader.textContent?.trim());\n    assert.deepStrictEqual(sectionHeadersText, ['Pending Support']);\n\n    const sections = component.shadowRoot!.querySelectorAll('devtools-report-section');\n    const sectionsText = Array.from(sections).map(section => section.textContent?.trim());\n    const expected = [\n      'Not served from back/forward cache: to trigger back/forward cache, use Chrome\\'s back/forward buttons, or use the test button below to automatically navigate away and back.',\n      'Test back/forward cache',\n      'Pages that use WebLocks are not currently eligible for back/forward cache.',\n      'Learn more: back/forward cache eligibility',\n    ];\n    assert.deepStrictEqual(sectionsText, expected);\n\n    const details = component.shadowRoot!.querySelector('.details-list devtools-expandable-list');\n    details!.shadowRoot!.querySelector('button')!.click();\n    const items = details!.shadowRoot!.querySelectorAll('.expandable-list-items .devtools-link');\n    const detailsText = Array.from(items).map(detail => detail.textContent?.trim());\n    assert.deepStrictEqual(detailsText, ['www.example.com/index.html:11:6', 'www.example.com/script.js:16:21']);\n  });\n\n  it('can handle delayed navigation history when testing for BFcache availability', async () => {\n    const entries = [\n      {\n        id: 5,\n        url: 'about:blank',\n        userTypedURL: 'about:blank',\n        title: '',\n        transitionType: Protocol.Page.TransitionType.Typed,\n      },\n      {\n        id: 8,\n        url: 'chrome://terms/',\n        userTypedURL: '',\n        title: '',\n        transitionType: Protocol.Page.TransitionType.Typed,\n      },\n    ];\n    const stub = sinon.stub();\n    stub.onCall(0).returns({entries, currentIndex: 0});\n    stub.onCall(1).returns({entries, currentIndex: 0});\n    stub.onCall(2).returns({entries, currentIndex: 0});\n    stub.onCall(3).returns({entries, currentIndex: 0});\n    stub.onCall(4).returns({entries, currentIndex: 1});\n    resourceTreeModel.navigationHistory = stub;\n\n    resourceTreeModel.navigate = (url: Platform.DevToolsPath.UrlString) => {\n      resourceTreeModel.frameNavigated({url} as unknown as Protocol.Page.Frame, undefined);\n      return Promise.resolve({frameId: '' as Protocol.Page.FrameId, getError(): undefined {}});\n    };\n    resourceTreeModel.navigateToHistoryEntry = (entry: Protocol.Page.NavigationEntry) => {\n      resourceTreeModel.frameNavigated({url: entry.url} as unknown as Protocol.Page.Frame, undefined);\n    };\n    const navigateToHistoryEntrySpy = sinon.spy(resourceTreeModel, 'navigateToHistoryEntry');\n    resourceTreeModel.storageKeyForFrame = () => Promise.resolve(null);\n\n    resourceTreeModel.mainFrame = {\n      url: 'about:blank',\n      backForwardCacheDetails: {\n        restoredFromCache: true,\n        explanations: [],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n    const component = await renderBackForwardCacheView();\n    const button = component.shadowRoot!.querySelector('[aria-label=\"Test back/forward cache\"]');\n    assert.instanceOf(button, HTMLElement);\n    dispatchClickEvent(button);\n\n    await new Promise<void>(resolve => {\n      let eventCounter = 0;\n      resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.FrameNavigated, () => {\n        if (++eventCounter === 2) {\n          resolve();\n        }\n      });\n    });\n    assert.isTrue(navigateToHistoryEntrySpy.calledOnceWithExactly(entries[0]));\n  });\n});\n"]}