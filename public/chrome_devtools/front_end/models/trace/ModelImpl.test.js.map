{"version":3,"file":"ModelImpl.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/trace/ModelImpl.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,EAAC,uBAAuB,EAAC,MAAM,qCAAqC,CAAC;AAC5E,OAAO,EAAC,WAAW,EAAC,MAAM,8BAA8B,CAAC;AACzD,OAAO,KAAK,UAAU,MAAM,mBAAmB,CAAC;AAEhD,uBAAuB,CAAC,YAAY,EAAE;IACpC,EAAE,CAAC,gDAAgD,EAAE,KAAK;QACxD,MAAM,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC;QAClE,MAAM,MAAM,GAAa,EAAE,CAAC;QAE5B,KAAK,CAAC,gBAAgB,CAAC,UAAU,CAAC,UAAU,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,GAAU,EAAE,EAAE;YACtF,MAAM,WAAW,GAAG,GAA6C,CAAC;YAClE,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;QACvF,+EAA+E;QAC/E,+DAA+D;QAC/D,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC;IAC/C,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,uEAAuE,EAAE,KAAK;QAC/E,MAAM,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC;QAClE,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,+BAA+B,CAAC,CAAC;QACjF,MAAM,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACzB,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;IACtC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,4FAA4F,EAAE,KAAK;QACpG,MAAM,KAAK,GAAG,IAAI,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC;YAC5C,SAAS,EAAE,UAAU,CAAC,QAAQ,CAAC,aAAa,CAAC,UAAU;SACxD,CAAC,CAAC;QACH,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,mBAAmB,CAAC,CAAC;QACrE,MAAM,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACzB,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC,CAAC;IACvF,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,kCAAkC,EAAE,KAAK;QAC1C,MAAM,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC;QAClE,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;QACjE,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,kCAAkC,CAAC,CAAC;QAEpF,MAAM,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACzB,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,MAAM,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACzB,KAAK,CAAC,cAAc,EAAE,CAAC;QAEvB,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;QACpC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;QACzC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3C,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,0BAA0B,EAAE,KAAK;QAClC,MAAM,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC;QAClE,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;QACjE,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,kCAAkC,CAAC,CAAC;QAEpF,MAAM,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACzB,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,MAAM,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACzB,KAAK,CAAC,cAAc,EAAE,CAAC;QAEvB,kCAAkC;QAClC,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;QACpC,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;QAC5B,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;QACpC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;QAEzC,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;QAC5B,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;QACpC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;QACxC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;IACxC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,mFAAmF,EAAE,KAAK;QAC3F,MAAM,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC;QAClE,MAAM,UAAU,GAAG;YACjB,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,qBAAqB,CAAC;YACxD,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,iBAAiB,CAAC;YACpD,gEAAgE;YAChE,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,iBAAiB,CAAC;YACpD,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,8BAA8B,CAAC;YACjE,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,eAAe,CAAC;SACnD,CAAC;QACF,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE,CAAC;YACnC,MAAM,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;YAC7B,KAAK,CAAC,cAAc,EAAE,CAAC;QACzB,CAAC;QACD,MAAM,eAAe,GAAG;YACtB,iBAAiB;YACjB,aAAa;YACb,aAAa;YACb,gBAAgB;YAChB,SAAS;SACV,CAAC;QACF,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,sBAAsB,EAAE,EAAE,eAAe,CAAC,CAAC;IACpE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,+CAA+C,EAAE,KAAK;QACvD,MAAM,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC;QAClE,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;QACjE,MAAM,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAEzB,4DAA4D;QAC5D,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC;QAErD,MAAM,iBAAiB,GAAG;YACxB,MAAM,EAAE;gBACN,GAAG,EAAE,CAAyC;gBAC9C,GAAG,EAAE,EAA0C;gBAC/C,KAAK,EAAE,EAA0C;aAClD;YACD,KAAK,EAAE,IAAI;SACZ,CAAC;QAEF,MAAM,oBAAoB,GAAG;YAC3B,aAAa,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC;YACpC,iBAAiB,EAAE,CAAC,KAAK,CAAC;SACoC,CAAC;QAEjE,MAAM,aAAa,GAAG;YACpB,oBAAoB;YACpB,iBAAiB;SAClB,CAAC;QAEF,KAAK,CAAC,qBAAqB,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC;QAC9C,wDAAwD;QACxD,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,aAAa,EAAE,aAAa,CAAC,CAAC;IACtE,CAAC,CAAC,CAAC;AAEL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {TraceLoader} from '../../testing/TraceLoader.js';\nimport * as TraceModel from '../trace/trace.js';\n\ndescribeWithEnvironment('TraceModel', function() {\n  it('dispatches an end event when the trace is done', async function() {\n    const model = TraceModel.TraceModel.Model.createWithAllHandlers();\n    const events: string[] = [];\n\n    model.addEventListener(TraceModel.TraceModel.ModelUpdateEvent.eventName, (evt: Event) => {\n      const updateEvent = evt as TraceModel.TraceModel.ModelUpdateEvent;\n      events.push(updateEvent.data.type);\n    });\n\n    await TraceLoader.rawEvents(this, 'basic.json.gz').then(events => model.parse(events));\n    // This trace is small, so there are no PROGRESS_UPDATE events, just a COMPLETE\n    // A larger trace would have 1+ PROGRESS_UPDATE events as well.\n    assert.deepStrictEqual(events, ['COMPLETE']);\n  });\n\n  it('supports parsing a generic trace that has no browser specific details', async function() {\n    const model = TraceModel.TraceModel.Model.createWithAllHandlers();\n    const file1 = await TraceLoader.rawEvents(this, 'generic-about-tracing.json.gz');\n    await model.parse(file1);\n    assert.strictEqual(model.size(), 1);\n  });\n\n  it('supports being given a set of handlers to run and will run just those and the Meta handler', async function() {\n    const model = new TraceModel.TraceModel.Model({\n      Animation: TraceModel.Handlers.ModelHandlers.Animations,\n    });\n    const file1 = await TraceLoader.rawEvents(this, 'animation.json.gz');\n    await model.parse(file1);\n    assert.deepEqual(Object.keys(model.traceParsedData(0) || {}), ['Meta', 'Animation']);\n  });\n\n  it('supports parsing multiple traces', async function() {\n    const model = TraceModel.TraceModel.Model.createWithAllHandlers();\n    const file1 = await TraceLoader.rawEvents(this, 'basic.json.gz');\n    const file2 = await TraceLoader.rawEvents(this, 'slow-interaction-keydown.json.gz');\n\n    await model.parse(file1);\n    model.resetProcessor();\n    await model.parse(file2);\n    model.resetProcessor();\n\n    assert.strictEqual(model.size(), 2);\n    assert.isNotNull(model.traceParsedData(0));\n    assert.isNotNull(model.traceInsights(0));\n    assert.isNotNull(model.traceParsedData(1));\n    assert.isNotNull(model.traceInsights(1));\n  });\n\n  it('supports deleting traces', async function() {\n    const model = TraceModel.TraceModel.Model.createWithAllHandlers();\n    const file1 = await TraceLoader.rawEvents(this, 'basic.json.gz');\n    const file2 = await TraceLoader.rawEvents(this, 'slow-interaction-keydown.json.gz');\n\n    await model.parse(file1);\n    model.resetProcessor();\n    await model.parse(file2);\n    model.resetProcessor();\n\n    // Test only one trace is deleted.\n    assert.strictEqual(model.size(), 2);\n    model.deleteTraceByIndex(0);\n    assert.strictEqual(model.size(), 1);\n    assert.isNotNull(model.traceParsedData(0));\n    assert.isNotNull(model.traceInsights(0));\n\n    model.deleteTraceByIndex(0);\n    assert.strictEqual(model.size(), 0);\n    assert.isNull(model.traceParsedData(0));\n    assert.isNull(model.traceInsights(0));\n  });\n\n  it('names traces using their origin and defaults to \"Trace n\" when no origin is found', async function() {\n    const model = TraceModel.TraceModel.Model.createWithAllHandlers();\n    const traceFiles = [\n      await TraceLoader.rawEvents(this, 'threejs-gpu.json.gz'),\n      await TraceLoader.rawEvents(this, 'web-dev.json.gz'),\n      // Process the previous trace again to test the trace sequencing\n      await TraceLoader.rawEvents(this, 'web-dev.json.gz'),\n      await TraceLoader.rawEvents(this, 'multiple-navigations.json.gz'),\n      await TraceLoader.rawEvents(this, 'basic.json.gz'),\n    ];\n    for (const traceFile of traceFiles) {\n      await model.parse(traceFile);\n      model.resetProcessor();\n    }\n    const expectedResults = [\n      'threejs.org (1)',\n      'web.dev (1)',\n      'web.dev (2)',\n      'google.com (1)',\n      'Trace 5',\n    ];\n    assert.deepEqual(model.getRecordingsAvailable(), expectedResults);\n  });\n\n  it('supports overriding modifications in metadata', async function() {\n    const model = TraceModel.TraceModel.Model.createWithAllHandlers();\n    const file1 = await TraceLoader.rawEvents(this, 'basic.json.gz');\n    await model.parse(file1);\n\n    // Make sure there are no modifications before any are added\n    assert.isUndefined(model.metadata(0)?.modifications);\n\n    const initialBreadcrumb = {\n      window: {\n        max: 0 as TraceModel.Types.Timing.MicroSeconds,\n        min: 10 as TraceModel.Types.Timing.MicroSeconds,\n        range: 10 as TraceModel.Types.Timing.MicroSeconds,\n      },\n      child: null,\n    };\n\n    const entriesModifications = {\n      hiddenEntries: ['r-1', 'r-2', 'r-3'],\n      expandableEntries: ['r-4'],\n    } as TraceModel.Types.File.Modifications['entriesModifications'];\n\n    const modifications = {\n      entriesModifications,\n      initialBreadcrumb,\n    };\n\n    model.overrideModifications(0, modifications);\n    // Make sure metadata contains overwritten modifications\n    assert.strictEqual(model.metadata(0)?.modifications, modifications);\n  });\n\n});\n"]}