{"version":3,"file":"PersistenceAction.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/persistence/PersistenceAction.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport {describeWithLocale} from '../../testing/EnvironmentHelpers.js';\nimport {expectCall} from '../../testing/ExpectStubCall.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Bindings from '../bindings/bindings.js';\nimport * as TextUtils from '../text_utils/text_utils.js';\nimport * as Workspace from '../workspace/workspace.js';\n\nimport * as Persistence from './persistence.js';\n\ndescribeWithLocale('ContextMenuProvider', () => {\n  beforeEach(() => {\n    // Rather then setting up a whole Workspace/BreakpointManager/TargetManager/... chain. Let's stub out the NetworkPersistenceManager.\n    sinon.stub(Persistence.NetworkPersistenceManager.NetworkPersistenceManager, 'instance')\n        .returns(sinon.createStubInstance(Persistence.NetworkPersistenceManager.NetworkPersistenceManager));\n    sinon.stub(Host.InspectorFrontendHost.InspectorFrontendHostInstance, 'isHostedMode').returns(false);\n    sinon.stub(Host.InspectorFrontendHost.InspectorFrontendHostInstance, 'showContextMenuAtPoint');\n    sinon.stub(Host.InspectorFrontendHost.InspectorFrontendHostInstance, 'close');\n  });\n\n  it('passes along the \"isEncoded\" flag to the FileManager for \"Save as\"', async () => {\n    const event = new Event('contextmenu');\n    sinon.stub(event, 'target').value(document);\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    const menuProvider = new Persistence.PersistenceActions.ContextMenuProvider();\n    const contentProvider: TextUtils.ContentProvider.ContentProvider = {\n      contentURL: () => 'https://example.com/sample.webp' as Platform.DevToolsPath.UrlString,\n      contentType: () => Common.ResourceType.resourceTypes\n                             .Document,  // Navigating a tab to an image will result in a document type for images.\n      requestContent: () => Promise.resolve({isEncoded: true, content: 'AGFzbQEAAAA='}),\n      requestContentData: () =>\n          Promise.resolve(new TextUtils.ContentData.ContentData('AGFzbQEAAAA=', true, 'image/webp')),\n      searchInContent: () => assert.fail('Not implemented'),\n    };\n\n    menuProvider.appendApplicableItems(event, contextMenu, contentProvider);\n    await contextMenu.show();\n    const saveItem = contextMenu.saveSection().items[0];\n    const saveStub = sinon.stub(Workspace.FileManager.FileManager.instance(), 'save');\n\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.dispatchEventToListeners(\n        Host.InspectorFrontendHostAPI.Events.ContextMenuItemSelected, saveItem.id());\n\n    assert.deepEqual(await expectCall(saveStub), [\n      'https://example.com/sample.webp' as Platform.DevToolsPath.UrlString, 'AGFzbQEAAAA=', true /* forceSaveAs */,\n      true, /* isBase64 */\n    ]);\n  });\n\n  it('can \"Save as\" WASM modules', async () => {\n    const event = new Event('contextmenu');\n    sinon.stub(event, 'target').value(document);\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    const menuProvider = new Persistence.PersistenceActions.ContextMenuProvider();\n    const uiSourceCode = sinon.createStubInstance(Workspace.UISourceCode.UISourceCode, {\n      contentURL: 'https://example.com/sample.wasm' as Platform.DevToolsPath.UrlString,\n      contentType: Common.ResourceType.resourceTypes.Script,\n    });\n    const stubProject = sinon.createStubInstance(\n        Bindings.ContentProviderBasedProject.ContentProviderBasedProject,\n        {type: Workspace.Workspace.projectTypes.Debugger});\n    uiSourceCode.project.returns(stubProject);\n    const stubWorkspaceBinding = sinon.createStubInstance(Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding);\n    sinon.stub(Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding, 'instance').returns(stubWorkspaceBinding);\n    const stubWasmScript = sinon.createStubInstance(\n        SDK.Script.Script, {getWasmBytecode: Promise.resolve(new Uint8Array([1, 2, 3, 4])), isWasm: true});\n    stubWorkspaceBinding.scriptsForUISourceCode.returns([stubWasmScript]);\n\n    menuProvider.appendApplicableItems(event, contextMenu, uiSourceCode);\n    await contextMenu.show();\n    const saveItem = contextMenu.saveSection().items[0];\n    const saveStub = sinon.stub(Workspace.FileManager.FileManager.instance(), 'save');\n\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.dispatchEventToListeners(\n        Host.InspectorFrontendHostAPI.Events.ContextMenuItemSelected, saveItem.id());\n\n    assert.deepEqual(await expectCall(saveStub), [\n      'https://example.com/sample.wasm' as Platform.DevToolsPath.UrlString, 'AQIDBA==', true /* forceSaveAs */,\n      true, /* isBase64 */\n    ]);\n  });\n});\n"]}