{"version":3,"file":"CookieDeprecationMetadataIssue.js","sourceRoot":"","sources":["../../../../../../front_end/models/issues_manager/CookieDeprecationMetadataIssue.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAIhD,OAAO,EAAC,KAAK,EAA2B,MAAM,YAAY,CAAC;AAG3D,MAAM,SAAS,GAAG;IAChB;;OAEG;IACH,2BAA2B,EAAE,6CAA6C;CAC3E,CAAC;AACF,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,yDAAyD,EAAE,SAAS,CAAC,CAAC;AAC/G,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AAEtE,oEAAoE;AACpE,MAAM,OAAO,8BAA+B,SAAQ,KAAK;IAC9C,aAAa,CAAwD;IAE9E,YACI,YAAmE,EAAE,WAAwC;QAC/G,2FAA2F;QAC3F,MAAM,SAAS,GAAG,2GAAoE,GAAG,GAAG,YAAY,CAAC,SAAS,CAAC;QACnH,KAAK,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;QAC9B,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;IACpC,CAAC;IAED,WAAW;QACT,yCAA2B;IAC7B,CAAC;IAED,cAAc;QACZ,MAAM,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,SAAS,KAAK,WAAW,CAAC,CAAC,CAAC,+BAA+B,CAAC,CAAC;YACjC,gCAAgC,CAAC;QAEjG,IAAI,UAAU,GAAG,EAAE,CAAC;QACpB,IAAI,IAAI,CAAC,aAAa,CAAC,gBAAgB,IAAI,IAAI,CAAC,aAAa,CAAC,gBAAgB,IAAI,CAAC,EAAE,CAAC;YACpF,UAAU,GAAG,gCAAgC,GAAG,IAAI,CAAC,aAAa,CAAC,gBAAgB;gBAC/E,sDAAsD,CAAC;QAC7D,CAAC;QAED,OAAO;YACL,IAAI,EAAE,QAAQ;YACd,aAAa,EAAE,IAAI,GAAG,CAAC;gBACrB,CAAC,4BAA4B,EAAE,UAAU,CAAC;aAC3C,CAAC;YACF,KAAK,EAAE;gBACL;oBACE,IAAI,EAAE,iFAAiF;oBACvF,SAAS,EAAE,UAAU,CAAC,SAAS,CAAC,2BAA2B,CAAC;iBAC7D;aACF;SACF,CAAC;IACJ,CAAC;IAED,OAAO;QACL,OAAO,IAAI,CAAC,aAAa,CAAC;IAC5B,CAAC;IAED,OAAO;QACL,uDAAgC;IAClC,CAAC;IAED,UAAU;QACR,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAC5C,CAAC;IAED,MAAM,CAAC,kBAAkB,CAAC,WAAwC,EAAE,cAA8C;QAEhH,MAAM,OAAO,GAAG,cAAc,CAAC,OAAO,CAAC,qCAAqC,CAAC;QAC7E,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,OAAO,CAAC,IAAI,CAAC,6DAA6D,CAAC,CAAC;YAC5E,OAAO,EAAE,CAAC;QACZ,CAAC;QACD,OAAO,CAAC,IAAI,8BAA8B,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC,CAAC;IACpE,CAAC;CACF","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nimport {Issue, IssueCategory, IssueKind} from './Issue.js';\nimport {type MarkdownIssueDescription} from './MarkdownIssueDescription.js';\n\nconst UIStrings = {\n  /**\n   * @description Label for a link for third-party cookie Issues.\n   */\n  thirdPartyPhaseoutExplained: 'Prepare for phasing out third-party cookies',\n};\nconst str_ = i18n.i18n.registerUIStrings('models/issues_manager/CookieDeprecationMetadataIssue.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\n// TODO(b/305738703): Move this issue into a warning on CookieIssue.\nexport class CookieDeprecationMetadataIssue extends Issue {\n  readonly #issueDetails: Protocol.Audits.CookieDeprecationMetadataIssueDetails;\n\n  constructor(\n      issueDetails: Protocol.Audits.CookieDeprecationMetadataIssueDetails, issuesModel: SDK.IssuesModel.IssuesModel) {\n    // Set a distinct code for ReadCookie and SetCookie issues, so they are grouped separately.\n    const issueCode = Protocol.Audits.InspectorIssueCode.CookieDeprecationMetadataIssue + '_' + issueDetails.operation;\n    super(issueCode, issuesModel);\n    this.#issueDetails = issueDetails;\n  }\n\n  getCategory(): IssueCategory {\n    return IssueCategory.Other;\n  }\n\n  getDescription(): MarkdownIssueDescription {\n    const fileName = this.#issueDetails.operation === 'SetCookie' ? 'cookieWarnMetadataGrantSet.md' :\n                                                                    'cookieWarnMetadataGrantRead.md';\n\n    let optOutText = '';\n    if (this.#issueDetails.isOptOutTopLevel && this.#issueDetails.optOutPercentage >= 0) {\n      optOutText = '\\n\\n (Top level site opt-out: ' + this.#issueDetails.optOutPercentage +\n          '% - [learn more](gracePeriodStagedControlExplainer))';\n    }\n\n    return {\n      file: fileName,\n      substitutions: new Map([\n        ['PLACEHOLDER_topleveloptout', optOutText],\n      ]),\n      links: [\n        {\n          link: 'https://developer.chrome.com/docs/privacy-sandbox/third-party-cookie-phase-out/',\n          linkTitle: i18nString(UIStrings.thirdPartyPhaseoutExplained),\n        },\n      ],\n    };\n  }\n\n  details(): Protocol.Audits.CookieDeprecationMetadataIssueDetails {\n    return this.#issueDetails;\n  }\n\n  getKind(): IssueKind {\n    return IssueKind.BreakingChange;\n  }\n\n  primaryKey(): string {\n    return JSON.stringify(this.#issueDetails);\n  }\n\n  static fromInspectorIssue(issuesModel: SDK.IssuesModel.IssuesModel, inspectorIssue: Protocol.Audits.InspectorIssue):\n      CookieDeprecationMetadataIssue[] {\n    const details = inspectorIssue.details.cookieDeprecationMetadataIssueDetails;\n    if (!details) {\n      console.warn('Cookie deprecation metadata issue without details received.');\n      return [];\n    }\n    return [new CookieDeprecationMetadataIssue(details, issuesModel)];\n  }\n}\n"]}