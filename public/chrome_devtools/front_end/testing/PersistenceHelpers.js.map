{"version":3,"file":"PersistenceHelpers.js","sourceRoot":"","sources":["../../../../../front_end/testing/PersistenceHelpers.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,0BAA0B,CAAC;AAKnD,OAAO,KAAK,SAAS,MAAM,kCAAkC,CAAC;AAE9D,OAAO,EACL,aAAa,GACd,MAAM,qBAAqB,CAAC;AAC7B,OAAO,EAAC,cAAc,EAAE,YAAY,EAAC,MAAM,0BAA0B,CAAC;AACtE,OAAO,EAAC,4BAA4B,EAAC,MAAM,0BAA0B,CAAC;AAEtE,wFAAwF;AACxF,6GAA6G;AAC7G,gGAAgG;AAChG,MAAM,UAAU,uCAAuC,CACnD,gBAIC,EACD,gBAAiD,EAAE,OAAe,EAAE,MAAyB;IAE/F,4FAA4F;IAC5F,gDAAgD;IAChD,MAAM,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;IAC1E,sBAAsB,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;IACvC,MAAM,QAAQ,GAAG,iBAAiB,CAAC;IACnC,MAAM,QAAQ,GAAG,cAAc,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,gBAAgB,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;IAE3F,yFAAyF;IACzF,mCAAmC;IACnC,MAAM,QAAQ,GAAG,IAAI,SAAS,CAAC,YAAY,CAAC,oBAAoB,CAAC,QAAQ,CAAC,YAAY,EAAE,EAAE,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC;IAClH,OAAO,4BAA4B,CAAC;QAClC,GAAG,EAAE,gBAAgB,CAAC,iBAAiB;QACvC,OAAO;QACP,cAAc,EAAE,gBAAgB,CAAC,cAAc;QAC/C,QAAQ;QACR,QAAQ;QACR,WAAW,EAAE,IAAI;QACjB,IAAI,EAAE,gBAAgB,CAAC,IAAI;KAC5B,CAAC,CAAC;AACL,CAAC;AAED,SAAS,sBAAsB,CAAC,MAAyB,EAAE,MAAuC;IAChG,aAAa,CAAC,MAAM,EAAE,qBAAqB,EAAE;QAC3C,KAAK,EAAE;YACL,EAAE,EAAE,MAAM;YACV,QAAQ,EAAE,KAAK;YACf,GAAG,EAAE,GAAG,MAAM,aAAa;YAC3B,iBAAiB,EAAE,MAAM;YACzB,cAAc,EAAE,MAAM;YACtB,QAAQ,EAAE,WAAW;YACrB,iBAAiB,uDAAwC;YACzD,8BAA8B,wEAAuD;YACrF,gBAAgB,EAAE,EAAE;SACrB;KACF,CAAC,CAAC;AACL,CAAC","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../core/common/common.js';\nimport type * as Platform from '../core/platform/platform.js';\nimport type * as SDK from '../core/sdk/sdk.js';\nimport * as Protocol from '../generated/protocol.js';\nimport type * as Persistence from '../models/persistence/persistence.js';\nimport * as Workspace from '../models/workspace/workspace.js';\n\nimport {\n  dispatchEvent,\n} from './MockConnection.js';\nimport {createResource, getMainFrame} from './ResourceTreeHelpers.js';\nimport {createFileSystemUISourceCode} from './UISourceCodeHelpers.js';\n\n// This helper sets up a file system and a file system uiSourceCode that can be used for\n// Persistence testing. As soon as a script is added that has the given `networkScriptUrl` and the `content`,\n// PersistenceImpl will try to bind the network uiSourceCode with this file system uiSourceCode.\nexport function createFileSystemFileForPersistenceTests(\n    fileSystemScript: {\n      fileSystemFileUrl: Platform.DevToolsPath.UrlString,\n      fileSystemPath: Platform.DevToolsPath.UrlString,\n      type?: string,\n    },\n    networkScriptUrl: Platform.DevToolsPath.UrlString, content: string, target: SDK.Target.Target):\n    {uiSourceCode: Workspace.UISourceCode.UISourceCode, project: Persistence.FileSystemWorkspaceBinding.FileSystem} {\n  // First, set up a network resource that is described by the networkScriptUrl. This resource\n  // file is required for a binding to be created.\n  const origin = Common.ParsedURL.ParsedURL.extractOrigin(networkScriptUrl);\n  dispatchDocumentOpened(target, origin);\n  const mimeType = 'text/javascript';\n  const resource = createResource(getMainFrame(target), networkScriptUrl, mimeType, content);\n\n  // Now create the file system uiSourceCode to match the same meta data and content as the\n  // created network's resource file.\n  const metadata = new Workspace.UISourceCode.UISourceCodeMetadata(resource.lastModified(), resource.contentSize());\n  return createFileSystemUISourceCode({\n    url: fileSystemScript.fileSystemFileUrl,\n    content,\n    fileSystemPath: fileSystemScript.fileSystemPath,\n    mimeType,\n    metadata,\n    autoMapping: true,\n    type: fileSystemScript.type,\n  });\n}\n\nfunction dispatchDocumentOpened(target: SDK.Target.Target, origin: Platform.DevToolsPath.UrlString) {\n  dispatchEvent(target, 'Page.documentOpened', {\n    frame: {\n      id: 'main',\n      loaderId: 'foo',\n      url: `${origin}/index.html`,\n      domainAndRegistry: 'site',\n      securityOrigin: origin,\n      mimeType: 'text/html',\n      secureContextType: Protocol.Page.SecureContextType.Secure,\n      crossOriginIsolatedContextType: Protocol.Page.CrossOriginIsolatedContextType.Isolated,\n      gatedAPIFeatures: [],\n    },\n  });\n}\n"]}