{"version":3,"file":"test_runner.js","sourceRoot":"","sources":["../../../../../../front_end/legacy_test_runner/test_runner/test_runner.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n// @ts-nocheck This file is not checked by TypeScript as it has a lot of legacy code.\nimport * as Root from '../../core/root/root.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Trace from '../../models/trace/trace.js';\n\nimport * as TestRunner from './TestRunner.js';\n\n/**\n * @param {!SDK.Target.Target} target\n */\nfunction _setupTestHelpers(target) {\n  self.TestRunner.BrowserAgent = target.browserAgent();\n  self.TestRunner.CSSAgent = target.cssAgent();\n  self.TestRunner.DeviceOrientationAgent = target.deviceOrientationAgent();\n  self.TestRunner.DOMAgent = target.domAgent();\n  self.TestRunner.DOMDebuggerAgent = target.domdebuggerAgent();\n  self.TestRunner.DebuggerAgent = target.debuggerAgent();\n  self.TestRunner.EmulationAgent = target.emulationAgent();\n  self.TestRunner.HeapProfilerAgent = target.heapProfilerAgent();\n  self.TestRunner.InputAgent = target.inputAgent();\n  self.TestRunner.InspectorAgent = target.inspectorAgent();\n  self.TestRunner.NetworkAgent = target.networkAgent();\n  self.TestRunner.OverlayAgent = target.overlayAgent();\n  self.TestRunner.PageAgent = target.pageAgent();\n  self.TestRunner.ProfilerAgent = target.profilerAgent();\n  self.TestRunner.RuntimeAgent = target.runtimeAgent();\n  self.TestRunner.TargetAgent = target.targetAgent();\n\n  self.TestRunner.networkManager = target.model(SDK.NetworkManager.NetworkManager);\n  self.TestRunner.securityOriginManager = target.model(SDK.SecurityOriginManager.SecurityOriginManager);\n  self.TestRunner.storageKeyManager = target.model(SDK.StorageKeyManager.StorageKeyManager);\n  self.TestRunner.resourceTreeModel = target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n  self.TestRunner.debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel);\n  self.TestRunner.runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n  self.TestRunner.domModel = target.model(SDK.DOMModel.DOMModel);\n  self.TestRunner.domDebuggerModel = target.model(SDK.DOMDebuggerModel.DOMDebuggerModel);\n  self.TestRunner.cssModel = target.model(SDK.CSSModel.CSSModel);\n  self.TestRunner.cpuProfilerModel = target.model(SDK.CPUProfilerModel.CPUProfilerModel);\n  self.TestRunner.overlayModel = target.model(SDK.OverlayModel.OverlayModel);\n  self.TestRunner.serviceWorkerManager = target.model(SDK.ServiceWorkerManager.ServiceWorkerManager);\n  self.TestRunner.tracingManager = target.model(Trace.TracingManager.TracingManager);\n  self.TestRunner.mainTarget = target;\n}\n\nexport async function _executeTestScript() {\n  const testScriptURL = /** @type {string} */ (Root.Runtime.Runtime.queryParam('test'));\n  if (TestRunner.isDebugTest()) {\n    /* eslint-disable no-console */\n    TestRunner.setInnerResult(console.log);\n    TestRunner.setInnerCompleteTest(() => console.log('Test completed'));\n    /* eslint-enable no-console */\n\n    // Auto-start unit tests\n    self.test = async function() {\n      await import(testScriptURL);\n    };\n    return;\n  }\n\n  try {\n    await import(testScriptURL);\n  } catch (err) {\n    TestRunner.addResult('TEST ENDED EARLY DUE TO UNCAUGHT ERROR:');\n    TestRunner.addResult(err && err.stack || err);\n    TestRunner.addResult('=== DO NOT COMMIT THIS INTO -expected.txt ===');\n    TestRunner.completeTest();\n  }\n}\n\n/** @type {boolean} */\nlet _startedTest = false;\n\n/**\n * @implements {SDK.TargetManager.Observer}\n */\nexport class _TestObserver {\n  /**\n   * @param {!SDK.Target.Target} target\n   * @override\n   */\n  targetAdded(target) {\n    if (target.id() === 'main' && target.type() === 'frame' ||\n        target.parentTarget()?.type() === 'tab' && target.type() === 'frame' && !target.targetInfo()?.subtype?.length) {\n      _setupTestHelpers(target);\n      if (_startedTest) {\n        return;\n      }\n      _startedTest = true;\n      TestRunner\n          .loadHTML(`\n        <head>\n          <base href=\"${TestRunner.url()}\">\n        </head>\n        <body>\n        </body>\n      `).then(() => _executeTestScript());\n    }\n  }\n\n  /**\n   * @param {!SDK.Target.Target} target\n   * @override\n   */\n  targetRemoved(target) {\n  }\n}\n\nSDK.TargetManager.TargetManager.instance().observeTargets(new _TestObserver());\n\nconst globalTestRunner = self.TestRunner;\nexport {globalTestRunner as TestRunner};\n"]}