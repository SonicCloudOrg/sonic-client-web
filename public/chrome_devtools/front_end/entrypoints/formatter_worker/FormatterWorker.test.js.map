{"version":3,"file":"FormatterWorker.test.js","sourceRoot":"","sources":["../../../../../../front_end/entrypoints/formatter_worker/FormatterWorker.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as FormatterWorker from './formatter_worker.js';\n\ndescribe('FormatterWorker', () => {\n  describe('evaluatableJavaScriptSubstring', () => {\n    function evaluatableJavaScriptSubstring(text: string): string {\n      return FormatterWorker.FormatterWorker.evaluatableJavaScriptSubstring(text);\n    }\n\n    it('handles identifiers correctly', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('obj'), 'obj');\n      assert.strictEqual(evaluatableJavaScriptSubstring('obj]'), 'obj');\n      assert.strictEqual(evaluatableJavaScriptSubstring('obj)'), 'obj');\n      assert.strictEqual(evaluatableJavaScriptSubstring('obj='), 'obj');\n      assert.strictEqual(evaluatableJavaScriptSubstring('a+b'), 'a');\n    });\n\n    it('handles strings correctly', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('\"o\"'), '\"o\"');\n      assert.strictEqual(evaluatableJavaScriptSubstring('\\'o\\''), '\\'o\\'');\n    });\n\n    it('handles numbers correctly', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('1'), '1');\n      assert.strictEqual(evaluatableJavaScriptSubstring('1.40'), '1.40');\n    });\n\n    it('handles `this` correctly', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('this'), 'this');\n      assert.strictEqual(evaluatableJavaScriptSubstring('this='), 'this');\n      assert.strictEqual(evaluatableJavaScriptSubstring('this = 1'), 'this');\n    });\n\n    it('handles named property access chains correctly', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('a.b.c.d'), 'a.b.c.d');\n      assert.strictEqual(evaluatableJavaScriptSubstring('a.b.c.d = 1'), 'a.b.c.d');\n      assert.strictEqual(evaluatableJavaScriptSubstring('this.b.c.d'), 'this.b.c.d');\n      assert.strictEqual(evaluatableJavaScriptSubstring('this.b.c.d = 42'), 'this.b.c.d');\n      assert.strictEqual(evaluatableJavaScriptSubstring('\"foo\".toString'), '\"foo\".toString');\n    });\n\n    it('handles keyed property access chains correctly', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('this[\"a\"]'), 'this[\"a\"]');\n      assert.strictEqual(evaluatableJavaScriptSubstring('this[\"a\"])'), 'this[\"a\"]');\n      assert.strictEqual(evaluatableJavaScriptSubstring('bar[foo][baz]'), 'bar[foo][baz]');\n      assert.strictEqual(evaluatableJavaScriptSubstring('bar[foo][baz] = '), 'bar[foo][baz]');\n      assert.strictEqual(evaluatableJavaScriptSubstring('obj[x + 1][0]'), 'obj[x + 1][0]');\n      assert.strictEqual(evaluatableJavaScriptSubstring('bar[foo[baz]]'), 'bar[foo[baz]]');\n      assert.strictEqual(evaluatableJavaScriptSubstring('bar[foo[baz]])'), 'bar[foo[baz]]');\n      assert.strictEqual(evaluatableJavaScriptSubstring('\"bar\"[0])'), '\"bar\"[0]');\n    });\n\n    it('handles mixed property access chain correctly', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('a[b[c()]].x.#y'), 'a[b[c()]].x.#y');\n    });\n\n    it('handles private field access correctly', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('this.#x'), 'this.#x');\n      assert.strictEqual(evaluatableJavaScriptSubstring('this.#x = 1'), 'this.#x');\n      assert.strictEqual(evaluatableJavaScriptSubstring('bar.#foo'), 'bar.#foo');\n    });\n\n    it('removes leading and trailing punctators', () => {\n      assert.strictEqual(evaluatableJavaScriptSubstring('.[)x.y.z'), 'x.y.z');\n      assert.strictEqual(evaluatableJavaScriptSubstring('x.y.z])='), 'x.y.z');\n      assert.strictEqual(evaluatableJavaScriptSubstring('.[)x.y.z])='), 'x.y.z');\n      assert.strictEqual(evaluatableJavaScriptSubstring('x.y.'), 'x.y');\n    });\n  });\n\n  describe('format', () => {\n    const {format} = FormatterWorker.FormatterWorker;\n    it('correctly formats Web app manifests', () => {\n      const inputText = '{\"name\":\"My Web App\",\"start_url\":\".\"}';\n      const formattedText = `{\n    \"name\": \"My Web App\",\n    \"start_url\": \".\"\n}`;\n      assert.strictEqual(format('application/manifest+json', inputText).content, formattedText);\n    });\n  });\n});\n"]}