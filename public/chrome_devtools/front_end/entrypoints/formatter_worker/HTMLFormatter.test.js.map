{"version":3,"file":"HTMLFormatter.test.js","sourceRoot":"","sources":["../../../../../../front_end/entrypoints/formatter_worker/HTMLFormatter.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as FormatterWorker from './formatter_worker.js';\n\nfunction formatHTML(text: string): string {\n  return FormatterWorker.FormatterWorker.format('text/html', text, '  ').content;\n}\n\ndescribe('HTMLFormatter', () => {\n  it('formats simple HTML correctly', () => {\n    const formattedCode = formatHTML('<html><head><title>test</title></head></html>');\n    assert.strictEqual(formattedCode, `<html>\n  <head>\n    <title>test</title>\n  </head>\n</html>\n`);\n  });\n\n  it('formats self-closing tags correctly', () => {\n    const formattedCode = formatHTML('<html><head><meta></head><img><hr/></html>');\n    assert.strictEqual(formattedCode, `<html>\n  <head>\n    <meta>\n  </head>\n  <img>\n  <hr/>\n</html>\n`);\n  });\n\n  it('formats incorrect self-closing tags', () => {\n    const formattedCode = formatHTML('<head><meta><meta></meta><br/></br><link></link><title>test</title></head>');\n    assert.strictEqual(formattedCode, `<head>\n  <meta>\n  <meta></meta>\n  <br/></br>\n  <link></link>\n  <title>test</title>\n</head>\n`);\n  });\n\n  it('formats attributes correctly', () => {\n    const formattedCode = formatHTML('<body><canvas width=100 height=100 data-bad-attr=\\'</canvas>\\'></canvas></body>');\n    assert.strictEqual(formattedCode, `<body>\n  <canvas width=100 height=100 data-bad-attr=\\'</canvas>\\'></canvas>\n</body>\n`);\n  });\n\n  it('formats custom elements correctly', () => {\n    const formattedCode =\n        formatHTML('<body><custom-time year=2016 day=1 month=1><div>minutes/seconds</div></custom-time></body>');\n    assert.strictEqual(formattedCode, `<body>\n  <custom-time year=2016 day=1 month=1>\n    <div>minutes/seconds</div>\n  </custom-time>\n</body>\n`);\n  });\n\n  it('formats doctype correctly', () => {\n    const formattedCode = formatHTML('<!DOCTYPE HTML><body>hello, world</body>');\n    assert.strictEqual(formattedCode, `<!DOCTYPE HTML>\n<body>hello, world</body>\n`);\n  });\n\n  it('formats comments correctly', () => {\n    const formattedCode =\n        formatHTML('<!-- comment 1 --><html><!-- comment 2--><meta/><body><!-- comment 3--><a>link</a></body></html>');\n    assert.strictEqual(formattedCode, `<!-- comment 1 -->\n<html>\n  <!-- comment 2-->\n  <meta/>\n  <body>\n    <!-- comment 3-->\n    <a>link</a>\n  </body>\n</html>\n`);\n  });\n\n  it('formats non-javascript script tag correctly', () => {\n    const formattedCode = formatHTML('<div><script type=\\'text/K\\'>2_&{&/x!/:2_!x}\\'!R<\\/script></div>');\n    assert.strictEqual(formattedCode, `<div>\n  <script type=\\'text/K\\'>\n    2_&{&/x!/:2_!x}\\'!R\n  <\\/script>\n</div>\n`);\n  });\n\n  it('formats lists correctly', () => {\n    const formattedCode = formatHTML(\n        '<ul><li>foo<li> hello <b>world</b>!<li> hello <b>world</b> <b>i\\'m here</b><li>bar<li>baz<li>hello <b>world</b><li>another</ul>');\n    assert.strictEqual(formattedCode, `<ul>\n  <li>foo\n  <li>\n    hello <b>world</b>\n    !\n  <li>\n    hello <b>world</b>\n    <b>i'm here</b>\n  <li>bar\n  <li>baz\n  <li>\n    hello <b>world</b>\n  <li>another\n</ul>\n`);\n  });\n\n  it('formats automatically closing tags correctly', () => {\n    const formattedCode = formatHTML('<a>aaaa<b>bbbb1<c>cccc<d>dddd</c>bbbb2</a>');\n    assert.strictEqual(formattedCode, `<a>\n  aaaa\n  <b>\n    bbbb1\n    <c>\n      cccc<d>dddd\n    </c>\n    bbbb2\n</a>\n`);\n  });\n\n  it('formats a comment after a link correctly', () => {\n    const formattedCode = formatHTML('<link href=\\'a/b/c.css\\' rel=\\'stylesheet\\'><!-- some comment -->');\n    assert.strictEqual(formattedCode, `<link href=\\'a/b/c.css\\' rel=\\'stylesheet\\'>\n<!-- some comment -->\n`);\n  });\n\n  it('formats inline JavaScript classic scripts correctly', () => {\n    const formattedCode = formatHTML(\n        '<html><script type=\"text/javascript\">for(var i=0;i<10;++i)console.log(\\'test \\'+i);<\\/script></html>');\n    assert.strictEqual(formattedCode, `<html>\n  <script type=\"text/javascript\">\n    for (var i = 0; i < 10; ++i)\n      console.log('test ' + i);\n  <\\/script>\n</html>\n`);\n  });\n\n  it('formats inline JavaScript modules correctly', () => {\n    const formattedCode = formatHTML(\n        '<html><script type=\"module\">import foo from\"foo\";foo();</script><script type=module>bar();foo();</script></html>');\n    assert.strictEqual(formattedCode, `<html>\n  <script type=\"module\">\n    import foo from \"foo\";\n    foo();\n  </script>\n  <script type=module>\n    bar();\n    foo();\n  </script>\n</html>\n`);\n  });\n\n  it('formats inline <script>s with characters whose lower case representation is longer correctly', () => {\n    const formattedCode = formatHTML('<html><script>console.log(\\'İ\\');</script></html>');\n    assert.strictEqual(formattedCode, `<html>\n  <script>\n    console.log('İ');\n  </script>\n</html>\n`);\n  });\n\n  it('formats inline <script>s with speculation rules correctly', () => {\n    const formattedCode = formatHTML(\n        '<html><script type=\"speculationrules\">{\"prefetch\": [{\"source\": \"list\",\"urls\": [\"prefetch.html?2\"]}],\"prerender\": [{\"source\": \"list\",\"urls\": [\"prerender.html?2\"]}]}</script></html>');\n    assert.strictEqual(formattedCode, `<html>\n  <script type=\"speculationrules\">\n    {\n      \"prefetch\": [\n        {\n          \"source\": \"list\",\n          \"urls\": [\n            \"prefetch.html?2\"\n          ]\n        }\n      ],\n      \"prerender\": [\n        {\n          \"source\": \"list\",\n          \"urls\": [\n            \"prerender.html?2\"\n          ]\n        }\n      ]\n    }</script>\n</html>\n`);\n  });\n\n  it('formats inline <script>s with import maps correctly', () => {\n    const formattedCode = formatHTML(\n        '<html><script type=importmap>{\"imports\": {\"moment\": \"/node_modules/moment/src/moment.js\",\"lodash\": \"/node_modules/lodash-es/lodash.js\"}}</script></html>');\n    assert.strictEqual(formattedCode, `<html>\n  <script type=importmap>\n    {\n      \"imports\": {\n        \"moment\": \"/node_modules/moment/src/moment.js\",\n        \"lodash\": \"/node_modules/lodash-es/lodash.js\"\n      }\n    }</script>\n</html>\n`);\n  });\n\n  it('formats inline css correctly', () => {\n    const formattedCode = formatHTML('<html><style>div{color:red;border:1px solid black;}</style></html>');\n    assert.strictEqual(formattedCode, `<html>\n  <style>\n    div {\n      color: red;\n      border: 1px solid black;\n    }\n  </style>\n</html>\n`);\n  });\n\n  it('formats multiple inline formats correctly', () => {\n    const formattedCode = formatHTML(`<html>\n    <head>\n    <meta name=\\\"ROBOTS\\\" content=\\\"NOODP\\\">\n    <meta name='viewport' content='text/html'>\n    <title>foobar</title>\n    <body>\n    <script>if(1<2){if(2<3){if(3<4){if(4<5){console.log(\"magic\")}}}}<\\/script>\n    <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...\">\n    <style>div{display:flex;align-items:center;justify-content:center;}body{width:100%}*{border:1px solid black}</style>\n    </body>\n    </html>`);\n    assert.strictEqual(formattedCode, `<html>\n  <head>\n    <meta name=\\\"ROBOTS\\\" content=\\\"NOODP\\\">\n    <meta name='viewport' content='text/html'>\n    <title>foobar</title>\n  <body>\n    <script>\n      if (1 < 2) {\n        if (2 < 3) {\n          if (3 < 4) {\n            if (4 < 5) {\n              console.log(\"magic\")\n            }\n          }\n        }\n      }\n    <\\/script>\n    <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...\">\n    <style>\n      div {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      body {\n        width: 100%\n      }\n\n      * {\n        border: 1px solid black\n      }\n    </style>\n  </body>\n</html>\n`);\n  });\n\n  it('formats unquoted attribute values with trailing slashes correctly', () => {\n    const code = `<link href=https://web.dev/ rel=canonical>\n<link rel=alternate hreflang=es href=https://web.dev/i18n/es/>\n`;\n    assert.strictEqual(formatHTML(code), code);\n  });\n\n  it('formats inline JSON script tag correctly', () => {\n    const formattedCode = formatHTML(\n        '<div><script type=\\'application\\/json\\'>{\"foo\":\"bar\",\"data\":{\"hello\":\"world\",\"meaning\":42}}<\\/script></div>');\n    assert.strictEqual(formattedCode, `<div>\n  <script type=\\'application/json\\'>\n    {\n      \"foo\": \"bar\",\n      \"data\": {\n        \"hello\": \"world\",\n        \"meaning\": 42\n      }\n    }<\\/script>\n</div>\n`);\n  });\n\n  it('formats inline JSON-LD script tag correctly', () => {\n    const formattedCode = formatHTML(\n        '<div><script type=\\'application\\/ld+json\\'>{  \"@context\": \"https://json-ld.org/contexts/person.jsonld\",\"@id\": \"http://dbpedia.org/resource/John_Lennon\",\"name\": \"John Lennon\",\"born\": \"1940-10-09\",\"spouse\": \"http://dbpedia.org/resource/Cynthia_Lennon\"}<\\/script></div>');\n    assert.strictEqual(formattedCode, `<div>\n  <script type=\\'application/ld+json\\'>\n    {\n      \"@context\": \"https://json-ld.org/contexts/person.jsonld\",\n      \"@id\": \"http://dbpedia.org/resource/John_Lennon\",\n      \"name\": \"John Lennon\",\n      \"born\": \"1940-10-09\",\n      \"spouse\": \"http://dbpedia.org/resource/Cynthia_Lennon\"\n    }<\\/script>\n</div>\n`);\n  });\n\n  it('formats ampersands in text correctly', () => {\n    assert.strictEqual(formatHTML('This&'), `This&\n`);\n    assert.strictEqual(formatHTML('Me&You'), `Me&You\n`);\n\n    const url = 'http://www.example.com/index.html?a=1&b=2&c=3&d=1234567890abcdef1234567890abcdef1';\n    assert.strictEqual(formatHTML(url).trimEnd(), url);\n  });\n\n  it('formats ampersands in attribute values correctly', () => {\n    assert.strictEqual(\n        formatHTML('<link href=\"http://www.example.com/index.html?a=1&b=2\">'),\n        `<link href=\"http://www.example.com/index.html?a=1&b=2\">\n`);\n    assert.strictEqual(\n        formatHTML('<link href=http://www.example.com/index.html?a&b/>'),\n        `<link href=http://www.example.com/index.html?a&b/>\n`);\n    assert.strictEqual(\n        formatHTML('<link href=http://www.example.com/index.html?a&b/ rel=canonical>'),\n        `<link href=http://www.example.com/index.html?a&b/ rel=canonical>\n`);\n  });\n});\n"]}