{"version":3,"file":"HighlightManager.test.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/highlighting/HighlightManager.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,SAAS,MAAM,0CAA0C,CAAC;AAEtE,OAAO,KAAK,YAAY,MAAM,mBAAmB,CAAC;AAElD,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;IAChC,IAAI,SAAyB,CAAC;IAC9B,MAAM,CAAC,GAAG,EAAE;QACV,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;IAC5C,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,GAAG,EAAE;QACT,SAAS,CAAC,MAAM,EAAE,CAAC;IACrB,CAAC,CAAC,CAAC;IAEH,SAAS,QAAQ,CAAC,IAAY;QAC5B,MAAM,GAAG,GAAG,SAAS,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QACzC,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC;QACrB,OAAO,GAAG,CAAC;IACb,CAAC;IAED,SAAS,IAAI,CAAC,IAAY;QACxB,OAAO,IAAI,YAAY,CAAC,gBAAgB,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;IACvE,CAAC;IAED,SAAS,MAAM,CAAC,KAAiB;QAC/B,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACrB,MAAM,IAAI,GAAG,KAAK,CAAC,aAAa,EAAE,EAAE,WAAW,CAAC;QAChD,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QACpB,OAAO,IAAI,CAAC;IACd,CAAC;IAED,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;QACrC,SAAS;QACT,QAAQ;QACR,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;QAEnE,WAAW;QACX,SAAS;QACT,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QAE7E,cAAc;QACd,YAAY;QACZ,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;QAEnF,KAAK;QACL,KAAK;QACL,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAExC,QAAQ;QACR,QAAQ;QACR,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAE3C,QAAQ;QACR,QAAQ;QACR,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAE3C,QAAQ;QACR,EAAE;QACF,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAC5C,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAE5C,cAAc;QACd,aAAa;QACb,MAAM,MAAM,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACxC,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QAC9D,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QAC9D,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;IAChE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,6BAA6B,EAAE,GAAG,EAAE;QACrC,MAAM,gBAAgB,GAAG,IAAI,YAAY,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,CAAC;QAE9E,mBAAmB;QACnB,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,YAAY,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QACjG,MAAM,MAAM,GAAG,gBAAgB,CAAC,0BAA0B,CAAC,QAAQ,CAAC,kBAAkB,CAAC,EAAE;YACvF,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC;YACzC,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC;YACzC,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC;SAC1C,CAAC,CAAC;QACH,MAAM,SAAS,GAAG,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,YAAY,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC;QACvF,MAAM,CAAC,WAAW,CAAC,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QACvC,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,SAAU,CAAC,IAAI,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC;IAChE,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as TextUtils from '../../../models/text_utils/text_utils.js';\n\nimport * as Highlighting from './highlighting.js';\n\ndescribe('HighlightManager', () => {\n  let container: HTMLDivElement;\n  before(() => {\n    container = document.createElement('div');\n  });\n\n  after(() => {\n    container.remove();\n  });\n\n  function fromHtml(html: string): HTMLElement {\n    const div = container.createChild('div');\n    div.innerHTML = html;\n    return div;\n  }\n\n  function walk(html: string): Highlighting.HighlightManager.RangeWalker {\n    return new Highlighting.HighlightManager.RangeWalker(fromHtml(html));\n  }\n\n  function toText(range: Range|null): string {\n    assert.exists(range);\n    const text = range.cloneContents()?.textContent;\n    assert.exists(text);\n    return text;\n  }\n\n  it('correctly translates ranges', () => {\n    // \"text\"\n    //    ^^\n    assert.deepStrictEqual(toText(walk('text').nextRange(2, 2)), 'xt');\n\n    // \"abcdef\"\n    //    ^ ^\n    assert.deepStrictEqual(toText(walk('abc<p>def</p>').nextRange(2, 3)), 'cde');\n\n    // \"abcdefghi\"\n    //    ^    ^\n    assert.deepStrictEqual(toText(walk('abc<p>def</p>ghi').nextRange(2, 6)), 'cdefgh');\n\n    // \"\"\n    //  ^\n    assert.isNull(walk('').nextRange(0, 1));\n\n    // \"abc\"\n    //     ^\n    assert.isNull(walk('abc').nextRange(3, 1));\n\n    // \"abc\"\n    //  ^^^^\n    assert.isNull(walk('abc').nextRange(0, 4));\n\n    // \"abc\"\n    //\n    assert.isNull(walk('abc').nextRange(0, 0));\n    assert.isNull(walk('abc').nextRange(-1, 0));\n    assert.isNull(walk('abc').nextRange(0, -1));\n\n    // \"abcdefghi\"\n    //  ^^^^^^^^^\n    const walker = walk('abc<p>def</p>ghi');\n    assert.deepStrictEqual(toText(walker.nextRange(0, 3)), 'abc');\n    assert.deepStrictEqual(toText(walker.nextRange(3, 3)), 'def');\n    assert.deepStrictEqual(toText(walker.nextRange(6, 3)), 'ghi');\n  });\n\n  it('correctly highlights ranges', () => {\n    const highlightManager = new Highlighting.HighlightManager.HighlightManager();\n\n    // @ts-expect-error\n    assert.strictEqual(CSS.highlights.get(Highlighting.HighlightManager.HIGHLIGHT_REGISTRY).size, 0);\n    const ranges = highlightManager.highlightOrderedTextRanges(fromHtml('abc<p>def</p>ghi'), [\n      new TextUtils.TextRange.SourceRange(0, 3),\n      new TextUtils.TextRange.SourceRange(3, 3),\n      new TextUtils.TextRange.SourceRange(6, 3),\n    ]);\n    const highlight = CSS.highlights.get(Highlighting.HighlightManager.HIGHLIGHT_REGISTRY);\n    assert.strictEqual(highlight?.size, 3);\n    assert.deepStrictEqual(Array.from(highlight!.keys()), ranges);\n  });\n});\n"]}