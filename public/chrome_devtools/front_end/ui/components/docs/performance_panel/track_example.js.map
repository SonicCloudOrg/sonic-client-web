{"version":3,"file":"track_example.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/components/docs/performance_panel/track_example.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport * as Bindings from '../../../../models/bindings/bindings.js';\nimport * as Workspace from '../../../../models/workspace/workspace.js';\nimport * as Timeline from '../../../../panels/timeline/timeline.js';\nimport * as EnvHelpers from '../../../../testing/EnvironmentHelpers.js';\nimport * as FrontendHelpers from '../../../../testing/TraceHelpers.js';\nimport type * as PerfUI from '../../../legacy/components/perf_ui/perf_ui.js';\nimport * as ComponentSetup from '../../helpers/helpers.js';\n\nawait ComponentSetup.ComponentServerSetup.setup();\nawait EnvHelpers.initializeGlobalVars();\n\nconst targetManager = SDK.TargetManager.TargetManager.instance({forceNew: true});\nconst workspace = Workspace.Workspace.WorkspaceImpl.instance({forceNew: true});\nconst resourceMapping = new Bindings.ResourceMapping.ResourceMapping(targetManager, workspace);\nconst debuggerWorkspaceBinding = Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance({\n  forceNew: true,\n  resourceMapping,\n  targetManager,\n});\nBindings.IgnoreListManager.IgnoreListManager.instance({\n  forceNew: true,\n  debuggerWorkspaceBinding,\n});\n\nconst params = new URLSearchParams(window.location.search);\nconst track = params.get('track');\nconst fileName = params.get('fileName');\nconst expanded = params.get('expanded');\nconst darkMode = params.get('darkMode');\n\nconst additionalTrackFilter = params.get('trackFilter') || undefined;\n\nconst customStartWindowTime = params.get('windowStart');\nconst customEndWindowTime = params.get('windowEnd');\nconst p = document.createElement('p');\n// Expand the track by default for test.\nawait renderContent(expanded === 'false' ? false : true);\n\ntype FlameChartData = {\n  flameChart: PerfUI.FlameChart.FlameChart,\n  dataProvider: Timeline.TimelineFlameChartDataProvider.TimelineFlameChartDataProvider|\n              Timeline.TimelineFlameChartNetworkDataProvider.TimelineFlameChartNetworkDataProvider,\n};\n\nasync function renderContent(expanded: boolean) {\n  if (darkMode) {\n    document.documentElement.classList.add('theme-with-dark-background');\n  }\n\n  const container = document.getElementById('container');\n  if (!container) {\n    throw new Error('could not find container');\n  }\n  container.appendChild(p);\n  if (!track || !fileName) {\n    document.title = 'Performance panel track example';\n    p.innerText =\n        'Use the `track` and `fileName` URL search params to load a track example (f.e. track_example.html?track=Timings&fileName=timings-track)';\n    return;\n  }\n  const file = `${fileName}.json.gz`;\n  document.title = `Performance panel ${track} track`;\n  p.innerText = `${track} track is loading`;\n  p.classList.add('loading');\n  let flameChartData: FlameChartData;\n  try {\n    // @ts-expect-error: allow to check if a const string array contains a string.\n    if (Timeline.CompatibilityTracksAppender.TrackNames.includes(track)) {\n      const trackAppenderName = track as Timeline.CompatibilityTracksAppender.TrackAppenderName;\n      flameChartData = await FrontendHelpers.getMainFlameChartWithTracks(\n          file, new Set([trackAppenderName]), expanded, additionalTrackFilter);\n    } else if (track === 'Network') {\n      flameChartData = await FrontendHelpers.getNetworkFlameChart(file, expanded);\n    } else {\n      p.classList.remove('loading');\n      p.innerText = `Invalid track name: ${track}`;\n      return;\n    }\n    container.innerHTML = '';\n    const {flameChart, dataProvider} = flameChartData;\n    const timingsTrackOffset = flameChart.levelToOffset(dataProvider.maxStackDepth());\n    container.style.height = `${timingsTrackOffset}px`;\n    if (customStartWindowTime && customEndWindowTime) {\n      flameChart.setWindowTimes(Number(customStartWindowTime), Number(customEndWindowTime), false);\n    }\n    flameChart.show(container);\n  } catch (error) {\n    p.classList.remove('loading');\n    p.innerText = error;\n    console.error(error);\n  }\n}\n"]}