{"version":3,"file":"CSSLength.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/inline_editor/CSSLength.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../../../core/host/host.js';\nimport * as LitHtml from '../../../lit-html/lit-html.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\n\nimport cssLengthStyles from './cssLength.css.js';\nimport {type Length, LENGTH_UNITS, LengthUnit, parseText} from './CSSLengthUtils.js';\nimport {ValueChangedEvent} from './InlineEditorUtils.js';\n\nconst {render, html, Directives: {classMap}} = LitHtml;\n\nexport class DraggingFinishedEvent extends Event {\n  static readonly eventName = 'draggingfinished';\n  constructor() {\n    super(DraggingFinishedEvent.eventName, {});\n  }\n}\n\nexport interface CSSLengthData {\n  lengthText: string;\n  overloaded: boolean;\n}\n\nconst DefaultLength = {\n  value: 0,\n  unit: LengthUnit.PIXEL,\n};\n\nexport class CSSLength extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-css-length`;\n\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private readonly onDraggingValue = this.dragValue.bind(this);\n  private length: Length = DefaultLength;\n  private overloaded: boolean = false;\n  private isEditingSlot = false;\n  private isDraggingValue = false;\n  private currentMouseClientX = 0;\n  #valueMousedownTime = 0;\n\n  set data(data: CSSLengthData) {\n    const parsedResult = parseText(data.lengthText);\n    if (!parsedResult) {\n      return;\n    }\n    this.length = parsedResult;\n    this.overloaded = data.overloaded;\n    this.render();\n  }\n\n  connectedCallback(): void {\n    this.shadow.adoptedStyleSheets = [cssLengthStyles];\n  }\n\n  private onUnitChange(event: Event): void {\n    this.length.unit = (event.target as HTMLInputElement).value as LengthUnit;\n    this.dispatchEvent(new ValueChangedEvent(`${this.length.value}${this.length.unit}`));\n    this.dispatchEvent(new DraggingFinishedEvent());\n    this.render();\n  }\n\n  private dragValue(event: MouseEvent): void {\n    event.preventDefault();\n    event.stopPropagation();\n    if (Date.now() - this.#valueMousedownTime <= 300) {\n      // Delay drag callback by 300ms to prioritize click over drag.\n      return;\n    }\n\n    this.isDraggingValue = true;\n    let displacement = event.clientX - this.currentMouseClientX;\n    this.currentMouseClientX = event.clientX;\n    if (event.shiftKey) {\n      displacement *= 10;\n    }\n    if (event.altKey) {\n      displacement *= 0.1;\n    }\n    this.length.value = this.length.value + displacement;\n    this.dispatchEvent(new ValueChangedEvent(`${this.length.value}${this.length.unit}`));\n    this.render();\n  }\n\n  private onValueMousedown(event: MouseEvent): void {\n    if (event.button !== 0) {\n      return;\n    }\n\n    this.#valueMousedownTime = Date.now();\n\n    this.currentMouseClientX = event.clientX;\n    const targetDocument = event.target instanceof Node && event.target.ownerDocument;\n    if (targetDocument) {\n      targetDocument.addEventListener('mousemove', this.onDraggingValue, {capture: true});\n      targetDocument.addEventListener('mouseup', (event: MouseEvent) => {\n        targetDocument.removeEventListener('mousemove', this.onDraggingValue, {capture: true});\n\n        if (!this.isDraggingValue) {\n          return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n        this.isDraggingValue = false;\n        this.dispatchEvent(new DraggingFinishedEvent());\n      }, {once: true, capture: true});\n    }\n  }\n\n  private onValueMouseup(): void {\n    if (!this.isDraggingValue) {\n      this.isEditingSlot = true;\n      this.render();\n    }\n  }\n\n  private onUnitMouseup(event: MouseEvent): void {\n    event.preventDefault();\n    event.stopPropagation();\n\n    Host.userMetrics.swatchActivated(Host.UserMetrics.SwatchType.Length);\n  }\n\n  private render(): void {\n    const classes = {\n      'css-length': true,\n      'overloaded': this.overloaded,\n    };\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(html`\n      <div class=${classMap(classes)}>\n        ${this.renderContent()}\n      </div>\n    `, this.shadow, {\n      host: this,\n    });\n    // clang-format on\n  }\n\n  private renderContent(): LitHtml.TemplateResult {\n    if (this.isEditingSlot) {\n      return html`<slot></slot>`;\n    }\n    const options = LENGTH_UNITS.map(unit => {\n      return html`\n          <option value=${unit} .selected=${this.length.unit === unit}>${unit}</option>\n        `;\n    });\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n      return html`\n        <span class=\"value\"\n          @mousedown=${this.onValueMousedown}\n          @mouseup=${this.onValueMouseup}\n        >${this.length.value}</span><span class=\"unit\">${this.length.unit}</span>\n        <div class=\"unit-dropdown\">\n          <span class=\"icon\"></span>\n          <select\n            jslog=${VisualLogging.dropDown('unit').track({change: true})}\n            @mouseup=${this.onUnitMouseup}\n            @change=${this.onUnitChange}>\n            ${options}\n          </select>\n        </div>\n      `;\n    // clang-format on\n  }\n}\n\ncustomElements.define('devtools-css-length', CSSLength);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-css-length': CSSLength;\n  }\n}\n"]}