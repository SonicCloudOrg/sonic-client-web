{"version":3,"file":"FilmStripView.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/perf_ui/FilmStripView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2015 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as Host from '../../../../core/host/host.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as TraceEngine from '../../../../models/trace/trace.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\nimport * as UI from '../../legacy.js';\n\nimport filmStripViewStyles from './filmStripView.css.legacy.js';\n\nconst UIStrings = {\n  /**\n   *@description Element title in Film Strip View of the Performance panel\n   */\n  doubleclickToZoomImageClickTo: 'Doubleclick to zoom image. Click to view preceding requests.',\n  /**\n   *@description Aria label for captured screenshots in network panel.\n   *@example {3ms} PH1\n   */\n  screenshotForSSelectToView: 'Screenshot for {PH1} - select to view preceding requests.',\n  /**\n   *@description Text for one or a group of screenshots\n   */\n  screenshot: 'Screenshot',\n  /**\n   *@description Prev button title in Film Strip View of the Performance panel\n   */\n  previousFrame: 'Previous frame',\n  /**\n   *@description Next button title in Film Strip View of the Performance panel\n   */\n  nextFrame: 'Next frame',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/perf_ui/FilmStripView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class FilmStripView extends Common.ObjectWrapper.eventMixin<EventTypes, typeof UI.Widget.HBox>(UI.Widget.HBox) {\n  private statusLabel: HTMLElement;\n  private zeroTime: TraceEngine.Types.Timing.MilliSeconds = TraceEngine.Types.Timing.MilliSeconds(0);\n  #filmStrip: TraceEngine.Extras.FilmStrip.Data|null = null;\n\n  constructor() {\n    super(true);\n    this.registerRequiredCSS(filmStripViewStyles);\n    this.contentElement.classList.add('film-strip-view');\n    this.statusLabel = this.contentElement.createChild('div', 'label');\n    this.reset();\n  }\n\n  static setImageData(imageElement: HTMLImageElement, dataUri: string|null): void {\n    if (dataUri) {\n      imageElement.src = dataUri;\n    }\n  }\n\n  setModel(filmStrip: TraceEngine.Extras.FilmStrip.Data): void {\n    this.#filmStrip = filmStrip;\n    this.zeroTime = TraceEngine.Helpers.Timing.microSecondsToMilliseconds(filmStrip.zeroTime);\n\n    if (!this.#filmStrip.frames.length) {\n      this.reset();\n      return;\n    }\n    this.update();\n  }\n\n  createFrameElement(frame: TraceEngine.Extras.FilmStrip.Frame): HTMLButtonElement {\n    const time = TraceEngine.Helpers.Timing.microSecondsToMilliseconds(frame.screenshotEvent.ts);\n    const frameTime = i18n.TimeUtilities.millisToString(time - this.zeroTime);\n    const element = document.createElement('button');\n    element.classList.add('frame');\n    UI.Tooltip.Tooltip.install(element, i18nString(UIStrings.doubleclickToZoomImageClickTo));\n    element.createChild('div', 'time').textContent = frameTime;\n    element.tabIndex = 0;\n    element.setAttribute('jslog', `${VisualLogging.preview('film-strip').track({click: true, dblclick: true})}`);\n    element.setAttribute('aria-label', i18nString(UIStrings.screenshotForSSelectToView, {PH1: frameTime}));\n    UI.ARIAUtils.markAsButton(element);\n    const imageElement = (element.createChild('div', 'thumbnail').createChild('img') as HTMLImageElement);\n    imageElement.alt = i18nString(UIStrings.screenshot);\n    element.addEventListener('mousedown', this.onMouseEvent.bind(this, Events.FrameSelected, time), false);\n    element.addEventListener('mouseenter', this.onMouseEvent.bind(this, Events.FrameEnter, time), false);\n    element.addEventListener('mouseout', this.onMouseEvent.bind(this, Events.FrameExit, time), false);\n    element.addEventListener('dblclick', this.onDoubleClick.bind(this, frame), false);\n    element.addEventListener('focusin', this.onMouseEvent.bind(this, Events.FrameEnter, time), false);\n    element.addEventListener('focusout', this.onMouseEvent.bind(this, Events.FrameExit, time), false);\n\n    FilmStripView.setImageData(imageElement, frame.screenshotEvent.args.dataUri);\n    return element;\n  }\n\n  update(): void {\n    const frames = this.#filmStrip?.frames;\n    if (!frames || frames.length < 1) {\n      return;\n    }\n\n    const frameElements = frames.map(frame => this.createFrameElement(frame));\n    this.contentElement.removeChildren();\n    for (const element of frameElements) {\n      this.contentElement.appendChild(element);\n    }\n  }\n\n  private onMouseEvent(eventName: string|symbol, timestamp: number): void {\n    // TODO(crbug.com/1228674): Use type-safe event dispatch and remove <any>.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    this.dispatchEventToListeners<any>(eventName, timestamp);\n  }\n\n  private onDoubleClick(filmStripFrame: TraceEngine.Extras.FilmStrip.Frame): void {\n    if (!this.#filmStrip) {\n      return;\n    }\n    Dialog.fromFilmStrip(this.#filmStrip, filmStripFrame.index);\n  }\n\n  reset(): void {\n    this.zeroTime = TraceEngine.Types.Timing.MilliSeconds(0);\n    this.contentElement.removeChildren();\n    this.contentElement.appendChild(this.statusLabel);\n  }\n\n  setStatusText(text: string): void {\n    this.statusLabel.textContent = text;\n  }\n}\n\nexport const enum Events {\n  FrameSelected = 'FrameSelected',\n  FrameEnter = 'FrameEnter',\n  FrameExit = 'FrameExit',\n}\n\nexport type EventTypes = {\n  [Events.FrameSelected]: number,\n  [Events.FrameEnter]: number,\n  [Events.FrameExit]: number,\n};\n\ninterface DialogTraceEngineData {\n  source: 'TraceEngine';\n  index: number;\n  zeroTime: TraceEngine.Types.Timing.MilliSeconds;\n  frames: readonly TraceEngine.Extras.FilmStrip.Frame[];\n}\n\nexport class Dialog {\n  private fragment: UI.Fragment.Fragment;\n  private readonly widget: UI.XWidget.XWidget;\n  private index: number;\n  private dialog: UI.Dialog.Dialog|null = null;\n\n  #data: DialogTraceEngineData;\n\n  static fromFilmStrip(filmStrip: TraceEngine.Extras.FilmStrip.Data, selectedFrameIndex: number): Dialog {\n    const data: DialogTraceEngineData = {\n      source: 'TraceEngine',\n      frames: filmStrip.frames,\n      index: selectedFrameIndex,\n      zeroTime: TraceEngine.Helpers.Timing.microSecondsToMilliseconds(filmStrip.zeroTime),\n    };\n    return new Dialog(data);\n  }\n\n  private constructor(data: DialogTraceEngineData) {\n    this.#data = data;\n    this.index = data.index;\n    const prevButton = UI.UIUtils.createTextButton('\\u25C0', this.onPrevFrame.bind(this));\n    UI.Tooltip.Tooltip.install(prevButton, i18nString(UIStrings.previousFrame));\n    const nextButton = UI.UIUtils.createTextButton('\\u25B6', this.onNextFrame.bind(this));\n    UI.Tooltip.Tooltip.install(nextButton, i18nString(UIStrings.nextFrame));\n    this.fragment = UI.Fragment.Fragment.build`\n      <x-widget flex=none margin=12px>\n        <x-hbox overflow=auto border='1px solid #ddd'>\n          <img $='image' data-film-strip-dialog-img style=\"max-height: 80vh; max-width: 80vw;\"></img>\n        </x-hbox>\n        <x-hbox x-center justify-content=center margin-top=10px>\n          ${prevButton}\n          <x-hbox $='time' margin=8px></x-hbox>\n          ${nextButton}\n        </x-hbox>\n      </x-widget>\n    `;\n    this.widget = (this.fragment.element() as UI.XWidget.XWidget);\n    (this.widget as HTMLElement).tabIndex = 0;\n    this.widget.addEventListener('keydown', this.keyDown.bind(this), false);\n    this.dialog = null;\n\n    void this.render();\n  }\n\n  hide(): void {\n    if (this.dialog) {\n      this.dialog.hide();\n    }\n  }\n\n  #framesCount(): number {\n    return this.#data.frames.length;\n  }\n\n  #zeroTime(): TraceEngine.Types.Timing.MilliSeconds {\n    return this.#data.zeroTime;\n  }\n\n  private resize(): void {\n    if (!this.dialog) {\n      this.dialog = new UI.Dialog.Dialog();\n      this.dialog.contentElement.appendChild(this.widget);\n      this.dialog.setDefaultFocusedElement(this.widget);\n      this.dialog.show();\n    }\n    this.dialog.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);\n  }\n\n  private keyDown(event: Event): void {\n    const keyboardEvent = (event as KeyboardEvent);\n    switch (keyboardEvent.key) {\n      case 'ArrowLeft':\n        if (Host.Platform.isMac() && keyboardEvent.metaKey) {\n          this.onFirstFrame();\n        } else {\n          this.onPrevFrame();\n        }\n        break;\n\n      case 'ArrowRight':\n        if (Host.Platform.isMac() && keyboardEvent.metaKey) {\n          this.onLastFrame();\n        } else {\n          this.onNextFrame();\n        }\n        break;\n\n      case 'Home':\n        this.onFirstFrame();\n        break;\n\n      case 'End':\n        this.onLastFrame();\n        break;\n    }\n  }\n\n  private onPrevFrame(): void {\n    if (this.index > 0) {\n      --this.index;\n    }\n    void this.render();\n  }\n\n  private onNextFrame(): void {\n    if (this.index < this.#framesCount() - 1) {\n      ++this.index;\n    }\n    void this.render();\n  }\n\n  private onFirstFrame(): void {\n    this.index = 0;\n    void this.render();\n  }\n\n  private onLastFrame(): void {\n    this.index = this.#framesCount() - 1;\n    void this.render();\n  }\n\n  private render(): void {\n    const frame = this.#data.frames[this.index];\n    const timestamp = TraceEngine.Helpers.Timing.microSecondsToMilliseconds(frame.screenshotEvent.ts);\n    this.fragment.$('time').textContent = i18n.TimeUtilities.millisToString(timestamp - this.#zeroTime());\n    const image = (this.fragment.$('image') as HTMLImageElement);\n    image.setAttribute('data-frame-index', this.index.toString());\n    FilmStripView.setImageData(image, frame.screenshotEvent.args.dataUri);\n    this.resize();\n  }\n}\n"]}