{"version":3,"file":"Debugging.js","sourceRoot":"","sources":["../../../../../../front_end/ui/visual_logging/Debugging.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assertNotNullOrUndefined} from '../../core/platform/platform.js';\n\nimport {type Loggable} from './Loggable.js';\nimport {type LoggingConfig, VisualElements} from './LoggingConfig.js';\nimport {getLoggingState, type LoggingState} from './LoggingState.js';\n\nlet veDebuggingEnabled = false;\nlet debugPopover: HTMLElement|null = null;\nconst nonDomDebugElements = new WeakMap<Loggable, HTMLElement>();\n\nfunction setVeDebuggingEnabled(enabled: boolean): void {\n  veDebuggingEnabled = enabled;\n  if (enabled && !debugPopover) {\n    debugPopover = document.createElement('div');\n    debugPopover.classList.add('ve-debug');\n    debugPopover.style.position = 'absolute';\n    debugPopover.style.bottom = '100px';\n    debugPopover.style.left = '100px';\n    debugPopover.style.background = 'black';\n    debugPopover.style.color = 'white';\n    debugPopover.style.zIndex = '100000';\n    document.body.appendChild(debugPopover);\n  }\n}\n\n// @ts-ignore\nglobalThis.setVeDebuggingEnabled = setVeDebuggingEnabled;\n\nexport function processForDebugging(loggable: Loggable): void {\n  const loggingState = getLoggingState(loggable);\n  if (!veDebuggingEnabled || !loggingState || loggingState.processedForDebugging) {\n    return;\n  }\n  if (loggable instanceof Element) {\n    processElementForDebugging(loggable, loggingState);\n  } else {\n    processNonDomLoggableForDebugging(loggable, loggingState);\n  }\n}\n\nfunction showDebugPopover(content: string): void {\n  if (!debugPopover) {\n    return;\n  }\n  debugPopover.style.display = 'block';\n  debugPopover.innerHTML = content;\n}\n\nfunction processElementForDebugging(element: Element, loggingState: LoggingState): void {\n  if (element.tagName === 'OPTION') {\n    if (loggingState.parent?.selectOpen && debugPopover) {\n      debugPopover.innerHTML += '<br>' + debugString(loggingState.config);\n      loggingState.processedForDebugging = true;\n    }\n  } else {\n    (element as HTMLElement).style.outline = 'solid 1px red';\n    element.addEventListener('mouseenter', () => {\n      assertNotNullOrUndefined(debugPopover);\n      const pathToRoot = [loggingState];\n      let ancestor = loggingState.parent;\n      while (ancestor) {\n        pathToRoot.push(ancestor);\n        ancestor = ancestor.parent;\n      }\n      showDebugPopover(pathToRoot.map(s => debugString(s.config)).join('<br>'));\n    }, {capture: true});\n    element.addEventListener('mouseleave', () => {\n      assertNotNullOrUndefined(debugPopover);\n      debugPopover.style.display = 'none';\n    }, {capture: true});\n    loggingState.processedForDebugging = true;\n  }\n}\n\ntype EventType = 'Click'|'Drag'|'Hover'|'Change'|'KeyDown'|'Resize';\nexport function processEventForDebugging(\n    event: EventType, state: LoggingState|null, extraInfo?: EventAttributes): void {\n  const format = localStorage.getItem('veDebugLoggingEnabled');\n  if (!format) {\n    return;\n  }\n\n  switch (format) {\n    case DebugLoggingFormat.Intuitive:\n      processEventForIntuitiveDebugging(event, state, extraInfo);\n      break;\n    case DebugLoggingFormat.AdHocAnalysis:\n      processEventForAdHocAnalysisDebugging(event, state, extraInfo);\n      break;\n  }\n}\n\nexport function processEventForIntuitiveDebugging(\n    event: EventType, state: LoggingState|null, extraInfo?: EventAttributes): void {\n  const entry: IntuitiveLogEntry = {\n    event,\n    ve: state ? VisualElements[state?.config.ve] : undefined,\n    veid: state?.veid,\n    context: state?.config.context,\n    time: Date.now() - sessionStartTime,\n    ...extraInfo,\n  };\n  deleteUndefinedFields(entry);\n  maybeLogDebugEvent(entry);\n}\n\nexport function processEventForAdHocAnalysisDebugging(\n    event: EventType, state: LoggingState|null, extraInfo?: EventAttributes): void {\n  const ve = state ? adHocAnalysisEntries.get(state.veid) : null;\n  if (ve) {\n    const interaction: AdHocAnalysisInteraction = {time: Date.now() - sessionStartTime, type: event, ...extraInfo};\n    deleteUndefinedFields(interaction);\n    ve.interactions.push(interaction);\n  }\n}\n\nfunction deleteUndefinedFields<T>(entry: T): void {\n  for (const stringKey in entry) {\n    const key = stringKey as keyof T;\n    if (typeof entry[key] === 'undefined') {\n      delete entry[key];\n    }\n  }\n}\n\nexport type EventAttributes = {\n  context?: string,\n  width?: number,\n  height?: number,\n  mouseButton?: number,\n  doubleClick?: boolean,\n};\n\ntype VisualElementAttributes = {\n  ve: string,\n  veid: number,\n  context?: string,\n  width?: number,\n  height?: number,\n};\n\ntype IntuitiveLogEntry = {\n  event?: EventType|'Impression'|'SessionStart',\n  children?: IntuitiveLogEntry[],\n  parent?: number,\n  time?: number,\n}&Partial<VisualElementAttributes>;\n\ntype AdHocAnalysisVisualElement = VisualElementAttributes&{\n  parent?: AdHocAnalysisVisualElement,\n};\n\ntype AdHocAnalysisInteraction = {\n  type: EventType,\n  time: number,\n}&EventAttributes;\n\ntype AdHocAnalysisLogEntry = AdHocAnalysisVisualElement&{\n  time: number,\n  interactions: AdHocAnalysisInteraction[],\n};\n\nexport function processImpressionsForDebugging(states: LoggingState[]): void {\n  const format = localStorage.getItem('veDebugLoggingEnabled');\n  switch (format) {\n    case DebugLoggingFormat.Intuitive:\n      processImpressionsForIntuitiveDebugLog(states);\n      break;\n    case DebugLoggingFormat.AdHocAnalysis:\n      processImpressionsForAdHocAnalysisDebugLog(states);\n      break;\n    default:\n  }\n}\n\nfunction processImpressionsForIntuitiveDebugLog(states: LoggingState[]): void {\n  const impressions = new Map<number, IntuitiveLogEntry>();\n  for (const state of states) {\n    const entry: IntuitiveLogEntry = {\n      event: 'Impression',\n      ve: VisualElements[state.config.ve],\n      context: state?.config.context,\n      width: state.size.width,\n      height: state.size.height,\n      veid: state.veid,\n    };\n    deleteUndefinedFields(entry);\n\n    impressions.set(state.veid, entry);\n    if (!state.parent || !impressions.has(state.parent?.veid)) {\n      entry.parent = state.parent?.veid;\n    } else {\n      const parent = impressions.get(state.parent?.veid) as IntuitiveLogEntry;\n      parent.children = parent.children || [];\n      parent.children.push(entry);\n    }\n  }\n\n  const entries = [...impressions.values()].filter(i => 'parent' in i);\n  if (entries.length === 1) {\n    entries[0].time = Date.now() - sessionStartTime;\n    maybeLogDebugEvent(entries[0]);\n  } else {\n    maybeLogDebugEvent({event: 'Impression', children: entries, time: Date.now() - sessionStartTime});\n  }\n}\n\nconst adHocAnalysisEntries = new Map<number, AdHocAnalysisLogEntry>();\n\nfunction processImpressionsForAdHocAnalysisDebugLog(states: LoggingState[]): void {\n  for (const state of states) {\n    const buildVe = (state: LoggingState): AdHocAnalysisVisualElement => {\n      const ve: AdHocAnalysisVisualElement = {\n        ve: VisualElements[state.config.ve],\n        veid: state.veid,\n        width: state.size?.width,\n        height: state.size?.height,\n        context: state.config.context,\n      };\n      deleteUndefinedFields(ve);\n      if (state.parent) {\n        ve.parent = buildVe(state.parent);\n      }\n      return ve;\n    };\n    const entry = {...buildVe(state), interactions: [], time: Date.now() - sessionStartTime};\n    adHocAnalysisEntries.set(state.veid, entry);\n    maybeLogDebugEvent(entry);\n  }\n}\n\nfunction processNonDomLoggableForDebugging(loggable: Loggable, loggingState: LoggingState): void {\n  let debugElement = nonDomDebugElements.get(loggable);\n  if (!debugElement) {\n    debugElement = document.createElement('div');\n    debugElement.classList.add('ve-debug');\n    debugElement.style.background = 'black';\n    debugElement.style.color = 'white';\n    debugElement.style.zIndex = '100000';\n    debugElement.textContent = debugString(loggingState.config);\n    nonDomDebugElements.set(loggable, debugElement);\n    setTimeout(() => {\n      if (!loggingState.size?.width || !loggingState.size?.height) {\n        debugElement?.parentElement?.removeChild(debugElement);\n        nonDomDebugElements.delete(loggable);\n      }\n    }, 10000);\n  }\n  const parentDebugElement =\n      parent instanceof HTMLElement ? parent : nonDomDebugElements.get(parent as Loggable) || debugPopover;\n  assertNotNullOrUndefined(parentDebugElement);\n  if (!parentDebugElement.classList.contains('ve-debug')) {\n    debugElement.style.position = 'absolute';\n    parentDebugElement.insertBefore(debugElement, parentDebugElement.firstChild);\n  } else {\n    debugElement.style.marginLeft = '10px';\n    parentDebugElement.appendChild(debugElement);\n  }\n}\n\nexport function debugString(config: LoggingConfig): string {\n  const components = [VisualElements[config.ve]];\n  if (config.context) {\n    components.push(`context: ${config.context}`);\n  }\n  if (config.parent) {\n    components.push(`parent: ${config.parent}`);\n  }\n  if (config.track) {\n    components.push(`track: ${\n        Object.entries(config.track)\n            .map(([key, value]) => `${key}${typeof value === 'string' ? `: ${value}` : ''}`)\n            .join(', ')}`);\n  }\n  return components.join('; ');\n}\n\nconst veDebugEventsLog: (IntuitiveLogEntry|AdHocAnalysisLogEntry)[] = [];\n\nfunction maybeLogDebugEvent(entry: IntuitiveLogEntry|AdHocAnalysisLogEntry): void {\n  const format = localStorage.getItem('veDebugLoggingEnabled');\n  if (!format) {\n    return;\n  }\n  veDebugEventsLog.push(entry);\n  if (format === DebugLoggingFormat.Intuitive) {\n    // eslint-disable-next-line no-console\n    console.info('VE Debug:', entry);\n  }\n}\n\nenum DebugLoggingFormat {\n  Intuitive = 'Intuitive',\n  AdHocAnalysis = 'AdHocAnalysis',\n}\n\nfunction setVeDebugLoggingEnabled(enabled: boolean, format = DebugLoggingFormat.Intuitive): void {\n  if (enabled) {\n    localStorage.setItem('veDebugLoggingEnabled', format);\n  } else {\n    localStorage.removeItem('veDebugLoggingEnabled');\n  }\n}\n\nfunction findVeDebugImpression(veid: number, includeAncestorChain?: boolean): IntuitiveLogEntry|undefined {\n  const findImpression = (entry: IntuitiveLogEntry): IntuitiveLogEntry|undefined => {\n    if (entry.event === 'Impression' && entry.veid === veid) {\n      return entry;\n    }\n    let i = 0;\n    for (const childEntry of entry.children || []) {\n      const matchingEntry = findImpression(childEntry);\n      if (matchingEntry) {\n        if (includeAncestorChain) {\n          const children = [];\n          children[i] = matchingEntry;\n          return {...entry, children};\n        }\n        return matchingEntry;\n      }\n      ++i;\n    }\n    return undefined;\n  };\n  return findImpression({children: veDebugEventsLog as IntuitiveLogEntry[]});\n}\n\nfunction fieldValuesForSql<T>(\n    obj: T,\n    fields: {strings: readonly(keyof T)[], numerics: readonly(keyof T)[], booleans: readonly(keyof T)[]}): string {\n  return [\n    ...fields.strings.map(f => obj[f] ? `\"${obj[f]}\"` : '$NullString'),\n    ...fields.numerics.map(f => obj[f] ?? 'null'),\n    ...fields.booleans.map(f => obj[f] ?? '$NullBool'),\n  ].join(', ');\n}\n\nfunction exportAdHocAnalysisLogForSql(): void {\n  const VE_FIELDS = {\n    strings: ['ve', 'context'] as const,\n    numerics: ['veid', 'width', 'height'] as const,\n    booleans: [] as const,\n  };\n  const INTERACTION_FIELDS = {\n    strings: ['type', 'context'] as const,\n    numerics: ['width', 'height', 'mouseButton', 'time'] as const,\n    booleans: ['width', 'height', 'mouseButton', 'time'] as const,\n  };\n\n  const fieldsDefsForSql = (fields: string[]): string => fields.map((f, i) => `$${i + 1} as ${f}`).join(', ');\n\n  const veForSql = (e: AdHocAnalysisVisualElement): string =>\n      `$VeFields(${fieldValuesForSql(e, VE_FIELDS)}, ${e.parent ? `STRUCT(${veForSql(e.parent)})` : null})`;\n\n  const interactionForSql = (i: AdHocAnalysisInteraction): string =>\n      `$Interaction(${fieldValuesForSql(i, INTERACTION_FIELDS)})`;\n\n  const entryForSql = (e: AdHocAnalysisLogEntry): string =>\n      `$Entry(${veForSql(e)}, ([${e.interactions.map(interactionForSql).join(', ')}]), ${e.time})`;\n\n  const entries = veDebugEventsLog as AdHocAnalysisLogEntry[];\n\n  // eslint-disable-next-line no-console\n  console.log(`\nDEFINE MACRO NullString CAST(null AS STRING);\nDEFINE MACRO NullBool CAST(null AS BOOL);\nDEFINE MACRO VeFields ${fieldsDefsForSql([\n    ...VE_FIELDS.strings,\n    ...VE_FIELDS.numerics,\n    'parent',\n  ])};\nDEFINE MACRO Interaction STRUCT(${\n      fieldsDefsForSql([\n        ...INTERACTION_FIELDS.strings,\n        ...INTERACTION_FIELDS.numerics,\n        ...INTERACTION_FIELDS.booleans,\n      ])});\nDEFINE MACRO Entry STRUCT($1, $2 AS interactions, $3 AS time);\n\n// This fake entry put first fixes nested struct fiels names being lost\nDEFINE MACRO FakeVeFields $VeFields(\"\", $NullString, 0, 0, 0, $1);\nDEFINE MACRO FakeVe STRUCT($FakeVeFields($1));\nDEFINE MACRO FakeEntry $Entry($FakeVeFields($FakeVe($FakeVe($FakeVe($FakeVe($FakeVe($FakeVe($FakeVe(null)))))))), ([]), 0);\n\nWITH\n  processed_logs AS (\n      SELECT * FROM UNNEST([\n        $FakeEntry,\n        ${entries.map(entryForSql).join(', \\n')}\n      ])\n    )\n\n\n\nSELECT * FROM processed_logs;`);\n}\n\ntype StateFlowNode = {\n  type: 'Session',\n  children: StateFlowNode[],\n}|({type: 'Impression', children: StateFlowNode[], time: number}&AdHocAnalysisVisualElement)|AdHocAnalysisInteraction;\n\ntype StateFlowMutation = (AdHocAnalysisLogEntry|(AdHocAnalysisInteraction&{veid: number}));\n\nfunction getStateFlowMutations(): StateFlowMutation[] {\n  const mutations: StateFlowMutation[] = [];\n  for (const entry of (veDebugEventsLog as AdHocAnalysisLogEntry[])) {\n    mutations.push(entry);\n    const veid = entry.veid;\n    for (const interaction of entry.interactions) {\n      mutations.push({...interaction, veid});\n    }\n  }\n  mutations.sort((e1, e2) => e1.time - e2.time);\n  return mutations;\n}\n\nclass StateFlowElementsByArea {\n  #data = new Map<number, AdHocAnalysisVisualElement>();\n\n  add(e: AdHocAnalysisVisualElement): void {\n    this.#data.set(e.veid, e);\n  }\n\n  get(veid: number): AdHocAnalysisVisualElement|undefined {\n    return this.#data.get(veid);\n  }\n\n  getArea(e: AdHocAnalysisVisualElement): number {\n    let area = (e.width || 0) * (e.height || 0);\n    const parent = e.parent ? this.#data.get(e.parent?.veid) : null;\n    if (!parent) {\n      return area;\n    }\n    const parentArea = this.getArea(parent);\n    if (area > parentArea) {\n      area = parentArea;\n    }\n    return area;\n  }\n\n  get data(): readonly AdHocAnalysisVisualElement[] {\n    return [...this.#data.values()].filter(e => this.getArea(e)).sort((e1, e2) => this.getArea(e2) - this.getArea(e1));\n  }\n}\n\nfunction updateStateFlowTree(\n    rootNode: StateFlowNode, elements: StateFlowElementsByArea, time: number,\n    interactions: AdHocAnalysisInteraction[]): void {\n  let node = rootNode;\n  for (const element of elements.data) {\n    if (!('children' in node)) {\n      return;\n    }\n    let nextNode = node.children[node.children.length - 1];\n    const nextNodeId = nextNode?.type === 'Impression' ? nextNode.veid : null;\n    if (nextNodeId !== element.veid) {\n      node.children.push(...interactions);\n      interactions.length = 0;\n      nextNode = {type: 'Impression', ve: element.ve, veid: element.veid, context: element.context, time, children: []};\n      node.children.push(nextNode);\n    }\n    node = nextNode;\n  }\n}\n\nfunction normalizeNode(node: StateFlowNode): void {\n  if (node.type !== 'Impression') {\n    return;\n  }\n  while (node.children.length === 1) {\n    if (node.children[0].type === 'Impression') {\n      node.children = node.children[0].children;\n    }\n  }\n  for (const child of node.children) {\n    normalizeNode(child);\n  }\n}\n\nfunction buildStateFlow(): StateFlowNode {\n  const mutations = getStateFlowMutations();\n  const elements = new StateFlowElementsByArea();\n  const rootNode: StateFlowNode = {type: 'Session', children: []};\n\n  let time = mutations[0].time;\n  const interactions: AdHocAnalysisInteraction[] = [];\n  for (const mutation of mutations) {\n    if (mutation.time > time + 1000) {\n      updateStateFlowTree(rootNode, elements, time, interactions);\n      interactions.length = 0;\n    }\n    if (!('type' in mutation)) {\n      elements.add(mutation);\n    } else if (mutation.type === 'Resize') {\n      const element = elements.get(mutation.veid);\n      if (!element) {\n        continue;\n      }\n      const oldArea = elements.getArea(element);\n      element.width = mutation.width;\n      element.height = mutation.height;\n      if (elements.getArea(element) !== 0 && oldArea !== 0) {\n        interactions.push(mutation);\n      }\n    } else {\n      interactions.push(mutation);\n    }\n    time = mutation.time;\n  }\n  updateStateFlowTree(rootNode, elements, time, interactions);\n\n  normalizeNode(rootNode);\n  return rootNode;\n}\n\nlet sessionStartTime: number = Date.now();\n\nexport function processStartLoggingForDebugging(): void {\n  sessionStartTime = Date.now();\n  if (localStorage.getItem('veDebugLoggingEnabled') === DebugLoggingFormat.Intuitive) {\n    maybeLogDebugEvent({event: 'SessionStart'});\n  }\n}\n\n// @ts-ignore\nglobalThis.setVeDebugLoggingEnabled = setVeDebugLoggingEnabled;\n// @ts-ignore\nglobalThis.veDebugEventsLog = veDebugEventsLog;\n// @ts-ignore\nglobalThis.findVeDebugImpression = findVeDebugImpression;\n// @ts-ignore\nglobalThis.exportAdHocAnalysisLogForSql = exportAdHocAnalysisLogForSql;\n// @ts-ignore\nglobalThis.buildStateFlow = buildStateFlow;\n"]}